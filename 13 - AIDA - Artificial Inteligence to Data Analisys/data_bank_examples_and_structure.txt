SELECT
  table_schema,
  table_name,
  string_agg(
    column_name
    || ' ' || data_type
    || COALESCE('('||character_maximum_length||')','')
    || CASE WHEN is_nullable = 'NO' THEN ' NOT NULL' ELSE '' END,
    ', ' ORDER BY ordinal_position
  ) AS columns_summary
FROM information_schema.columns
WHERE table_schema NOT IN ('information_schema','pg_catalog')
GROUP BY table_schema, table_name
ORDER BY table_schema, table_name;

WITH freight_counts AS (
    SELECT 
        freight_id,
        COUNT(*) AS contagem
    FROM 
        freight_histories
    WHERE 
        key = 'driver_id'
    GROUP BY 
        freight_id
    HAVING 
        COUNT(*) > 1
),
ranked_histories AS (
    SELECT 
        fh.freight_id,
        fh.created_at,
        ROW_NUMBER() OVER (PARTITION BY fh.freight_id ORDER BY fh.created_at ASC) AS rank
    FROM 
        freight_histories fh
    WHERE 
        fh.key = 'driver_id'
),
adiamentos AS (
    SELECT 
        fh.freight_id, 
        fh.created_at AS data_adiamento
    FROM 
        freight_histories fh 
    WHERE 
        fh.key = 'start_at'
        AND fh.new_value > fh.old_value
)
SELECT 
    rh.freight_id,
    rh.created_at AS second_created_at,
    a.data_adiamento,
    CASE 
        WHEN a.data_adiamento > rh.created_at THEN 1
        ELSE 0
    END AS adiamento_pos_criacao
FROM 
    ranked_histories rh
LEFT JOIN 
    adiamentos a ON rh.freight_id = a.freight_id
JOIN 
    freight_counts fc ON rh.freight_id = fc.freight_id
WHERE 
    rh.rank = 2;
select 
*
from freights f
where f.status = 300
and f."type" ='1'WITH RankedRatings AS (
    SELECT
        dr.driver_id,
        dr.freight_id,
        dr.rating,
        ROW_NUMBER() OVER (PARTITION BY dr.driver_id ORDER BY dr.id ASC) AS row_num
    FROM driver_ratings dr
)
SELECT
    r.driver_id,
    AVG(r.rating) AS rating
FROM RankedRatings r
left join drivers d on d.id = r.driver_id
left join freights f on r.freight_id = f.id 
WHERE row_num <= 6 and d.service_supplier = 0
and freights_type(f."type") = 'Ajudante'
GROUP BY r.driver_idWITH RankedRatings AS (
    SELECT
        dr.driver_id,
        dr.rating,
        ROW_NUMBER() OVER (PARTITION BY dr.driver_id ORDER BY dr.id ASC) AS row_num
    FROM driver_ratings dr
)
SELECT
    r.driver_id,
    AVG(r.rating) AS rating
FROM RankedRatings r
left join drivers d on d.id = r.driver_id
WHERE row_num <= 6 and d.service_supplier = 1
GROUP BY driver_idWITH RankedRatings AS (
    SELECT
        dr.driver_id,
        dr.freight_id,
        dr.rating,
        ROW_NUMBER() OVER (PARTITION BY dr.driver_id ORDER BY dr.id ASC) AS row_num
    FROM driver_ratings dr
)
SELECT
    r.driver_id,
    AVG(r.rating) AS rating
FROM RankedRatings r
left join drivers d on d.id = r.driver_id
left join freights f on r.freight_id = f.id 
WHERE row_num <= 6 and d.service_supplier = 0
and freights_type(f."type") = 'Ajudante'
GROUP BY r.driver_idWITH RankedRatings AS (
    SELECT
        dr.driver_id,
        dr.freight_id,
        dr.rating,
        ROW_NUMBER() OVER (PARTITION BY dr.driver_id ORDER BY dr.id ASC) AS row_num
    FROM driver_ratings dr
)
SELECT
    r.driver_id,
    AVG(r.rating) AS rating
FROM RankedRatings r
left join drivers d on d.id = r.driver_id
left join freights f on r.freight_id = f.id 
WHERE row_num <= 6 and d.service_supplier = 0
and freights_type(f."type") = 'Diária'
GROUP BY r.driver_idWITH RankedRatings AS (
    SELECT
        dr.driver_id,
        dr.rating,
        ROW_NUMBER() OVER (PARTITION BY dr.driver_id ORDER BY dr.id ASC) AS row_num
    FROM driver_ratings dr
)
SELECT
    r.driver_id,
    AVG(r.rating) AS rating
FROM RankedRatings r
left join drivers d on d.id = r.driver_id
WHERE row_num <= 6 and d.service_supplier = 0
GROUP BY driver_idWITH RankedRatings AS (
    SELECT
        dr.driver_id,
        dr.freight_id,
        dr.rating,
        ROW_NUMBER() OVER (PARTITION BY dr.driver_id ORDER BY dr.id ASC) AS row_num
    FROM driver_ratings dr
)
SELECT
    r.driver_id,
    AVG(r.rating) AS rating
FROM RankedRatings r
left join drivers d on d.id = r.driver_id
left join freights f on r.freight_id = f.id 
WHERE row_num <= 6 and d.service_supplier = 0
and freights_type(f."type") = 'Viagem'
GROUP BY r.driver_idSELECT
    CONCAT(
        'Relatório de Avaliações do Motorista: ', COALESCE(driver_id::text, 'Não disponível'), '\n',
        'Data de Criação: ', COALESCE(created_at::text, 'Não disponível'), '\n',
        'Data de Atualização: ', COALESCE(updated_at::text, 'Não disponível'), '\n',
        'Consumo Médio: ', COALESCE(avg_consumption::text, 'Não disponível'), '\n',
        'Cuidado com a Carga: ', COALESCE(load_care::text, 'Não disponível'), '\n',
        'Cuidado com o Caminhão: ', COALESCE(truck_care::text, 'Não disponível'), '\n',
        'Pontualidade: ', COALESCE(punctuality::text, 'Não disponível'), '\n',
        'Observação: ', COALESCE(observation::text, 'Não disponível'), '\n',
        'ID do Frete: ', COALESCE(freight_id::text, 'Não disponível'), '\n',
        'Comportamento: ', COALESCE(behavior::text, 'Não disponível'), '\n'
    ) AS report
FROM "driver_ratings"
WHERE driver_id = 14346
LIMIT 10;
SELECT
    CONCAT(
        'Relatório de Avaliações do Motorista: ', COALESCE(driver_id::text, 'Não disponível'), '\n',
        'Data de Criação: ', COALESCE(created_at::text, 'Não disponível'), '\n',
        'Data de Atualização: ', COALESCE(updated_at::text, 'Não disponível'), '\n',
        'Consumo Médio: ', COALESCE(avg_consumption::text, 'Não disponível'), '\n',
        'Cuidado com a Carga: ', COALESCE(load_care::text, 'Não disponível'), '\n',
        'Cuidado com o Caminhão: ', COALESCE(truck_care::text, 'Não disponível'), '\n',
        'Pontualidade: ', COALESCE(punctuality::text, 'Não disponível'), '\n',
        'Observação: ', COALESCE(observation::text, 'Não disponível'), '\n',
        'ID do Frete: ', COALESCE(freight_id::text, 'Não disponível'), '\n',
        'Comportamento: ', COALESCE(behavior::text, 'Não disponível'), '\n'
    ) AS report
FROM "driver_ratings"
WHERE driver_id = 14346
LIMIT 10;
SELECT 
    dr.driver_id,
    dr.rating
FROM 
    driver_ratings dr  
WHERE 
    created_at >= CURRENT_DATE - INTERVAL '12 months';
with bonus as (
select
dcb.updated_at,
dcb.price / 100 as value,
dcb.contract_id as contract_id
from driver_contract_bonuses dcb 
),
contract as (
select
f.id as contract_id,
f.contract_days as contract_days,
f.price/100 as price,
f.day_of_week as contract_day_of_week,
d.id as driver_id,
d.name as driver_name,
d.service_supplier as service_supplier,
c.name as company_name
from freights f
left join companies c on c.id = f.company_id
left join drivers d on d.id = f.driver_id 
)
select c.*,
bonus.updated_at,
bonus.value
 from bonus
left join contract c on c.contract_id = bonus.contract_idselect
	f.id "Id contrato",
	f.created_at "Data de criação do contrato",
	ch.created_at "Data de vinculo do analista de sucesso",
	c.id "Id cliente",
	c.name "Cliente",
	c.responsable_name "responsavel",
	c.phone,
	c.qtd_trucks,
	companies_client_status(c.client_status)"Status cliente",
	freights_status(f.status) "Status do contrato",
	c.company_multitenancy_id "Id cliente master",
	smt.name "Time",
	u.id "Id analista",
	u.name "Analista",
	case
		when al.causer_type = 'App\Models\User' then 'Usuario interno'
		when al.causer_type = 'App\Models\CompanyMultilevel' then 'Cliente'
	else 'Desconhecido'
	end,
	u2.id "Id usuario interno",
	u2.name "Usuario interno que criou o contrato"
from freights f
join companies c on c.id = f.company_id
join company_histories ch on ch.company_id = c.id and key = 'analyst_success_id' and old_value is null
left join success_manager_teams smt on smt.success_manager_id = c.success_manager_id
left join users u on u.id = c.analyst_success_id
join activity_log al on al.subject_id = f.id and subject_type = 'App\Models\Freight' and al.description = 'created'
left join users u2 on u2.id = al.causer_id
where f.created_at >= ch.created_at
and f.created_at >= CURRENT_DATE - INTERVAL '1 YEAR'
order by f.created_at descWITH motoristas_selecionados AS (
    SELECT 
        fh.freight_id, 
        COUNT(DISTINCT fh.new_value) AS selecionados
    FROM 
        freight_histories fh 
    WHERE 
        fh."key" = 'driver_id'
    GROUP BY 
        fh.freight_id
),
motoristas_candidatados AS (
    SELECT 
        dfhs.freight_id, 
        dfhs.count_candidate AS candidatos
    FROM 
        driver_freight_history_summary dfhs
),
teve_adiamento AS (
    SELECT 
        fh.freight_id, 
        1 AS teve_adiamento
    FROM 
        freight_histories fh 
    WHERE 
        fh."key" = 'start_at'
        AND fh.new_value > fh.old_value
)
SELECT DISTINCT ON (s.freight_id)
	f.created_at,
    s.freight_id, 
    s.selecionados, 
    c.candidatos,
    COALESCE(freights_reason(f.reason), '') AS reason,
    coalesce (ta.teve_adiamento, 0) as teve_adiamento
FROM 
    motoristas_selecionados s
LEFT JOIN 
    motoristas_candidatados c ON c.freight_id = s.freight_id
LEFT JOIN 
    freights f ON f.id = s.freight_id
LEFT JOIN 
    teve_adiamento ta ON ta.freight_id = s.freight_id
WHERE 
    c.candidatos IS NOT NULL
ORDER BY 
    s.freight_id, s.selecionados DESC

WITH candidaturas AS (
  select
  	id,
    freight_id,
    driver_id,
    candidate_at AS data,
    'candidatura' AS acao,
    'candidatura' AS motivo
  FROM driver_freight_history
  WHERE
    uncandidate_reason IS NOT NULL
),
descandidaturas AS (
  select
  id,
    freight_id,
    driver_id,
    uncandidate_at AS data,
    'descandidatura' AS acao,
    driver_freight_history_uncandidate_reason(uncandidate_reason) AS motivo
  FROM driver_freight_history
  WHERE
    uncandidate_reason IS NOT null
),
selecao AS (
select
	0,
    freight_id,
    driver_id,
    uncandidate_at AS data,
    'selecao' AS acao,
    'selecao' AS motivo
  FROM driver_freight_history
  WHERE
    uncandidate_reason IS NOT null and uncandidate_reason = 3
),
resultado AS (
  SELECT
    *
  FROM candidaturas
  UNION ALL
  SELECT
    *
  FROM descandidaturas
  UNION ALL
  SELECT
    *
  FROM selecao
  ORDER BY
    driver_id,
    data
),
resultado_filtrado as (
select * from resultado
where motivo in ('Motorista removeu', 'candidatura', 'selecao')
),
sumario as(
SELECT
  extract (day from max(data) -  min(data)) as periodo,
        COUNT(CASE WHEN acao = 'selecao' THEN 1 END) AS selecao,
        COUNT(CASE WHEN acao = 'candidatura' THEN 1 END) AS candidatura,
        COUNT(CASE WHEN acao = 'descandidatura' THEN 1 END) AS descandidatura,
  driver_id
FROM resultado_filtrado
group by driver_id
)
select * from sumario
where periodo > 0 
order by candidatura asc
select dfh.candidate_at, 
dfh.driver_id,
c."name" as city,
s."name" as state,
freights_type(f.type),
f.contract_days,
coalesce(v.name, 'Não Informado') as vehicle,
coalesce(s2."name", 'Não Informado')  as supply
from driver_freight_history dfh
left join freights f on f.id  = dfh.freight_id 
left join company_addresses ca on ca.id = f.origin
left join cities c on ca.city_id = c.id
left join states s on ca.state_id = s.id 
left join vehicles v on f.vehicle_id = v.id
left join supplies s2 on f.supply_id = s2.id
where candidate_at is not nullwith coordenadas as (
select vr.id as id_checklist,
       f.id as id_contrato,
       d.name as nome_motorista,
       vr.latitude as latitude_checklist,
       vr.longitude as longitude_checklist,
       ca.latitude as latitude_endereco_origem,
       ca.longitude as longitude_endereco_origem,
       da.latitude as latitude_residencia,
       da.longitude as longitude_residencia,
       ROUND((6371 * acos(cos(radians(vr.latitude)) * cos(radians(ca.latitude)) * cos(radians(ca.longitude) - radians(vr.longitude)) + sin(radians(vr.latitude)) * sin(radians(ca.latitude))))) AS distancia_km_contrato,
       ROUND((6371 * acos(cos(radians(vr.latitude)) * cos(radians(da.latitude)) * cos(radians(da.longitude) - radians(vr.longitude)) + sin(radians(vr.latitude)) * sin(radians(da.latitude))))) AS distancia_km_residencia
FROM vehicle_reviews vr
JOIN freights f ON f.id = vr.freight_id
JOIN company_addresses ca on f.origin = ca.id
JOIN drivers d on d.id = f.driver_id
JOIN driver_addresses da on da.driver_id = d.id
and da.type = 0
order by f.id asc
),
checklist as (
select
id,
updated_at,
plate,
driver_id as driver_id,
freight_id as contract_id,
vr."type"
from vehicle_reviews vr 
where vr."type" = 1 --Inicial
or vr."type" = 2 --Final
order by freight_id 
),
contract as (
select
f.id as contract_id,
f.contract_days as contract_days,
f.price/100 as price,
f.day_of_week as contract_day_of_week,
d.id as driver_id,
d.name as driver_name,
d.service_supplier as service_supplier,
c.name as company_name
from freights f
left join companies c on c.id = f.company_id
left join drivers d on d.id = f.driver_id 
)
select * from checklist ch
left join contract c on c.contract_id = ch.contract_id
left join coordenadas on coordenadas.id_contrato = ch.contract_id
WITH driver_start AS (
  SELECT 
    driver_id,
    DATE_TRUNC('month', MIN(start_at)) AS first_month
  FROM freights
  WHERE status = 300
  and freights_type("type") = 'Coleta/Entrega'
  GROUP BY driver_id
),
contracts_with_month AS (
  SELECT 
    f.driver_id,
    f.start_at,
    -- Calcula a diferença em meses entre o mês do contrato e o mês inicial do motorista.
    (DATE_PART('year', f.start_at) * 12 + DATE_PART('month', f.start_at)) -
    (DATE_PART('year', ds.first_month) * 12 + DATE_PART('month', ds.first_month)) AS activity_month
  FROM freights f
  JOIN driver_start ds 
    ON f.driver_id = ds.driver_id
  WHERE f.status = 300
  and freights_type("type") = 'Coleta/Entrega'
),
contracts_by_driver AS (
  SELECT 
    driver_id,
    activity_month,
    COUNT(*) AS contracts_count
  FROM contracts_with_month
  GROUP BY driver_id, activity_month
)
SELECT 
  activity_month,
  AVG(contracts_count) AS avg_contracts_per_month
FROM contracts_by_driver
GROUP BY activity_month
ORDER BY activity_month;






with company as (
select id as company_id,
name as name,
company_economic_group_id
from companies c 
),
company_add as (
select
ca.company_id,
c."name" as city,
s."name" as state
from company_addresses ca
left join states s on s.id = ca.state_id  
left join cities c on c.id = ca.city_id 
),
company_eg as (
select 
id,
name
from company_economic_groups ceg
),
company_ntrucks as (
select company_id,
count(*) as company_trucks
from
company_trucks ct 
group by company_id 
),
company_op as (
select 
company_id,
c."name" as city,
s."name" as state
from 
company_operation_locations col 
left join states s on s.id = col.state_id  
left join cities c on c.id = col.city_id 
)
select 
c.*,
ca.state,
ca.city,
ce.name as economic_group,
cn.company_trucks as company_trucks,
cop.city as op_city,
cop.state as op_state
from company c
left join company_add ca on ca.company_id = c.company_id
left join company_eg ce on ce.id = c.company_economic_group_id
left join company_ntrucks cn on cn.company_id = c.company_id
left join company_op cop on cop.company_id = c.company_id



select
f.id as freight_id,
fh.created_at as canceled_at,
f.start_at as start_at,
f.created_at as created_at
from freights f
join freight_histories fh on fh.freight_id = f.id and key = 'status' and fh.new_value = '900'
where f.reason = 1 and f.status = 900SELECT 
    f.created_at AS contract_created_at,
    f.end_at AS contract_end_at,
    fed.created_at AS fed_created_at,
    EXTRACT(EPOCH FROM (fed.created_at - f.end_at)) / 86400 AS days_to_contract_end,
    fed.days::float AS days,
    CASE fed.type
        WHEN 0 THEN 'add'
        WHEN 1 THEN 'remove'
    END AS action
FROM freight_extra_days fed
LEFT JOIN freights f 
    ON f.id = fed.freight_id
WHERE f.type = '1'
ORDER BY fed.type DESC
with contract as (
select 
f.id as contract_id,
f.driver_id,
f.vehicle_id,
f.company_ideal_profile_id,
ca.latitude,
ca.longitude 
from freights f
left join company_addresses ca on ca.company_id = f.origin
where company_ideal_profile_id is not null
),
profile as (
SELECT
    cipp.company_ideal_profile_id as company_ideal_profile_id,
    MAX(CASE WHEN ideal_profile_parameter_id = 1 THEN value END) AS min_years_experience,
    MAX(CASE WHEN ideal_profile_parameter_id = 2 THEN value END) AS vehicle,
    MAX(CASE WHEN ideal_profile_parameter_id = 3 THEN value END) AS operational_supplies,
    MAX(CASE WHEN ideal_profile_parameter_id = 4 THEN value END) AS age_group,
    MAX(CASE WHEN ideal_profile_parameter_id = 5 THEN value END) AS max_kilometers_distance,
    MAX(CASE WHEN ideal_profile_parameter_id = 6 THEN value END) AS gender,
    MAX(CASE WHEN ideal_profile_parameter_id = 1 THEN weight END) AS weight_min_years_experience,
    MAX(CASE WHEN ideal_profile_parameter_id = 2 THEN weight END) AS weight_vehicle,
    MAX(CASE WHEN ideal_profile_parameter_id = 3 THEN weight END) AS weight_operational_supplies,
    MAX(CASE WHEN ideal_profile_parameter_id = 4 THEN weight END) AS weight_age_group,
    MAX(CASE WHEN ideal_profile_parameter_id = 5 THEN weight END) AS weight_max_kilometers_distance,
    MAX(CASE WHEN ideal_profile_parameter_id = 6 THEN weight END) AS weight_gender
FROM company_ideal_profile_parameters cipp
WHERE cipp.company_ideal_profile_id IN (
    SELECT company_ideal_profile_id
    FROM freights
    WHERE company_ideal_profile_id IS NOT NULL
)
GROUP BY cipp.company_ideal_profile_id
)
select 
contract_id,driver_id,
c.company_ideal_profile_id,
c.latitude as company_latitude,
c.longitude as company_longitude,
min_years_experience,
vehicle_id,
operational_supplies,
age_group,
max_kilometers_distance,
gender,
weight_min_years_experience,
weight_vehicle,
weight_operational_supplies,
weight_age_group,
weight_max_kilometers_distance,
weight_gender
from contract c
left join profile p on p.company_ideal_profile_id = c.company_ideal_profile_id
where contract_id = 105624
select 
f.created_at as created_at, 
f.company_id,
f.id as contract_id,
c."name" as city,
s."name" as state,
freights_type(f.type),
f.contract_days,
coalesce(v.name, 'Não Informado') as vehicle,
coalesce(s2."name", 'Não Informado')  as supply
from 
freights f 
left join company_addresses ca on ca.id = f.origin
left join cities c on ca.city_id = c.id
left join states s on ca.state_id = s.id 
left join vehicles v on f.vehicle_id = v.id
left join supplies s2 on f.supply_id = s2.id
-- where f.created_at >= now() - interval '1 year'

---------------------------------------------------------------------------------------
--Contratos candidaturas
----------------------------------------------------------------------------------------
with candidaturas AS (
WITH ultimas_candidaturas AS (
    SELECT 
        dfh.freight_id AS contract_id,
        dfh.driver_id,
        'Candidatura' AS contract_status,
        dfh.created_at,
        ROW_NUMBER() OVER (PARTITION BY dfh.driver_id ORDER BY dfh.updated_at DESC) AS rn
    FROM driver_freight_history dfh 
    WHERE 
        dfh.uncandidate_at IS NULL
        AND dfh.candidate_at IS NOT NULL
)
SELECT 
    contract_id,
    driver_id,
    contract_status,
    created_at
FROM 
    ultimas_candidaturas
WHERE 
    rn <= 5  -- Filtra para pegar apenas as 5 últimas candidaturas por motorista
ORDER BY 
    driver_id DESC, rn
    ),
contratos_detalhados AS (
    SELECT
        f.id AS contract_id,
        f.driver_id,
        f.company_id,
        f.start_at,
        f.end_at,
        f.description,
        f.contract_days,
        v.name AS vehicle,
        tl.name AS truck_load,
        s.name AS supply,
        c.name AS company_name
    FROM freights f
    LEFT JOIN vehicles v ON v.id = f.vehicle_id 
    LEFT JOIN truck_loads tl ON tl.id = f.load_id 
    LEFT JOIN supplies s ON s.id = f.supply_id 
    LEFT JOIN companies c ON c.id = f.company_id
)
select 
cd.contract_id,
h.driver_id,
cd.company_id,
cd.start_at,
cd.end_at,
cd.description,
cd.contract_days,
cd.vehicle,
cd.truck_load,
cd.supply,
cd.company_name,
h.contract_status
from candidaturas h
left join contratos_detalhados cd on cd.contract_id = h.contract_id
order by h.driver_id desc
WITH historico AS (
    SELECT 
        f.id AS contract_id,
        f.driver_id,
        CASE 
            WHEN f.end_at > NOW() AND f.start_at < NOW() THEN 'Rodando'
            WHEN f.end_at < NOW() THEN 'Terminado'
            ELSE '--'
        END AS contract_status,
        ROW_NUMBER() OVER (PARTITION BY f.driver_id ORDER BY f.end_at DESC) AS rn
    FROM freights f
    WHERE 
        f.end_at < NOW()  -- Considera contratos "Terminado"
        OR (f.end_at > NOW() AND f.start_at < NOW())  -- Considera contratos "Rodando"
),
contratos_detalhados AS (
    SELECT
        f.id AS freight_id, 
        f.driver_id,  
        f.price/100 AS valor_do_contrato, 
        f.start_at AS data_inicio, 
        f.end_at AS data_fim,
        c.name AS nome_empresa, 
        c.corporate_name AS nome_corporativo_empresa, 
        c.email AS email_empresa, 
        c.phone AS telefone_empresa, 
        c.cnpj AS cnpj_empresa,
        c.status AS status_empresa,
        c.operation_states AS estados_operacao_empresa,
        v.name AS vehicle,
        tl.name AS implemento,
        s.name AS carga
    FROM freights f
    LEFT JOIN vehicles v ON v.id = f.vehicle_id 
    LEFT JOIN truck_loads tl ON tl.id = f.load_id 
    LEFT JOIN supplies s ON s.id = f.supply_id 
    LEFT JOIN companies c ON c.id = f.company_id
)
SELECT 
    CONCAT(
        'Algumas das experiências recentes em contratos: \n'
        'ID do Frete: ', COALESCE(cd.freight_id::text, 'Não disponível'), '\n',
        'ID do Motorista: ', COALESCE(cd.driver_id::text, 'Não disponível'), '\n',
        'Valor do Contrato: R$', COALESCE((cd.valor_do_contrato)::text, 'Não disponível'), '\n',
        'Data de Início: ', COALESCE(cd.data_inicio::text, 'Não disponível'), '\n',
        'Data de Fim: ', COALESCE(cd.data_fim::text, 'Não disponível'), '\n',
        'Nome da Empresa: ', COALESCE(cd.nome_empresa, 'Não disponível'), '\n',
        'Nome Corporativo da Empresa: ', COALESCE(cd.nome_corporativo_empresa, 'Não disponível'), '\n',
        'Email da Empresa: ', COALESCE(cd.email_empresa, 'Não disponível'), '\n',
        'Telefone da Empresa: ', COALESCE(cd.telefone_empresa, 'Não disponível'), '\n',
        'CNPJ da Empresa: ', COALESCE(cd.cnpj_empresa, 'Não disponível'), '\n',
        'Veículo: ', COALESCE(cd.vehicle, 'Não disponível'), '\n',
        'Implemento: ', COALESCE(cd.implemento, 'Não disponível'), '\n',
        'Carga: ', COALESCE(cd.carga, 'Não disponível'), '\n',
        'Status do Contrato: ', COALESCE(h.contract_status, 'Não disponível'), '\n'
    ) AS report
FROM historico h
LEFT JOIN contratos_detalhados cd ON cd.freight_id = h.contract_id
WHERE h.driver_id = 14346
LIMIT 10;
WITH historico AS (
        SELECT 
            f.id AS contract_id,
            f.driver_id,
            CASE 
                WHEN f.end_at > NOW() AND f.start_at < NOW() THEN 'Rodando'
                WHEN f.end_at < NOW() THEN 'Terminado'
                ELSE '--'
            END AS contract_status,
            ROW_NUMBER() OVER (PARTITION BY f.driver_id ORDER BY f.end_at DESC) AS rn
        FROM freights f
        WHERE 
            f.end_at < NOW()  -- Considera contratos "Terminado"
            OR (f.end_at > NOW() AND f.start_at < NOW())  -- Considera contratos "Rodando"
    ),
contratos_detalhados AS (
    SELECT
        f.id AS contract_id,
        f.driver_id,
        f.company_id,
        f.start_at,
        f.end_at,
        f.description,
        f.contract_days,
        v.name AS vehicle,
        tl.name AS truck_load,
        s.name AS supply,
        c.name AS company_name
    FROM freights f
    LEFT JOIN vehicles v ON v.id = f.vehicle_id 
    LEFT JOIN truck_loads tl ON tl.id = f.load_id 
    LEFT JOIN supplies s ON s.id = f.supply_id 
    LEFT JOIN companies c ON c.id = f.company_id
)
select cd.*,
h.contract_status
from historico h
left join contratos_detalhados cd on cd.contract_id = h.contract_id
where h.contract_status = 'Rodando'WITH historico AS (
    SELECT 
        f.id AS contract_id,
        f.driver_id,
        CASE 
            WHEN f.end_at > NOW() AND f.start_at < NOW() THEN 'Rodando'
            WHEN f.end_at < NOW() THEN 'Terminado'
            ELSE '--'
        END AS contract_status,
        ROW_NUMBER() OVER (PARTITION BY f.driver_id ORDER BY f.end_at DESC) AS rn
    FROM freights f
    WHERE 
        f.end_at < NOW()  -- Considera contratos "Terminado"
        OR (f.end_at > NOW() AND f.start_at < NOW())  -- Considera contratos "Rodando"
),
contratos_detalhados AS (
    SELECT
        f.id AS freight_id, 
        f.driver_id,  
        f.price/100 AS valor_do_contrato, 
        f.start_at AS data_inicio, 
        f.end_at AS data_fim,
        c.name AS nome_empresa, 
        c.corporate_name AS nome_corporativo_empresa, 
        c.email AS email_empresa, 
        c.phone AS telefone_empresa, 
        c.cnpj AS cnpj_empresa,
        c.status AS status_empresa,
        c.operation_states AS estados_operacao_empresa,
        v.name AS vehicle,
        tl.name AS implemento,
        s.name AS carga
    FROM freights f
    LEFT JOIN vehicles v ON v.id = f.vehicle_id 
    LEFT JOIN truck_loads tl ON tl.id = f.load_id 
    LEFT JOIN supplies s ON s.id = f.supply_id 
    LEFT JOIN companies c ON c.id = f.company_id
)
SELECT 
    CONCAT(
        'ID do Frete: ', COALESCE(cd.freight_id::text, 'Não disponível'), '\n',
        'ID do Motorista: ', COALESCE(cd.driver_id::text, 'Não disponível'), '\n',
        'Valor do Contrato: R$', COALESCE((cd.valor_do_contrato)::text, 'Não disponível'), '\n',
        'Data de Início: ', COALESCE(cd.data_inicio::text, 'Não disponível'), '\n',
        'Data de Fim: ', COALESCE(cd.data_fim::text, 'Não disponível'), '\n',
        'Nome da Empresa: ', COALESCE(cd.nome_empresa, 'Não disponível'), '\n',
        'Nome Corporativo da Empresa: ', COALESCE(cd.nome_corporativo_empresa, 'Não disponível'), '\n',
        'Email da Empresa: ', COALESCE(cd.email_empresa, 'Não disponível'), '\n',
        'Telefone da Empresa: ', COALESCE(cd.telefone_empresa, 'Não disponível'), '\n',
        'CNPJ da Empresa: ', COALESCE(cd.cnpj_empresa, 'Não disponível'), '\n',
        'Veículo: ', COALESCE(cd.vehicle, 'Não disponível'), '\n',
        'Implemento: ', COALESCE(cd.implemento, 'Não disponível'), '\n',
        'Carga: ', COALESCE(cd.carga, 'Não disponível'), '\n',
        'Status do Contrato: ', COALESCE(h.contract_status, 'Não disponível'), '\n'
    ) AS report
FROM historico h
LEFT JOIN contratos_detalhados cd ON cd.freight_id = h.contract_id
WHERE h.driver_id = 14346
LIMIT 10;
WITH historico AS (
        SELECT 
            f.id AS contract_id,
            f.driver_id,
            CASE 
                WHEN f.end_at > NOW() AND f.start_at < NOW() THEN 'Rodando'
                WHEN f.end_at < NOW() THEN 'Terminado'
                ELSE '--'
            END AS contract_status,
            ROW_NUMBER() OVER (PARTITION BY f.driver_id ORDER BY f.end_at DESC) AS rn
        FROM freights f
        WHERE 
            f.end_at < NOW()  -- Considera contratos "Terminado"
            OR (f.end_at > NOW() AND f.start_at < NOW())  -- Considera contratos "Rodando"
    ),
contratos_detalhados AS (
    SELECT
        f.id AS contract_id,
        f.driver_id,
        f.company_id,
        f.start_at,
        f.end_at,
        f.description,
        f.contract_days,
        v.name AS vehicle,
        tl.name AS truck_load,
        s.name AS supply,
        c.name AS company_name
    FROM freights f
    LEFT JOIN vehicles v ON v.id = f.vehicle_id 
    LEFT JOIN truck_loads tl ON tl.id = f.load_id 
    LEFT JOIN supplies s ON s.id = f.supply_id 
    LEFT JOIN companies c ON c.id = f.company_id
)
select cd.*,
h.contract_status
from historico h
left join contratos_detalhados cd on cd.contract_id = h.contract_id
where h.contract_status = 'Terminado'

    with driver_occurrence as (
select 
dbo.created_at,
dbo.driver_id,
dbo.contract_id as contract_id,
dbot.driver_behavior_occurrence_type_id
from 
driver_behavior_occurrence dbo 
left join driver_behavior_occurrence_types dbot on dbo.id = dbot.driver_behavior_occurrence_id 
where dbot.driver_behavior_occurrence_type_id in (9,23)
UNION ALL
select 
f.created_at,
f.driver_id,
f.id as contract_id,
0 as "driver_behavior_occurrence_type_id"
from freights f
where f.status = 300
) 
select doc.*,
f.start_at,
f.price / f.contract_days / 100 as price,
f.company_id,
da.latitude as driver_latitude,
da.longitude as driver_longitude,
ca.latitude as contract_latitude,
ca.longitude as contract_longitude,
s.uf,
c."name"
from driver_occurrence doc 
left join driver_addresses da on da.driver_id = doc.driver_id
left join freights f on f.id = doc.contract_id
left join company_addresses ca on ca.id = f.origin 
left join drivers d on d.id = doc.driver_id 
left join cities c on c.id = da.city_id 
left join states s on s.id = da.state_id 
where da.longitude is not null
and da."type" = 0
and ca.latitude is not null
and d.service_supplier = 1
and f.contract_days >0
    SELECT 'id' AS column_name, id::text AS column_value, 'Identificador único do motorista' AS description 
    FROM drivers WHERE id = 14346 AND id IS NOT NULL
    UNION ALL
    SELECT 'cpf' AS column_name, cpf::text AS column_value, 'CPF do motorista' AS description 
    FROM drivers WHERE id = 14346 AND cpf IS NOT NULL
    UNION ALL
    SELECT 'email' AS column_name, email::text AS column_value, 'Email do motorista' AS description 
    FROM drivers WHERE id = 14346 AND email IS NOT NULL
    UNION ALL
    SELECT 'name' AS column_name, name::text AS column_value, 'Nome do motorista' AS description 
    FROM drivers WHERE id = 14346 AND name IS NOT NULL
    UNION ALL
    SELECT 'phone' AS column_name, phone::text AS column_value, 'Número de telefone do motorista' AS description 
    FROM drivers WHERE id = 14346 AND phone IS NOT NULL
    UNION ALL
    SELECT 'city' AS column_name, city::text AS column_value, 'Cidade onde o motorista está registrado' AS description 
    FROM drivers WHERE id = 14346 AND city IS NOT NULL
    UNION ALL
    SELECT 'state' AS column_name, state::text AS column_value, 'Estado onde o motorista está registrado' AS description 
    FROM drivers WHERE id = 14346 AND state IS NOT NULL
    UNION ALL
    SELECT 'created_at' AS column_name, created_at::text AS column_value, 'Data de criação do registro' AS description 
    FROM drivers WHERE id = 14346 AND created_at IS NOT NULL
    UNION ALL
    SELECT 'updated_at' AS column_name, updated_at::text AS column_value, 'Data da última atualização do registro' AS description 
    FROM drivers WHERE id = 14346 AND updated_at IS NOT NULL
    UNION ALL
    SELECT 'status' AS column_name, drivers_status(status)::text AS column_value, 'Status do motorista (ativo, inativo, etc.)' AS description 
    FROM drivers WHERE id = 14346 AND status IS NOT NULL
    UNION ALL
    SELECT 'app_version' AS column_name, app_version::text AS column_value, 'Versão do aplicativo que o motorista está utilizando' AS description 
    FROM drivers WHERE id = 14346 AND app_version IS NOT NULL
    UNION ALL
    SELECT 'qualified_at' AS column_name, qualified_at::text AS column_value, 'Data em que o motorista foi qualificado' AS description 
    FROM drivers WHERE id = 14346 AND qualified_at IS NOT NULL
    UNION ALL
    SELECT 'referred_by' AS column_name, referred_by::text AS column_value, 'Identificador do usuário que indicou o motorista' AS description 
    FROM drivers WHERE id = 14346 AND referred_by IS NOT NULL
    UNION ALL
    SELECT 'reset_password_code' AS column_name, reset_password_code::text AS column_value, 'Código usado para redefinição de senha' AS description 
    FROM drivers WHERE id = 14346 AND reset_password_code IS NOT NULL
    UNION ALL
    SELECT 'id' AS column_name, id::text AS column_value, 'Identificador único do motorista' AS description FROM drivers WHERE id = 14346 AND id IS NOT NULL
    UNION ALL
    SELECT 'idade' AS column_name, EXTRACT(YEAR FROM AGE(now(), birthday))::text AS column_value, 'Idade do motorista' AS description FROM drivers WHERE id = 14346 AND birthday IS NOT NULL
    UNION ALL
    SELECT 'cidade' AS column_name, city::text AS column_value, 'Cidade onde o motorista está registrado' AS description FROM drivers WHERE id = 14346 AND city IS NOT NULL
    UNION ALL
    SELECT 'estado' AS column_name, state::text AS column_value, 'Estado onde o motorista está registrado' AS description FROM drivers WHERE id = 14346 AND state IS NOT NULL
    UNION ALL
    SELECT 'nivel_formacao' AS column_name, schooling::text AS column_value, 'Nível de formação do motorista' AS description FROM drivers WHERE id = 14346 AND schooling IS NOT NULL
    UNION ALL
    SELECT 'genero' AS column_name, gender::text AS column_value, 'Gênero do motorista' AS description FROM drivers WHERE id = 14346 AND gender IS NOT NULL
    UNION ALL
    SELECT 'status' AS column_name, drivers_status(status)::text AS column_value, 'Status do motorista (ativo, inativo, etc.)' AS description FROM drivers WHERE id = 14346 AND status IS NOT NULL
    UNION ALL
    SELECT 'situacao' AS column_name, drivers_situation_enum(situation_enum)::text AS column_value, 'Situação do motorista' AS description FROM drivers WHERE id = 14346 AND situation_enum IS NOT NULL
   	UNION ALL 
	SELECT 'Motorista aou Ajudante' AS column_name, 
	        CASE 
	            WHEN service_supplier  = 0 THEN 'Motorista' 
	            WHEN service_supplier = 1 THEN 'Ajudante' 
	            ELSE 'Desconhecido' 
	        END AS column_value, 
	        'Função do motorista (Motorista ou Ajudante)' AS description 
	FROM drivers WHERE id = 14346 AND service_supplier IS NOT null
    
    
    
    WITH qualified_freights AS (
    SELECT 
        f.driver_id,
        f.company_id,
        d.qualified_at,
        f.end_at,
        f.price / 100 AS price,
        CASE 
            WHEN drivers_situation_enum(d.situation_enum) IN ('Rodando', 'Indisponível temporariamente', 'Disponível') THEN 'Active'
            WHEN drivers_situation_enum(d.situation_enum) = 'Indisponível' THEN 'Churn'
        END AS status,
        freights_type(f.type) AS type,
        FLOOR(EXTRACT(EPOCH FROM (f.end_at - d.qualified_at)) / (60 * 60 * 24 * 7)) AS weeks_from_qualification_to_end
    FROM freights f
    JOIN drivers d ON d.id = f.driver_id
    WHERE f.status = 300
      AND d.qualified_at IS NOT NULL
      AND d.qualified_at >= CURRENT_DATE - INTERVAL '1 year'
      AND drivers_situation_enum(d.situation_enum) IN ('Indisponível', 'Indisponível temporariamente', 'Disponível', 'Rodando')
)
SELECT
    q.type,
    q.status,
    q.driver_id,
    q.weeks_from_qualification_to_end AS week,
    COUNT(*) OVER (
        PARTITION BY q.driver_id 
        ORDER BY q.weeks_from_qualification_to_end 
        ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW
    ) AS total_contracts_until_week,
    SUM(q.price) OVER (
        PARTITION BY q.driver_id 
        ORDER BY q.weeks_from_qualification_to_end 
        ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW
    ) AS total_value_until_week
FROM qualified_freights q
ORDER BY q.driver_id, week;
with nao_comparecimento as (
select driver_behavior_occurrence.driver_id, 
driver_behavior_occurrence_types.driver_behavior_occurrence_id,
driver_behavior_occurrence_types.created_at as created_at,
lead(driver_behavior_occurrence_types.created_at ) over (partition by driver_id order by driver_behavior_occurrence_types.created_at ) as next_created_at
FROM driver_behavior_occurrence_types
join driver_behavior_occurrence on driver_behavior_occurrence.id = driver_behavior_occurrence_id
where driver_behavior_occurrence_type_id in (9,23)
),
dias_agenciados as (
SELECT f.driver_id, 
created_at
FROM freights f
left join kpi_contracts kc on kc.freight_id = f.id
WHERE f.status = 300
),
dias_agenciados_apos_nao_comparecimento as (
select 
n.driver_id,
n.created_at,
count(d.created_at) as dias_agenciados_apos_nao_comparecimento
from 
nao_comparecimento n
left join 
dias_agenciados d 
on 
n.driver_id = d.driver_id 
and
((d.created_at > n.created_at and d.created_at < n.next_created_at) or (d.created_at > n.created_at and n.next_created_at is null))
group by 
n.driver_id, n.created_at
order by driver_id
),
nao_comparecimento_descontado as (
select dias_agenciados_apos_nao_comparecimento.*,
dias_agenciados_apos_nao_comparecimento.dias_agenciados_apos_nao_comparecimento / 32.8 as nao_comparecimento_a_descontar,
GREATEST(0, (1-dias_agenciados_apos_nao_comparecimento.dias_agenciados_apos_nao_comparecimento / 32.8)) as nao_comparecimento_corrigido
from dias_agenciados_apos_nao_comparecimento 
order by dias_agenciados_apos_nao_comparecimento.driver_id, dias_agenciados_apos_nao_comparecimento.created_at
),
nao_comparecimento_contagem as (
select driver_id,
sum(nao_comparecimento_corrigido) as nao_comparecimento_contagem
from nao_comparecimento_descontado
group by driver_id
)
select * from nao_comparecimento_descontado




select d.id driver_id,
coalesce(sum( o.total_price::float / 100) filter ( where di.status <> 'paid' ), 0) as valor_pendente
from drivers d
join discounts di on d.id = di.driver_id
join occurrences o on di.occurrence_id = o.id
where o.type = 5
and exists (select 1 from occurrence_analyzes c1 where c1.occurrence_id = o.id and status = 1)
group by d.id
order by valor_pendente desc




WITH driver_start AS (
  SELECT 
    driver_id,
    DATE_TRUNC('month', MIN(start_at)) AS first_month
  FROM freights
  WHERE status = 300
  and freights_type("type") = 'Diária'
  GROUP BY driver_id
),
contracts_with_month AS (
  SELECT 
    f.driver_id,
    f.start_at,
    -- Calcula a diferença em meses entre o mês do contrato e o mês inicial do motorista.
    (DATE_PART('year', f.start_at) * 12 + DATE_PART('month', f.start_at)) -
    (DATE_PART('year', ds.first_month) * 12 + DATE_PART('month', ds.first_month)) AS activity_month
  FROM freights f
  JOIN driver_start ds 
    ON f.driver_id = ds.driver_id
  WHERE f.status = 300
  and freights_type("type") = 'Diária'
),
contracts_by_driver AS (
  SELECT 
    driver_id,
    activity_month,
    COUNT(*) AS contracts_count
  FROM contracts_with_month
  GROUP BY driver_id, activity_month
)
SELECT 
  activity_month,
  AVG(contracts_count) AS avg_contracts_per_month
FROM contracts_by_driver
GROUP BY activity_month
ORDER BY activity_month;select created_at, company_id, contract_days from freights f select 
f.id as freight_id,
f.price / 100 as value,
coalesce (d.value / 100, 0) as discount,
pa.amount / 100 as adiantamento
from freights f 
left join discounts d on d.freight_id = f.id
left join freights_payment_orders pa on pa.freight_id = f.id
where freight_payment_orders_status(pa.status) = 'Pago'
WITH documentos AS (
    SELECT 
        driver_id,
        MAX(CASE WHEN type = 1 THEN 'Sim' ELSE 'Não' END) AS enviou_documento_CNH,
        MAX(CASE WHEN type = 2 THEN 'Sim' ELSE 'Não' END) AS enviou_documento_Comprovante_de_Residencia,
        MAX(CASE WHEN type = 3 THEN 'Sim' ELSE 'Não' END) AS enviou_documento_Selfie,
        MAX(CASE WHEN type = 4 THEN 'Sim' ELSE 'Não' END) AS enviou_documento_Experiencia,
        CASE 
            WHEN MAX(CASE WHEN type = 1 THEN 1 ELSE 0 END) = 1
            AND MAX(CASE WHEN type = 2 THEN 1 ELSE 0 END) = 1
            AND MAX(CASE WHEN type = 3 THEN 1 ELSE 0 END) = 1
            AND MAX(CASE WHEN type = 4 THEN 1 ELSE 0 END) = 1
            THEN 'Sim'
            ELSE 'Não'
        END AS enviou_todos_os_documentos
    FROM 
        lead_documents
    GROUP BY 
        driver_id
)
SELECT 
    CONCAT(
        'Descrição do relatório: ', 'Documentos enviados até agora para validação da PX', '\n',
        'ID do Motorista: ', COALESCE(documentos.driver_id::text, 'Não disponível'), '\n',
        'Enviou CNH: ', COALESCE(documentos.enviou_documento_CNH, 'Não disponível'), '\n',
        'Enviou Comprovante de Residência: ', COALESCE(documentos.enviou_documento_Comprovante_de_Residencia, 'Não disponível'), '\n',
        'Enviou Selfie: ', COALESCE(documentos.enviou_documento_Selfie, 'Não disponível'), '\n',
        'Enviou Experiência: ', COALESCE(documentos.enviou_documento_Experiencia, 'Não disponível'), '\n',
        'Enviou Todos os Documentos: ', COALESCE(documentos.enviou_todos_os_documentos, 'Não disponível'), '\n'
    ) AS report
FROM documentos
WHERE documentos.driver_id = 14346
LIMIT 10;
WITH documentos AS (
    SELECT 
        driver_id,
        MAX(CASE WHEN type = 1 THEN 'Sim' ELSE 'Não' END) AS enviou_documento_CNH,
        MAX(CASE WHEN type = 2 THEN 'Sim' ELSE 'Não' END) AS enviou_documento_Comprovante_de_Residencia,
        MAX(CASE WHEN type = 3 THEN 'Sim' ELSE 'Não' END) AS enviou_documento_Selfie,
        MAX(CASE WHEN type = 4 THEN 'Sim' ELSE 'Não' END) AS enviou_documento_Experiencia,
        CASE 
            WHEN MAX(CASE WHEN type = 1 THEN 1 ELSE 0 END) = 1
            AND MAX(CASE WHEN type = 2 THEN 1 ELSE 0 END) = 1
            AND MAX(CASE WHEN type = 3 THEN 1 ELSE 0 END) = 1
            AND MAX(CASE WHEN type = 4 THEN 1 ELSE 0 END) = 1
            THEN 'Sim'
            ELSE 'Não'
        END AS enviou_todos_os_documentos
    FROM 
        lead_documents
    GROUP BY 
        driver_id
)
SELECT 
    CONCAT(
        'ID do Motorista: ', COALESCE(documentos.driver_id::text, 'Não disponível'), '\n',
        'Enviou CNH: ', COALESCE(documentos.enviou_documento_CNH, 'Não disponível'), '\n',
        'Enviou Comprovante de Residência: ', COALESCE(documentos.enviou_documento_Comprovante_de_Residencia, 'Não disponível'), '\n',
        'Enviou Selfie: ', COALESCE(documentos.enviou_documento_Selfie, 'Não disponível'), '\n',
        'Enviou Experiência: ', COALESCE(documentos.enviou_documento_Experiencia, 'Não disponível'), '\n',
        'Enviou Todos os Documentos: ', COALESCE(documentos.enviou_todos_os_documentos, 'Não disponível'), '\n'
    ) AS report
FROM documentos
WHERE documentos.driver_id = 14346
LIMIT 10;
WITH drivers_data AS (
    SELECT 
        d.id,
        d.name,
        d.gender,
        d.birthday,
        EXTRACT(YEAR FROM age(d.birthday)) AS age_years
    FROM drivers d
    WHERE d.status = 4
AND d.situation_enum <> 2
AND d.service_supplier = 0
AND EXTRACT(YEAR FROM age(d.birthday)) >= 18
),
drivers_add AS (
    SELECT 
        da.driver_id,
        da.latitude AS latitude,
        da.longitude AS longitude
    FROM driver_addresses da
    where da.type = 0
    AND da.latitude IS NOT NULL
AND da.longitude IS NOT NULL
),
drivers_clt AS (
    SELECT
        de.driver_id,
        SUM(EXTRACT(EPOCH FROM (de.finalized_date_at - de.started_date_at)) / (365.25 * 24 * 3600)) AS total_clt_experience_in_years
    FROM driver_experiences de
    GROUP BY de.driver_id
),
drivers_supply as (
SELECT 
driver_id,
array_agg(DISTINCT supplies.reference_id) as supply_experience
FROM driver_supply_px_experiences
INNER JOIN supplies ON supplies.id = driver_supply_px_experiences.supply_id
group by driver_id 
),
driver_vehicle as (
SELECT driver_id, 
max(v1.complexity_level) as driver_vehicle_experience
        FROM driver_vehicle_px_experiences dve
        INNER JOIN vehicles AS v1 ON dve.vehicle_id = v1.id
group by dve.driver_id 
)
SELECT dd.id as driver_id,
coalesce(driver_vehicle_experience,0) as vehicle_id,
coalesce(dc.total_clt_experience_in_years, 0) as years_experience,
coalesce(ds.supply_experience,'{}') as supply_experience,
dd.age_years as age_group,
dd.gender,
da.latitude,
da.longitude
FROM drivers_data dd
LEFT JOIN drivers_add da ON dd.id = da.driver_id
LEFT JOIN drivers_clt dc ON dd.id = dc.driver_id
left join drivers_supply ds on ds.driver_id = dd.id
left join driver_vehicle de on de.driver_id = dd.id
with ocorrencias as (
select
dbo.created_at as occurence_create,
f.start_at as contract_start,
dbo.driver_id,
dbo.contract_id,
dbot.description,
dbo.occurrence_status as observation
from driver_behavior_occurrence dbo
left join driver_behavior_occurrence_types dbots on dbots.driver_behavior_occurrence_id = dbo.id
left join driver_behavior_occurrence_type dbot on dbot.id = dbots.driver_behavior_occurrence_type_id
left join freights f on f.id = dbo.contract_id 
where dbo.occurrence_status = 'finished'
and dbot.description <> 'Pico de velocidade'
AND dbo.created_at >= CURRENT_DATE - INTERVAL '1 year'
order by dbo.driver_id asc, dbo.created_at asc
),
dias_agenciados as (
select 
f.end_at  as occurence_create,
f.start_at  as contract_start,
f.driver_id,
f.id as contract_id,
'Dia agenciado' as description,
cast(f.contract_days as TEXT) as observation
from freights f
where f.status = 300
AND f.end_at  >= CURRENT_DATE - INTERVAL '1 year'
order by f.driver_id asc, f.start_at  asc
),
resultado as (
select * from ocorrencias
union all
select * from dias_agenciados
)
select * from resultado r
order by r.driver_id asc, r.occurence_create  asc
select
d.id as driver_id,
s.name
from drivers d 
join driver_addresses da on da.driver_id = d.id
join states s on s.id = da.state_id 
-- OK company_id
-- OK Saldo em conta 
-- OK Número de contratos finalizados
-- OK Número de contratos cancelados
-- OK Número de não comparecimentos 
-- OK Número de candidatos
-- OK Número de multas
-- OK Número de sinistros
-- OK Valor em contratos
-- OK Dias agenciados
-- OK Frequencia dos contratos
-- OK Ocorrencias comportamentais
-- OK Dias desde o último contrato
-- OK tempo px
-- OK Churn(12 meses sem lançar contrato)

with transportadoras as ( 
select id as company_id,
companies_client_status(client_status) as status
from companies
),
saldo as (
select company_id as company_id,
value / 100 as saldo
from company_balances 
),
contratos_finalizados as (
select company_id, 
count(status) as contagem
from freights
where  status = 300
group by company_id 
), 
contratos_cancelados as (
select company_id, 
count(status) as contagem
from freights
where  status = 900
group by company_id 
),
nao_comparecimentos as (
select freights.company_id, 
count(*) as contagem
from driver_behavior_occurrence
join freights on freights.id = driver_behavior_occurrence.contract_id 
join driver_behavior_occurrence_types on driver_behavior_occurrence_types.driver_behavior_occurrence_id = driver_behavior_occurrence.id 
where driver_behavior_occurrence_type_id = 23 or driver_behavior_occurrence_type_id = 9
group by freights.company_id
),candidatos as (
select  
freights.company_id,
count(dfh.candidate_at) as contagem
from driver_freight_history dfh 
join freights on freights.id = dfh.freight_id
group by freights.company_id
),
multas as (
select
occurrences.company_id,
count(*) as contagem
from
occurrence_analyzes
left join occurrences on occurrences.id = occurrence_analyzes.occurrence_id
where occurrence_analyzes.status = 1
group by occurrences.company_id
),
sinistros as (
select 
company_id , 
count(distinct id) as contagem
from occurrences
where type != 5
group by company_id
),
valor_contratos as (
select 
company_id, 
sum(price / 100) as valor
from freights
group by company_id
),
dias_agenciados as (
SELECT f.company_id , 
SUM(kc.days) AS contagem
FROM freights f 
left join kpi_contracts kc  on kc.freight_id  = f.id
WHERE f.status = 300
GROUP BY f.company_id
),
frequencia_contratos as (
select 
company_id as company_id,
extract (days from (now() - min(created_at) ) / count(created_at)) as frequencia
from freights 
group by company_id 
),
ocorrencias_comportamentais as (
select freights.company_id, 
count(*) as contagem
from driver_behavior_occurrence
join freights on freights.id = driver_behavior_occurrence.contract_id 
join driver_behavior_occurrence_types on driver_behavior_occurrence_types.driver_behavior_occurrence_id = driver_behavior_occurrence.id 
where driver_behavior_occurrence_type_id not in (23,9)
group by freights.company_id
),tempo_px as (
select 
company_id as company_id,
extract (days from (max(created_at) - min(created_at) )) as tempo
from freights 
group by company_id 
),ultimo_contrato as (
select 
company_id as company_id,
extract (days from (now() - max(created_at) )) as tempo
from freights 
where status = 300
group by company_id
),
dias_agenciados_media_30 as (
SELECT f.company_id, 
avg(kc.days) AS media
FROM freights f 
left join kpi_contracts kc  on kc.freight_id  = f.id
WHERE f.status = 300 and
extract (days from (now() - created_at)) < 30
GROUP BY f.company_id
),
dias_agenciados_media_60 as (
SELECT f.company_id, 
avg(kc.days) AS media
FROM freights f 
left join kpi_contracts kc  on kc.freight_id  = f.id
WHERE f.status = 300 and
extract (days from (now() - created_at)) < 60
GROUP BY f.company_id
)
select transportadoras.company_id,
transportadoras.status as status,
saldo.saldo as saldo,
contratos_finalizados.contagem as contratos_finalizados,
COALESCE(contratos_cancelados.contagem,0) as contratos_cancelados,
COALESCE(nao_comparecimentos.contagem,0) / COALESCE(dias_agenciados.contagem,1) as nao_comparecimentos,
COALESCE(candidatos.contagem,0) as candidaturas,
COALESCE(multas.contagem,0) / COALESCE(dias_agenciados.contagem,1) as multas,
COALESCE(sinistros.contagem,0) / COALESCE(dias_agenciados.contagem,1) as sinistros,
COALESCE(dias_agenciados.contagem,0) as dias_agenciados,
frequencia_contratos.frequencia as frequencia_contratos,
COALESCE(ocorrencias_comportamentais.contagem,0) / COALESCE(dias_agenciados.contagem,1) as ocorrencias_comportamentais,
tempo_px.tempo as tempo_px,
COALESCE(dias_agenciados_media_30.media,0) as dias_agenciados_media_30,
COALESCE(dias_agenciados_media_60.media,0) as dias_agenciados_media_60,
(COALESCE(dias_agenciados_media_30.media,0) - COALESCE(dias_agenciados_media_60.media,0)) /COALESCE(dias_agenciados_media_60.media,1) * 100 as variação_media_dias_agenciados,
ultimo_contrato.tempo as ultimo_contrato
from transportadoras
left join saldo on saldo.company_id = transportadoras.company_id
left join contratos_finalizados on contratos_finalizados.company_id = transportadoras.company_id
left join contratos_cancelados on contratos_cancelados.company_id = transportadoras.company_id
left join nao_comparecimentos on nao_comparecimentos.company_id = transportadoras.company_id
left join candidatos on candidatos.company_id = transportadoras.company_id
left join multas on multas.company_id = transportadoras.company_id
left join sinistros on sinistros.company_id = transportadoras.company_id
left join dias_agenciados on dias_agenciados.company_id = transportadoras.company_id
left join frequencia_contratos on frequencia_contratos.company_id = transportadoras.company_id
left join ocorrencias_comportamentais on ocorrencias_comportamentais.company_id = transportadoras.company_id
left join tempo_px on tempo_px.company_id = transportadoras.company_id
left join ultimo_contrato on ultimo_contrato.company_id = transportadoras.company_id
left join dias_agenciados_media_30 on dias_agenciados_media_30.company_id = transportadoras.company_id
left join dias_agenciados_media_60 on dias_agenciados_media_60.company_id = transportadoras.company_id
where dias_agenciados.contagem > 0-- OK company_id
-- OK Saldo em conta 
-- OK Número de contratos finalizados
-- OK Número de contratos cancelados
-- OK Número de não comparecimentos 
-- OK Número de candidatos
-- OK Número de multas
-- OK Número de sinistros
-- OK Valor em contratos
-- OK Dias agenciados
-- OK Frequencia dos contratos
-- OK Ocorrencias comportamentais
-- OK Dias desde o último contrato
-- OK tempo px
-- OK Churn(12 meses sem lançar contrato)

with transportadoras as ( 
select id as company_id,
companies_client_status(client_status) as status
from companies
),
saldo as (
select company_id as company_id,
value / 100 as saldo
from company_balances 
),
contratos_finalizados as (
select company_id, 
count(status) as contagem
from freights
where  status = 300
group by company_id 
), 
contratos_cancelados as (
select company_id, 
count(status) as contagem
from freights
where  status = 900
group by company_id 
),
nao_comparecimentos as (
select freights.company_id, 
count(*) as contagem
from driver_behavior_occurrence
join freights on freights.id = driver_behavior_occurrence.contract_id 
join driver_behavior_occurrence_types on driver_behavior_occurrence_types.driver_behavior_occurrence_id = driver_behavior_occurrence.id 
where driver_behavior_occurrence_type_id = 23 or driver_behavior_occurrence_type_id = 9
group by freights.company_id
),candidatos as (
select  
freights.company_id,
count(dfh.candidate_at) as contagem
from driver_freight_history dfh 
join freights on freights.id = dfh.freight_id
group by freights.company_id
),
multas as (
select
occurrences.company_id,
count(*) as contagem
from
occurrence_analyzes
left join occurrences on occurrences.id = occurrence_analyzes.occurrence_id
where occurrence_analyzes.status = 1
group by occurrences.company_id
),
sinistros as (
select 
company_id , 
count(distinct id) as contagem
from occurrences
where type != 5
group by company_id
),
valor_contratos as (
select 
company_id, 
sum(price / 100) as valor
from freights
group by company_id
),
dias_agenciados as (
SELECT f.company_id , 
SUM(kc.days) AS contagem
FROM freights f 
left join kpi_contracts kc  on kc.freight_id  = f.id
WHERE f.status = 300
GROUP BY f.company_id
),
frequencia_contratos as (
select 
company_id as company_id,
coalesce(count(created_at) / nullif(extract (days from (max(created_at) - min(created_at))),0),0) as frequencia
from freights 
group by company_id 
),
ocorrencias_comportamentais as (
select freights.company_id, 
count(*) as contagem
from driver_behavior_occurrence
join freights on freights.id = driver_behavior_occurrence.contract_id 
join driver_behavior_occurrence_types on driver_behavior_occurrence_types.driver_behavior_occurrence_id = driver_behavior_occurrence.id 
where driver_behavior_occurrence_type_id not in (23,9)
group by freights.company_id
),
tempo_px as (
select 
company_id as company_id,
1+extract (days from (max(created_at) - min(created_at) )) as tempo
from freights 
group by company_id 
),ultimo_contrato as (
select 
company_id as company_id,
extract (days from (now() - max(created_at) )) as tempo
from freights 
where status = 300
group by company_id
),
contagem_contratos as (
select company_id,
count(*) as contagem
from freights 
group by company_id
),
contagem_visualizacao as (
select freights.company_id, 
sum(dfhs.count_visit) as contagem
from driver_freight_history_summary dfhs 
left join freights on freights.id = dfhs.freight_id
group by freights.company_id 
),
contratos_tipo as (
select company_id,
count(*) filter (where "type"='0') as contratos_viagem,
count(*) filter (where "type"='1') as contratos_diaria,
count(*) filter (where "type"='2') as contratos_ajudante,
count(*) filter (where "type"='3') as contratos_coleta_entrega
from freights
group by company_id
),
motoristas_removidos as (
select company_id, 
count(distinct freight_id ) as contagem
from freight_driver_removals fdr
join freights on freights.id = fdr.freight_id 
group by company_id
),
usuarios as (
select id as company_id, 
user_id, analyst_success_id, success_manager_id from companies
)
select transportadoras.company_id,
transportadoras.status as status,
saldo.saldo as saldo,
contratos_finalizados.contagem as contratos_finalizados,
COALESCE(contratos_cancelados.contagem,0) as contratos_cancelados,
COALESCE(nao_comparecimentos.contagem,0) as nao_comparecimentos,
COALESCE(candidatos.contagem,0) as candidaturas,
COALESCE(multas.contagem,0) as multas,
COALESCE(sinistros.contagem,0) as sinistros,
COALESCE(dias_agenciados.contagem,0) as dias_agenciados,
frequencia_contratos.frequencia as frequencia_contratos,
COALESCE(ocorrencias_comportamentais.contagem,0) as ocorrencias_comportamentais,
tempo_px.tempo as tempo_px,
ultimo_contrato.tempo as ultimo_contrato,
COALESCE(contagem_contratos.contagem,0) as contratos,
COALESCE(contagem_visualizacao.contagem,0) as visualizacao,
COALESCE(contratos_tipo.contratos_viagem,0) as contratos_viagem,
COALESCE(contratos_tipo.contratos_diaria,0) as contratos_diaria,
COALESCE(contratos_tipo.contratos_ajudante,0) as contratos_ajudante,
COALESCE(contratos_tipo.contratos_coleta_entrega,0) as contratos_coleta_entrega,
COALESCE(motoristas_removidos.contagem,0) as motoristas_removidos,
COALESCE(usuarios.user_id,0) as user_id, 
COALESCE(usuarios.analyst_success_id,0) as analyst_success_id, 
COALESCE(usuarios.success_manager_id,0) as success_manager_id
from transportadoras
left join saldo on saldo.company_id = transportadoras.company_id
left join contratos_finalizados on contratos_finalizados.company_id = transportadoras.company_id
left join contratos_cancelados on contratos_cancelados.company_id = transportadoras.company_id
left join nao_comparecimentos on nao_comparecimentos.company_id = transportadoras.company_id
left join candidatos on candidatos.company_id = transportadoras.company_id
left join multas on multas.company_id = transportadoras.company_id
left join sinistros on sinistros.company_id = transportadoras.company_id
left join dias_agenciados on dias_agenciados.company_id = transportadoras.company_id
left join frequencia_contratos on frequencia_contratos.company_id = transportadoras.company_id
left join ocorrencias_comportamentais on ocorrencias_comportamentais.company_id = transportadoras.company_id
left join tempo_px on tempo_px.company_id = transportadoras.company_id
left join ultimo_contrato on ultimo_contrato.company_id = transportadoras.company_id
left join contagem_contratos on contagem_contratos.company_id = transportadoras.company_id
left join contagem_visualizacao on contagem_visualizacao.company_id = transportadoras.company_id
left join contratos_tipo on contratos_tipo.company_id = transportadoras.company_id
left join motoristas_removidos on motoristas_removidos.company_id = transportadoras.company_id
left join usuarios on usuarios.company_id = transportadoras.company_id
where dias_agenciados.contagem > 0



with desvio as (
select "group", 
stddev(score) as desvio
from driver_score_compositions dsc
group by "group" 
),
media as (
select "group", 
avg(score)  as media
from driver_score_compositions dsc
group by "group" 
)
,
scores as (
select * from driver_score_compositions
),
espalhamento as (
select 
driver_id,
max(score) - min(score) as espalhamento
from driver_score_compositions
where created_at > '2024-06-08'
group by driver_id
)
select scores.*,
desvio.desvio as desvio,
media.media as media,
espalhamento.espalhamento as espalhamento
from scores
left join desvio on desvio.group = scores.group
left join media on media.group = scores.group
left join espalhamento on espalhamento.driver_id = scores.driver_id
where scores.created_at > '2024-06-08'
order by scores.driver_id desc


with motoristas as (
SELECT 
id as driver_id,
created_at,
qualified_at
FROM drivers 
where status not in (0,1,2,3,6,7)
), 
viagens_contagem as (
select 
driver_id , count(*) as contagem
from freights
where status = 300
group by driver_id
),
nao_comparecimento_contagem as (
select driver_behavior_occurrence.driver_id, count(distinct driver_behavior_occurrence_types.driver_behavior_occurrence_id) as contagem
FROM driver_behavior_occurrence_types
join driver_behavior_occurrence on driver_behavior_occurrence.id = driver_behavior_occurrence_id
where driver_behavior_occurrence_type_id = 23 or driver_behavior_occurrence_type_id = 9
group by driver_behavior_occurrence.driver_id
),
multa_valor as (
select
driver_id,
sum(occurrences.total_price )/100 as multa_valor
from
occurrence_analyzes
left join occurrences on occurrences.id = occurrence_analyzes.occurrence_id 
where occurrence_analyzes.status = 1
group by driver_id
),
cursos_contagem as (
SELECT driver_id, count(distinct driver_courses.course_id) as contagem
FROM driver_courses
where driver_courses.expired_at > now()
group by driver_id
),
ocorrencias_comportamentais_contagem as(
select driver_behavior_occurrence.driver_id, count(distinct driver_behavior_occurrence_types.driver_behavior_occurrence_id) as contagem
FROM driver_behavior_occurrence_types
join driver_behavior_occurrence on driver_behavior_occurrence.id = driver_behavior_occurrence_id
where driver_behavior_occurrence_type_id not in (23,9)
group by driver_behavior_occurrence.driver_id
),
sinistro_contagem as (
select 
driver_id, count(distinct id) as contagem
from occurrences
where type != 5
group by driver_id
),
rodando as (
select driver_id,
1 as rodando
from freights
where status between  220 and 280
), 
toxicologico as (
select
driver_id,
12 - extract (epoch from (now() - dc.issued_at)) / 2.628e+6 as tempo_decorrido
from drivers d
left join driver_courses dc on dc.driver_id = d.id and 
dc.course_id = 31
where d.status in (3,4,5) and d.situation_enum in (0,1,3)
),
sinistros as(
select d.id driver_id,
       count(distinct di.id) quantidade_total,
       count(distinct di.id) filter ( where di.status = 'paid' ) quantidade_pagos
from drivers d
left join discounts di on d.id = di.driver_id and di.status <> 'rejected'
left join occurrences o on di.occurrence_id = o.id
where d.status in (3,4,5) and d.situation_enum in (0,1,3)
group by d.id
),
adiantamentos_indevidos as (
select driver_id, count(*) as contagem from discounts where type= 4 group by driver_id
),
quantidade_empresas as (
SELECT driver_id, COUNT(DISTINCT company_id) AS contagem
FROM freights
WHERE status = 300
GROUP BY driver_id
),
quantidade_dias_agenciados as (
SELECT f.driver_id, SUM(kc.days) AS contagem
FROM freights f 
left join kpi_contracts kc  on kc.freight_id  = f.id
WHERE f.status = 300
GROUP BY f.driver_id
),
meses_contagem as (
SELECT driver_id, 
EXTRACT(MONTH FROM AGE(NOW(), qualified_at)) + EXTRACT(YEAR FROM AGE(NOW(), qualified_at)) * 12 AS meses_desde_criacao
FROM motoristas
),
quantidade_empresas_CLT as (
SELECT driver_id, COUNT(company) AS contagem
FROM driver_experiences
GROUP BY driver_id
),
empresas_CLT_duracao as (
SELECT driver_id,
sum(EXTRACT(YEAR FROM AGE(CAST(finalized_date_at AS DATE), CAST(started_date_at AS DATE))) * 12 +
EXTRACT(MONTH FROM AGE(CAST(finalized_date_at AS DATE), CAST(started_date_at AS DATE)))) AS duracao
FROM driver_experiences
group by driver_id
),
habitualidade as (
select driver_id, score
from habituality_scores
habituality_scores
),
ajudante as (
select id as driver_id, 
service_supplier as ajudante
from drivers 
where status > 3
),
ultima_viagem as (
select driver_id , 
EXTRACT(EPOCH FROM (NOW() - MAX(created_at))/86400)::FLOAT  as ultima_viagem
from freights f 
where f.status = 300
group by driver_id
),
valor_viagem_total as (
select driver_id,
sum(price /100 )
from freights f
where f.status = 300
group by driver_id
),
resultado as (
select motoristas.driver_id, 
viagens_contagem.contagem as viagens_contagem,
nao_comparecimento_contagem.contagem as nao_comparecimento_contagem,
multa_valor.multa_valor as multa_valor,
cursos_contagem.contagem as cursos_contagem,
ocorrencias_comportamentais_contagem.contagem as ocorrencias_comportamentais_contagem,
sinistro_contagem.contagem  as sinistro_contagem,
toxicologico.tempo_decorrido as toxicologico,
sinistros.quantidade_pagos as sinistros_quantidade_pagos,
sinistros.quantidade_total as sinistros_quantidade_total,
adiantamentos_indevidos.contagem as adiantamentos_indevidos_contagem,
quantidade_empresas.contagem as quantidade_empresas,
quantidade_dias_agenciados.contagem as quantidade_dias_agenciados,
meses_contagem.meses_desde_criacao as meses_contagem,
quantidade_dias_agenciados.contagem::FLOAT  / NULLIF(meses_contagem.meses_desde_criacao::FLOAT,0) as recorrência,
quantidade_empresas_CLT.contagem as quantidade_empresas_CLT,
empresas_CLT_duracao.duracao as empresas_CLT_duracao,
empresas_CLT_duracao.duracao::FLOAT / NULLIF(quantidade_empresas_CLT.contagem::FLOAT, 0) AS empresas_CLT_duracao_media,
habitualidade.score as habitualidade,
ajudante.ajudante as ajudante,
ultima_viagem.ultima_viagem::FLOAT  as ultima_viagem,
valor_viagem_total.sum as valor_viagem_total,
rodando.rodando as rodando
from motoristas
left join viagens_contagem on viagens_contagem.driver_id = motoristas.driver_id
left join nao_comparecimento_contagem on nao_comparecimento_contagem.driver_id = motoristas.driver_id
left join multa_valor on multa_valor.driver_id = motoristas.driver_id
left join cursos_contagem on cursos_contagem.driver_id = motoristas.driver_id
left join ocorrencias_comportamentais_contagem on ocorrencias_comportamentais_contagem.driver_id = motoristas.driver_id
left join sinistro_contagem on sinistro_contagem.driver_id = motoristas.driver_id
left join toxicologico on toxicologico.driver_id = motoristas.driver_id
left join sinistros on sinistros.driver_id = motoristas.driver_id
left join adiantamentos_indevidos on adiantamentos_indevidos.driver_id = motoristas.driver_id
left join quantidade_empresas on quantidade_empresas.driver_id = motoristas.driver_id
left join quantidade_dias_agenciados on quantidade_dias_agenciados.driver_id = motoristas.driver_id
left join meses_contagem on meses_contagem.driver_id = motoristas.driver_id
left join quantidade_empresas_CLT on quantidade_empresas_CLT.driver_id = motoristas.driver_id
left join empresas_CLT_duracao on empresas_CLT_duracao.driver_id = motoristas.driver_id
left join habitualidade on habitualidade.driver_id = motoristas.driver_id
left join ajudante on ajudante.driver_id = motoristas.driver_id
left join ultima_viagem on ultima_viagem.driver_id = motoristas.driver_id
left join valor_viagem_total on valor_viagem_total.driver_id = motoristas.driver_id
left join rodando on rodando.driver_id = motoristas.driver_id
)
select DISTINCT ON (driver_id) *
from resultado
where empresas_CLT_duracao > 0 and
quantidade_dias_agenciados > 0 and
ultima_viagem <= 90 and
ajudante = 0
order by driver_id






























select count(distinct driver_id)
from resultado
where rodando = 1

-- 1278
-- 1233
-- 1215

select id, status, driver_id from freights where driver_id  = 1066 order by status asc

select * from drivers d 

select driver_id,
sum(price /100 ) as faturamento
from freights f
where f.status = 300
AND f.start_at  BETWEEN NOW() - INTERVAL '3 months' AND NOW()
group by driver_id


select driver_id , # df_score.iloc[0,:] = 0
EXTRACT(EPOCH FROM (NOW() - MAX(created_at))/86400)::FLOAT  as ultima_viagem, 
MAX(created_at)
from freights f 
where f.status = 300
group by driver_id
order by ultima_viagem


select
driver_id,
extract (epoch from (now() - dc.created_at)) / 2.628e+6 as tempo_decorrido
from drivers d
left join driver_courses dc on dc.driver_id = d.id and 
dc.course_id = 31
where d.status in (3,4,5) and d.situation_enum in (0,1,3)

select 
*
from occurrence_traffic_tickets

select * from occurrences

select
driver_id,
occurrences.total_price 
from
occurrence_analyzes
left join occurrences on occurrences.id = occurrence_analyzes.occurrence_id 
where occurrence_analyzes.status = 1

select * from driver_courses

-- 1278
-- 1233

select count(distinct driver_id)
from freights
where status between  220 and 280


--Estado OK
--Categoria CNH OK 
--Idade OK 
--Tipo prestador OK 
--Tempo desde o último contrato OK
--Tempo px ok 
--Frequencia entre contratos ok
--Valor em contratos ok 
--Número de dias agenciados ok 
--Número de Candidaturas ok 
--Número de contratos concluidos ok 
--Número de não comparecimentos ok 
--Média não comparecimentos 14 dias
--Média não comparecimentos 7 dias


with motoristas as(
select id as driver_id,
city,
state,
marital_status,
schooling, 
gender, 
cnh_category,
service_supplier,
extract(days from now() - birthday) / 365 as idade
from drivers
),
ultimo_contrato as (
select driver_id, 
extract (days from (now() - max(created_at))) as tempo
from freights 
group by driver_id 
),
tempo_px as (
select driver_id, 
extract (days from (now() - min(created_at))) as tempo
from freights 
group by driver_id 
),
frequencia_contratos as (
select driver_id, 
extract (days from ( (max(created_at) - min(created_at)) / count(created_at) )) as tempo
from freights 
group by driver_id 
),
valor_em_contratos as (
select driver_id,
sum(price) / 100 as valor_total
from freights
group by driver_id
),
dias_agenciados as (
select driver_id,
sum(contract_days) as dias
from freights
group by driver_id
),
candidaturas as (
select 
freights.driver_id,
count(dfh.candidate_at) as contagem
from driver_freight_history dfh 
join freights on freights.id = dfh.freight_id
group by freights.driver_id 
),
contratos_concluidos as (
select 
freights.driver_id,
count(driver_id) as contagem
from freights
where status = 300
group by freights.driver_id 
),
nao_comparecimentos as (
select driver_id,
count(*) as contagem
from driver_behavior_occurrence
join driver_behavior_occurrence_types on driver_behavior_occurrence_types.driver_behavior_occurrence_id = driver_behavior_occurrence.id
group by driver_id 
),
dados_do_motorista as (
select motoristas.*,
coalesce (ultimo_contrato.tempo, 0) as ultimo_contrato,
coalesce (tempo_px.tempo, 0) as tempo_px,
coalesce (valor_em_contratos.valor_total, 0) as valor_em_contratos,
coalesce (dias_agenciados.dias, 0) as dias_agenciados,
coalesce (candidaturas.contagem, 0) as candidaturas,
coalesce (contratos_concluidos.contagem, 0) as contratos_concluidos,
coalesce (nao_comparecimentos.contagem, 0) as nao_comparecimentos
from motoristas
left join ultimo_contrato on ultimo_contrato.driver_id = motoristas.driver_id
left join tempo_px on tempo_px.driver_id = motoristas.driver_id
left join valor_em_contratos on valor_em_contratos.driver_id = motoristas.driver_id
left join dias_agenciados on dias_agenciados.driver_id = motoristas.driver_id
left join candidaturas on candidaturas.driver_id = motoristas.driver_id
left join contratos_concluidos on contratos_concluidos.driver_id = motoristas.driver_id
left join nao_comparecimentos on nao_comparecimentos.driver_id = motoristas.driver_id
),
contratos_300 as (
select driver_id as driver_id,
id as  contract_id,
0 as status_code,
start_at as start_at
from freights
where status = 300
),
contratos_9_23 as (
select driver_behavior_occurrence.driver_id, 
driver_behavior_occurrence.contract_id,
1 as status_code,
driver_behavior_occurrence.created_at as datetime
FROM driver_behavior_occurrence_types
join driver_behavior_occurrence 
on driver_behavior_occurrence.id = driver_behavior_occurrence_id
where driver_behavior_occurrence_type_id in (23,9)
and driver_behavior_occurrence.contract_id is not null
),
contratos as (
select * from contratos_300
union all
select * from contratos_9_23
),
tipo_contrato as (
select freights_type (f.type) as contract_type,
f.id as contract_id
from freights f  
),
dados_do_contrato as (
select 
contratos.*,
EXTRACT(DOW FROM start_at::DATE) AS day_of_week,
tipo_contrato.contract_type as contract_type
from contratos
left join tipo_contrato on tipo_contrato.contract_id = contratos.contract_id
where start_at > '2023-04-24 08:55:06.000'
)
select dados_do_contrato.status_code,
dados_do_contrato.contract_id,
dados_do_contrato.start_at,
dados_do_contrato.day_of_week,
dados_do_motorista.*
from dados_do_contrato 
left join dados_do_motorista on dados_do_motorista.driver_id = dados_do_contrato.driver_id
where contratos_concluidos > 0
order by contract_id, start_at, driver_id
with motoristas as (
select id as driver_id,
state,
marital_status,
schooling, 
gender, 
cnh_category,
service_supplier,
coalesce(extract(days from now() - birthday), 0) / 365 as idade
from drivers
),
tempo_px as (
select driver_id, 
extract (days from (max(created_at) - min(created_at))) + 1 as tempo
from freights 
group by driver_id 
),
valor_em_contratos as (
select driver_id,
sum(price) / 100 as valor_total
from freights
group by driver_id
),
dias_agenciados as (
select driver_id,
sum(contract_days) as dias
from freights
group by driver_id
),
contratos_finalizados as (
select 
freights.driver_id,
count(driver_id) as contagem
from freights
where status = 300
group by freights.driver_id 
),
contratos as (
select 
freights.driver_id,
count(driver_id)::float as contagem
from freights
group by freights.driver_id 
),
tipo_de_contrato_motorista AS (
select 
f.driver_id as driver_id,
count( case when freights_type (f.type) = 'Diária' then 1 end) as diaria,
count( case when freights_type (f.type) = 'Coleta/Entrega' then 1 end) as coleta_entrega,
count( case when freights_type (f.type) = 'Ajudante' then 1 end) as ajudante
from freights f 
group by driver_id
),
candidaturas as (
select 
freights.driver_id,
count(dfh.candidate_at) as contagem
from driver_freight_history dfh 
join freights on freights.id = dfh.freight_id
group by freights.driver_id 
),
contratos_300 as (
select driver_id as driver_id,
id as  contract_id,
0 as status,
start_at as start_at,
EXTRACT(DOW FROM start_at::DATE) AS day_of_week
from freights
where status = 300
),
contratos_9_23 as (
select driver_behavior_occurrence.driver_id, 
driver_behavior_occurrence.contract_id,
1 as status,
driver_behavior_occurrence.created_at as start_at,
EXTRACT(DOW FROM driver_behavior_occurrence.created_at::DATE) AS day_of_week
FROM driver_behavior_occurrence_types
join driver_behavior_occurrence 
on driver_behavior_occurrence.id = driver_behavior_occurrence_id
where driver_behavior_occurrence_type_id in (23,9)
and driver_behavior_occurrence.contract_id is not null
),
contratos_dados as (
select * from contratos_300
union all
select * from contratos_9_23
)
select motoristas.*,
coalesce (tempo_px.tempo,0) as tempo_px,
coalesce (contratos.contagem,0) as contratos,
coalesce (valor_em_contratos.valor_total,0) as valor_em_contratos,
coalesce (dias_agenciados.dias,0) as dias_agenciados,
coalesce (contratos_finalizados.contagem,0) as contratos_finalizados,
coalesce (tipo_de_contrato_motorista.diaria,0) as diaria,
coalesce (tipo_de_contrato_motorista.coleta_entrega,0) as coleta_entrega,
coalesce (tipo_de_contrato_motorista.ajudante,0) as ajudante,
coalesce (candidaturas.contagem,0) as candidaturas,
coalesce (coalesce (valor_em_contratos.valor_total,0) / tempo_px.tempo,0) frequencia_valor_em_contratos,
coalesce (coalesce (dias_agenciados.dias,0) / tempo_px.tempo,0) as frequencia_dias_agenciados,
coalesce (coalesce (contratos_finalizados.contagem,0) / tempo_px.tempo,0) as frequencia_contratos_finalizados,
coalesce (coalesce (tipo_de_contrato_motorista.diaria,0) / tempo_px.tempo,0) as frequencia_diaria,
coalesce (coalesce (tipo_de_contrato_motorista.coleta_entrega,0) / tempo_px.tempo,0) as frequencia_coleta_entrega,
coalesce (coalesce (tipo_de_contrato_motorista.ajudante,0) / tempo_px.tempo,0) as frequencia_ajudante,
coalesce (coalesce (candidaturas.contagem ,0)/ tempo_px.tempo,0) as frequencia_candidaturas,
coalesce (valor_em_contratos.valor_total,0) / coalesce (contratos.contagem,1) proporcao_valor_em_contratos,
coalesce (dias_agenciados.dias,0) / coalesce (contratos.contagem,1) as proporcao_dias_agenciados,
coalesce (contratos_finalizados.contagem,0) / coalesce (contratos.contagem,1) as proporcao_contratos_finalizados,
coalesce (tipo_de_contrato_motorista.diaria,0) / coalesce (contratos.contagem,1) as proporcao_diaria,
coalesce (tipo_de_contrato_motorista.coleta_entrega,0) / coalesce (contratos.contagem,1) as proporcao_coleta_entrega,
coalesce (tipo_de_contrato_motorista.ajudante,0) / coalesce (contratos.contagem,1) as proporcao_ajudante,
coalesce (candidaturas.contagem,0) / coalesce (contratos.contagem,1) as proporcao_candidaturas,
contratos_dados.day_of_week as day_of_week,
contratos_dados.contract_id as contract_id,
contratos_dados.status as status
from motoristas
left join tempo_px on tempo_px.driver_id = motoristas.driver_id
left join valor_em_contratos on valor_em_contratos.driver_id = motoristas.driver_id
left join dias_agenciados on dias_agenciados.driver_id = motoristas.driver_id
left join contratos_finalizados on contratos_finalizados.driver_id = motoristas.driver_id
left join contratos on contratos.driver_id = motoristas.driver_id
left join tipo_de_contrato_motorista on tipo_de_contrato_motorista.driver_id = motoristas.driver_id
left join candidaturas on candidaturas.driver_id = motoristas.driver_id
join contratos_dados on contratos_dados.driver_id = motoristas.driver_id
where coalesce (contratos.contagem,0) > 0
order by status desc

with contratos_300 as (
select driver_id as driver_id,
id as  contract_id,
status as status_code,
start_at as datetime
from freights
where status = 300
),
contratos_9_23 as (
select driver_behavior_occurrence.driver_id, 
driver_behavior_occurrence.contract_id,
driver_behavior_occurrence_type_id as status_code,
driver_behavior_occurrence.created_at as datetime
FROM driver_behavior_occurrence_types
join driver_behavior_occurrence 
on driver_behavior_occurrence.id = driver_behavior_occurrence_id
where driver_behavior_occurrence_type_id in (23,9)
and driver_behavior_occurrence.contract_id is not null
),
contratos_9_23_estatisticas as (
select driver_behavior_occurrence.driver_id, 
count(driver_behavior_occurrence.driver_id) as num_of_noshows,
extract(day from max(driver_behavior_occurrence.created_at) - min(driver_behavior_occurrence.created_at)) / count(driver_behavior_occurrence.driver_id) as datetime_diff
FROM driver_behavior_occurrence_types
join driver_behavior_occurrence 
on driver_behavior_occurrence.id = driver_behavior_occurrence_id
where driver_behavior_occurrence_type_id in (23,9)
and driver_behavior_occurrence.contract_id is not null
group by driver_behavior_occurrence.driver_id
order by datetime_diff desc
),
contratos as (
select * from contratos_300
union all
select * from contratos_9_23
),
valor as (
select id as contract_id,
price / 100 as price
from freights 
),
tipo_contrato as (
select freights_type (f.type) as contract_type,
f.id as contract_id
from freights f  
),
dias_contrato as (
select sum(kc.days)  as num_of_days,
kc.freight_id  as contract_id
from kpi_contracts kc
group by kc.freight_id 
),
motoristas AS (
SELECT id as driver_id,
state,
city,
marital_status,
schooling, 
gender, 
cnh_category,
service_supplier,
EXTRACT(YEAR FROM AGE(NOW(), birthday)) as age
FROM drivers
)
select 
contratos.*,
EXTRACT(DOW FROM datetime::DATE) AS day_of_week,
valor.price,
dias_contrato.num_of_days,
tipo_contrato.contract_type as contract_type,
COALESCE(contratos_9_23_estatisticas.num_of_noshows,0) as num_of_noshows,
COALESCE(contratos_9_23_estatisticas.datetime_diff,0) as datetime_diff,
motoristas.*
from contratos
left join motoristas on motoristas.driver_id = contratos.driver_id 
left join valor on valor.contract_id = contratos.contract_id
left join dias_contrato on dias_contrato.contract_id = contratos.contract_id
left join tipo_contrato on tipo_contrato.contract_id = contratos.contract_id
left join contratos_9_23_estatisticas on contratos_9_23_estatisticas.driver_id = motoristas.driver_id
where datetime > '2023-04-24 08:55:06.000'
order by motoristas.driver_id, contratos.contract_id, datetime
-- select sum(kc.days)  as num_of_days,
-- kc.freight_id  as contract_id
-- from kpi_contracts kc
-- group by kc.freight_id 




SELECT 'address_id' AS column_name, da.id::text AS column_value, 'Identificador único do endereço' AS description 
FROM driver_addresses da WHERE da.driver_id = 14346 AND da.id IS NOT NULL
UNION ALL
SELECT 'street' AS column_name, da.street::text AS column_value, 'Rua do endereço' AS description 
FROM driver_addresses da WHERE da.driver_id = 14346 AND da.street IS NOT NULL
UNION ALL
SELECT 'number' AS column_name, da.number::text AS column_value, 'Número do endereço' AS description 
FROM driver_addresses da WHERE da.driver_id = 14346 AND da.number IS NOT NULL
UNION ALL
SELECT 'complement' AS column_name, da.complement::text AS column_value, 'Complemento do endereço' AS description 
FROM driver_addresses da WHERE da.driver_id = 14346 AND da.complement IS NOT NULL
UNION ALL
SELECT 'neighborhood' AS column_name, da.neighborhood::text AS column_value, 'Bairro do endereço' AS description 
FROM driver_addresses da WHERE da.driver_id = 14346 AND da.neighborhood IS NOT NULL
UNION ALL
SELECT 'city_name' AS column_name, cities.name::text AS column_value, 'Nome da cidade do endereço' AS description 
FROM driver_addresses da LEFT JOIN cities ON da.city_id = cities.id WHERE da.driver_id = 14346 AND cities.name IS NOT NULL
UNION ALL
SELECT 'state_name' AS column_name, states.name::text AS column_value, 'Nome do estado do endereço' AS description 
FROM driver_addresses da LEFT JOIN states ON da.state_id = states.id WHERE da.driver_id = 14346 AND states.name IS NOT NULL
UNION ALL
SELECT 'latitude' AS column_name, da.latitude::text AS column_value, 'Latitude do endereço' AS description 
FROM driver_addresses da WHERE da.driver_id = 14346 AND da.latitude IS NOT NULL
UNION ALL
SELECT 'longitude' AS column_name, da.longitude::text AS column_value, 'Longitude do endereço' AS description 
FROM driver_addresses da WHERE da.driver_id = 14346 AND da.longitude IS NOT NULL
UNION ALL
SELECT 'created_at' AS column_name, da.created_at::text AS column_value, 'Data de criação do registro' AS description 
FROM driver_addresses da WHERE da.driver_id = 14346 AND da.created_at IS NOT NULL
UNION ALL
SELECT 'updated_at' AS column_name, da.updated_at::text AS column_value, 'Data da última atualização do registro' AS description 
FROM driver_addresses da WHERE da.driver_id = 14346 AND da.updated_at IS NOT NULL;
SELECT 'address_id' AS column_name, da.id::text AS column_value, 'Identificador único do endereço' AS description 
FROM driver_addresses da WHERE da.driver_id = 14346 AND da.id IS NOT NULL
UNION ALL
SELECT 'street' AS column_name, da.street::text AS column_value, 'Rua do endereço' AS description 
FROM driver_addresses da WHERE da.driver_id = 14346 AND da.street IS NOT NULL
UNION ALL
SELECT 'number' AS column_name, da.number::text AS column_value, 'Número do endereço' AS description 
FROM driver_addresses da WHERE da.driver_id = 14346 AND da.number IS NOT NULL
UNION ALL
SELECT 'complement' AS column_name, da.complement::text AS column_value, 'Complemento do endereço' AS description 
FROM driver_addresses da WHERE da.driver_id = 14346 AND da.complement IS NOT NULL
UNION ALL
SELECT 'neighborhood' AS column_name, da.neighborhood::text AS column_value, 'Bairro do endereço' AS description 
FROM driver_addresses da WHERE da.driver_id = 14346 AND da.neighborhood IS NOT NULL
UNION ALL
SELECT 'city_name' AS column_name, cities.name::text AS column_value, 'Nome da cidade do endereço' AS description 
FROM driver_addresses da LEFT JOIN cities ON da.city_id = cities.id WHERE da.driver_id = 14346 AND cities.name IS NOT NULL
UNION ALL
SELECT 'state_name' AS column_name, states.name::text AS column_value, 'Nome do estado do endereço' AS description 
FROM driver_addresses da LEFT JOIN states ON da.state_id = states.id WHERE da.driver_id = 14346 AND states.name IS NOT NULL
UNION ALL
SELECT 'latitude' AS column_name, da.latitude::text AS column_value, 'Latitude do endereço' AS description 
FROM driver_addresses da WHERE da.driver_id = 14346 AND da.latitude IS NOT NULL
UNION ALL
SELECT 'longitude' AS column_name, da.longitude::text AS column_value, 'Longitude do endereço' AS description 
FROM driver_addresses da WHERE da.driver_id = 14346 AND da.longitude IS NOT NULL
UNION ALL
SELECT 'created_at' AS column_name, da.created_at::text AS column_value, 'Data de criação do registro' AS description 
FROM driver_addresses da WHERE da.driver_id = 14346 AND da.created_at IS NOT NULL
UNION ALL
SELECT 'updated_at' AS column_name, da.updated_at::text AS column_value, 'Data da última atualização do registro' AS description 
FROM driver_addresses da WHERE da.driver_id = 14346 AND da.updated_at IS NOT NULL;
select 
'A minha experiencia completa na px é:' as descricao_experiencia,
sum(contract_days) as numero_de_dias_agenciados_pela_PX,
'dias agenciados' as unidade_medida
from freights f
where driver_id = 14346     select 
        id as driver_id,
        name as nome,
        EXTRACT(YEAR FROM AGE(now(), birthday)) AS idade,
        city as cidade,
        state as estado,
        schooling as nivel_formacao,
        gender as genero,
        drivers_status(status) as status,
        drivers_situation_enum(situation_enum) as situacao,
        drivers_under_clt(under_clt) as vinculo_de_trabalho
from drivers d

    SELECT 'id' AS column_name, id::text AS column_value, 'Identificador único do motorista' AS description 
    FROM drivers WHERE id = 14346 AND id IS NOT NULL
    UNION ALL
    SELECT 'cpf' AS column_name, cpf::text AS column_value, 'CPF do motorista' AS description 
    FROM drivers WHERE id = 14346 AND cpf IS NOT NULL
    UNION ALL
    SELECT 'email' AS column_name, email::text AS column_value, 'Email do motorista' AS description 
    FROM drivers WHERE id = 14346 AND email IS NOT NULL
    UNION ALL
    SELECT 'name' AS column_name, name::text AS column_value, 'Nome do motorista' AS description 
    FROM drivers WHERE id = 14346 AND name IS NOT NULL
    UNION ALL
    SELECT 'phone' AS column_name, phone::text AS column_value, 'Número de telefone do motorista' AS description 
    FROM drivers WHERE id = 14346 AND phone IS NOT NULL
    UNION ALL
    SELECT 'city' AS column_name, city::text AS column_value, 'Cidade onde o motorista está registrado' AS description 
    FROM drivers WHERE id = 14346 AND city IS NOT NULL
    UNION ALL
    SELECT 'state' AS column_name, state::text AS column_value, 'Estado onde o motorista está registrado' AS description 
    FROM drivers WHERE id = 14346 AND state IS NOT NULL
    UNION ALL
    SELECT 'created_at' AS column_name, created_at::text AS column_value, 'Data de criação do registro' AS description 
    FROM drivers WHERE id = 14346 AND created_at IS NOT NULL
    UNION ALL
    SELECT 'updated_at' AS column_name, updated_at::text AS column_value, 'Data da última atualização do registro' AS description 
    FROM drivers WHERE id = 14346 AND updated_at IS NOT NULL
    UNION ALL
    SELECT 'status' AS column_name, drivers_status(status)::text AS column_value, 'Status do motorista (ativo, inativo, etc.)' AS description 
    FROM drivers WHERE id = 14346 AND status IS NOT NULL
    UNION ALL
    SELECT 'app_version' AS column_name, app_version::text AS column_value, 'Versão do aplicativo que o motorista está utilizando' AS description 
    FROM drivers WHERE id = 14346 AND app_version IS NOT NULL
    UNION ALL
    SELECT 'fcm_token' AS column_name, fcm_token::text AS column_value, 'Token do Firebase Cloud Messaging, usado para notificações' AS description 
    FROM drivers WHERE id = 14346 AND fcm_token IS NOT NULL
    UNION ALL
    SELECT 'qualified_at' AS column_name, qualified_at::text AS column_value, 'Data em que o motorista foi qualificado' AS description 
    FROM drivers WHERE id = 14346 AND qualified_at IS NOT NULL
    UNION ALL
    SELECT 'referred_by' AS column_name, referred_by::text AS column_value, 'Identificador do usuário que indicou o motorista' AS description 
    FROM drivers WHERE id = 14346 AND referred_by IS NOT NULL
    UNION ALL
    SELECT 'referral_code' AS column_name, referral_code::text AS column_value, 'Código de referência usado pelo motorista' AS description 
    FROM drivers WHERE id = 14346 AND referral_code IS NOT NULL
    UNION ALL
    SELECT 'reset_password_code' AS column_name, reset_password_code::text AS column_value, 'Código usado para redefinição de senha' AS description 
    FROM drivers WHERE id = 14346 AND reset_password_code IS NOT NULL
    UNION ALL
    SELECT 'id' AS column_name, id::text AS column_value, 'Identificador único do motorista' AS description FROM drivers WHERE id = 14346 AND id IS NOT NULL
    UNION ALL
    SELECT 'idade' AS column_name, EXTRACT(YEAR FROM AGE(now(), birthday))::text AS column_value, 'Idade do motorista' AS description FROM drivers WHERE id = 14346 AND birthday IS NOT NULL
    UNION ALL
    SELECT 'cidade' AS column_name, city::text AS column_value, 'Cidade onde o motorista está registrado' AS description FROM drivers WHERE id = 14346 AND city IS NOT NULL
    UNION ALL
    SELECT 'estado' AS column_name, state::text AS column_value, 'Estado onde o motorista está registrado' AS description FROM drivers WHERE id = 14346 AND state IS NOT NULL
    UNION ALL
    SELECT 'nivel_formacao' AS column_name, schooling::text AS column_value, 'Nível de formação do motorista' AS description FROM drivers WHERE id = 14346 AND schooling IS NOT NULL
    UNION ALL
    SELECT 'genero' AS column_name, gender::text AS column_value, 'Gênero do motorista' AS description FROM drivers WHERE id = 14346 AND gender IS NOT NULL
    UNION ALL
    SELECT 'status' AS column_name, drivers_status(status)::text AS column_value, 'Status do motorista (ativo, inativo, etc.)' AS description FROM drivers WHERE id = 14346 AND status IS NOT NULL
    UNION ALL
    SELECT 'situacao' AS column_name, drivers_situation_enum(situation_enum)::text AS column_value, 'Situação do motorista' AS description FROM drivers WHERE id = 14346 AND situation_enum IS NOT NULL;
with nao_comparecimento as (
select driver_id, 
count(*) as contagem
from driver_behavior_occurrence_types
join driver_behavior_occurrence on driver_behavior_occurrence.id = driver_behavior_occurrence_types.driver_behavior_occurrence_id
where driver_behavior_occurrence_type_id in (9, 23)
group by driver_id
),
alcool_drogas as (
select driver_id, 
count(*) as contagem
from driver_behavior_occurrence_types
join driver_behavior_occurrence on driver_behavior_occurrence.id = driver_behavior_occurrence_types.driver_behavior_occurrence_id
where driver_behavior_occurrence_type_id in (3, 20)
group by driver_id
),
ocorrencia_comportamental as (
select driver_id, 
count(*) as contagem
from driver_behavior_occurrence_types
join driver_behavior_occurrence on driver_behavior_occurrence.id = driver_behavior_occurrence_types.driver_behavior_occurrence_id
where driver_behavior_occurrence_type_id not in (3, 20, 9, 23)
group by driver_id
),
dias_agenciados as (
SELECT f.driver_id, SUM( kc.days ) AS contagem
FROM freights f
left join kpi_contracts kc on kc.freight_id = f.id
WHERE f.status = 300
GROUP BY f.driver_id
)
select dias_agenciados.driver_id,
coalesce(dias_agenciados.contagem,0) as dias_agenciados,
coalesce(nao_comparecimento.contagem,0) as nao_comparecimento,
coalesce(alcool_drogas.contagem,0) as alcool_drogas,
coalesce(ocorrencia_comportamental.contagem,0) as ocorrencia_comportamental
from dias_agenciados
left join nao_comparecimento on nao_comparecimento.driver_id = dias_agenciados.driver_id
left join alcool_drogas on alcool_drogas.driver_id = dias_agenciados.driver_id
left join ocorrencia_comportamental on ocorrencia_comportamental.driver_id = dias_agenciados.driver_id



select 
pa.created_at,
pa.driver_id,
pa.amount / 100 as value_advance,
f.price / 100 as value,
f.id as freight_id,
d.name,
d.cnh_category,
EXTRACT(YEAR FROM age(now(), d.birthday)) AS age,
d.marital_status,
s.name as state,
c.name as city,
tpx.px_time as px_time,
ds.level_px
from freights_payment_orders pa left join drivers d on d.id = pa.driver_id
left join driver_addresses da on da.driver_id = pa.driver_id and da.type = 0
left join cities c on c.id = da.city_id
left join states s on s.id = da.state_id
left join freights f on f.id = pa.freight_id
left join 
(
SELECT 
  driver_id, 
  (EXTRACT(YEAR FROM age(now(), MIN(f.created_at))) * 12 +
   EXTRACT(MONTH FROM age(now(), MIN(f.created_at)))) AS px_time
FROM freights f
GROUP BY f.driver_id
) as tpx on tpx.driver_id = pa.driver_id
left join
(
select ds.driver_id, 
driver_scores_group(ds."group") as level_px from
driver_scores ds 
) as ds on ds.driver_id = pa.driver_id
where pa.type = 1
and freight_payment_orders_status(pa.status) = 'Pago'
order by created_at desc


[2024-08-28 10:52:42] local.INFO: select * from "users" where "id" = 1 limit 1  
[2024-08-28 10:52:42] local.INFO: select * from "users" where "id" = 1  
[2024-08-28 10:52:42] local.INFO: select * from "role_user" where "role_user"."user_id" in (1)  
[2024-08-28 10:52:42] local.INFO: select * from "nova_notifications" where "notifiable_id" = 1 and "nova_notifications"."deleted_at" is null order by "created_at" desc limit 100  
[2024-08-28 10:52:42] local.INFO: select count(*) as aggregate from "nova_notifications" where "read_at" is null and "notifiable_id" = 1 and "nova_notifications"."deleted_at" is null  
[2024-08-28 10:52:45] local.INFO: select * from "users" where "id" = 1 limit 1  
[2024-08-28 10:52:45] local.INFO: select * from "users" where "id" = 1  
[2024-08-28 10:52:45] local.INFO: select * from "role_user" where "role_user"."user_id" in (1)  
[2024-08-28 10:52:45] local.INFO: select * from "drivers" where "drivers"."id" = 463 limit 1  
[2024-08-28 10:52:45] local.INFO: select "roles".*, "role_user"."user_id" as "pivot_user_id", "role_user"."role_id" as "pivot_role_id" from "roles" inner join "role_user" on "roles"."id" = "role_user"."role_id" where "role_user"."user_id" = 1  
[2024-08-28 10:52:45] local.INFO: select * from "role_permission" where "role_permission"."role_id" in (3, 7)  
[2024-08-28 10:52:45] local.INFO: select * from "role_permission" where "role_id" = 3  
[2024-08-28 10:52:45] local.INFO: select * from "role_permission" where "role_id" = 7  
[2024-08-28 10:52:45] local.INFO: select * from "users" where "id" = 1 limit 1  
[2024-08-28 10:52:45] local.INFO: select * from "users" where "id" = 1 limit 1  
[2024-08-28 10:52:45] local.INFO: select * from "users" where "id" = 1  
[2024-08-28 10:52:45] local.INFO: select * from "users" where "id" = 1  
[2024-08-28 10:52:45] local.INFO: select * from "role_user" where "role_user"."user_id" in (1)  
[2024-08-28 10:52:45] local.INFO: select * from "role_user" where "role_user"."user_id" in (1)  
[2024-08-28 10:52:45] local.INFO: select * from "users" where "id" = 1 limit 1  
[2024-08-28 10:52:45] local.INFO: select * from "users" where "id" = 1  
[2024-08-28 10:52:45] local.INFO: select * from "role_user" where "role_user"."user_id" in (1)  
[2024-08-28 10:52:45] local.INFO: select * from "users" where "id" = 1 limit 1  
[2024-08-28 10:52:45] local.INFO: select * from "users" where "id" = 1 limit 1  
[2024-08-28 10:52:45] local.INFO: select * from "users" where "id" = 1  
[2024-08-28 10:52:45] local.INFO: select * from "role_user" where "role_user"."user_id" in (1)  
[2024-08-28 10:52:45] local.INFO: select * from "users" where "id" = 1  
[2024-08-28 10:52:45] local.INFO: select * from "users" where "id" = 1 limit 1  
[2024-08-28 10:52:45] local.INFO: select * from "role_user" where "role_user"."user_id" in (1)  
[2024-08-28 10:52:45] local.INFO: select * from "users" where "id" = 1  
[2024-08-28 10:52:45] local.INFO: select * from "role_user" where "role_user"."user_id" in (1)  
[2024-08-28 10:52:46] local.INFO: select * from "users" where "id" = 1 limit 1  
[2024-08-28 10:52:46] local.INFO: select * from "users" where "id" = 1  
[2024-08-28 10:52:46] local.INFO: select * from "role_user" where "role_user"."user_id" in (1)  
[2024-08-28 10:52:46] local.INFO: select * from "users" where "id" = 1 limit 1  
[2024-08-28 10:52:46] local.INFO: select * from "users" where "id" = 1  
[2024-08-28 10:52:46] local.INFO: select * from "role_user" where "role_user"."user_id" in (1)  
[2024-08-28 10:52:46] local.INFO: select * from "users" where "id" = 1 limit 1  
[2024-08-28 10:52:46] local.INFO: select * from "users" where "id" = 1  
[2024-08-28 10:52:46] local.INFO: select * from "users" where "id" = 1 limit 1  
[2024-08-28 10:52:46] local.INFO: select * from "role_user" where "role_user"."user_id" in (1)  
[2024-08-28 10:52:46] local.INFO: select * from "users" where "id" = 1 limit 1  
[2024-08-28 10:52:46] local.INFO: select * from "drivers" where "drivers"."id" = 463 limit 1  
[2024-08-28 10:52:46] local.INFO: select "roles".*, "role_user"."user_id" as "pivot_user_id", "role_user"."role_id" as "pivot_role_id" from "roles" inner join "role_user" on "roles"."id" = "role_user"."role_id" where "role_user"."user_id" = 1  
[2024-08-28 10:52:46] local.INFO: select * from "users" where "id" = 1  
[2024-08-28 10:52:46] local.INFO: select * from "role_permission" where "role_permission"."role_id" in (3, 7)  
[2024-08-28 10:52:46] local.INFO: select * from "role_user" where "role_user"."user_id" in (1)  
[2024-08-28 10:52:46] local.INFO: select * from "users" where "id" = 1  
[2024-08-28 10:52:46] local.INFO: select sum("days") as aggregate from "driver_vehicle_px_experiences" where "driver_vehicle_px_experiences"."driver_id" = 463 and "driver_vehicle_px_experiences"."driver_id" is not null  
[2024-08-28 10:52:46] local.INFO: select * from "role_user" where "role_user"."user_id" in (1)  
[2024-08-28 10:52:46] local.INFO: select * from "nova_notifications" where "notifiable_id" = 1 and "nova_notifications"."deleted_at" is null order by "created_at" desc limit 100  
[2024-08-28 10:52:46] local.INFO: select sum("days") as aggregate from "driver_supply_px_experiences" where "driver_supply_px_experiences"."driver_id" = 463 and "driver_supply_px_experiences"."driver_id" is not null and exists (select * from "supplies" where "driver_supply_px_experiences"."supply_id" = "supplies"."id" and "name" != Nenhum)  
[2024-08-28 10:52:46] local.INFO: select count(*) as aggregate from "nova_notifications" where "read_at" is null and "notifiable_id" = 1 and "nova_notifications"."deleted_at" is null  
[2024-08-28 10:52:46] local.INFO: select exists(select * from "lead_campaign_results" where "lead_campaign_results"."driver_id" = 463 and "lead_campaign_results"."driver_id" is not null and "status" = campaign_canceled) as "exists"  
[2024-08-28 10:52:46] local.INFO: select 
                driver_preference_types.name,
                driver_preference_types.group,
                (SELECT json_agg(driver_preferences.value) FROM driver_preferences WHERE driver_preferences.type_id = driver_preference_types.id AND driver_preferences.driver_id = 463) AS values
                 from "driver_preference_types" order by "driver_preference_types"."group" asc  
[2024-08-28 10:52:46] local.INFO: select "group", "tier" from "driver_scores" where "driver_id" = 463 limit 1  
[2024-08-28 10:52:46] local.INFO: select * from "driver_attendance_summaries" where "driver_attendance_summaries"."driver_id" = 463 and "driver_attendance_summaries"."driver_id" is not null order by "driver_attendance_summaries"."id" desc limit 1  
[2024-08-28 10:52:46] local.INFO: select * from "media" where "media"."model_id" in (463) and "media"."model_type" = App\Models\Driver  
[2024-08-28 10:52:46] local.INFO: select * from "academy_user_integrations" where "academy_user_integrations"."driver_id" = 463 and "academy_user_integrations"."driver_id" is not null and "partner" = awti limit 1  
[2024-08-28 10:52:46] local.INFO: select * from "bank_accounts" where "bank_accounts"."driver_id" = 463 and "bank_accounts"."driver_id" is not null limit 1  
[2024-08-28 10:52:46] local.INFO: select * from "bank_pixes" where "bank_pixes"."driver_id" = 463 and "bank_pixes"."driver_id" is not null limit 1  
[2024-08-28 10:52:46] local.INFO: select * from "drivers" where "drivers"."id" = 463 limit 1  
[2024-08-28 10:52:46] local.INFO: select * from "users" where "id" = 1 limit 1  
[2024-08-28 10:52:46] local.INFO: select * from "users" where "id" = 1  
[2024-08-28 10:52:46] local.INFO: select * from "role_user" where "role_user"."user_id" in (1)  
[2024-08-28 10:52:46] local.INFO: select * from "drivers" where "drivers"."id" = 463 limit 1  
[2024-08-28 10:52:46] local.INFO: select "roles".*, "role_user"."user_id" as "pivot_user_id", "role_user"."role_id" as "pivot_role_id" from "roles" inner join "role_user" on "roles"."id" = "role_user"."role_id" where "role_user"."user_id" = 1  
[2024-08-28 10:52:46] local.INFO: select * from "role_permission" where "role_permission"."role_id" in (3, 7)  
[2024-08-28 10:52:46] local.INFO: select * from "users"  
[2024-08-28 10:52:46] local.INFO: select * from "cadex_driver_give_up_reason"  
[2024-08-28 10:52:46] local.INFO: select "id", "name" from "companies"  
[2024-08-28 10:52:46] local.INFO: select * from "drivers" where "id" = 463 limit 1  
[2024-08-28 10:52:46] local.INFO: select exists(select * from "drivers" where "id" = 463 and (exists (select 1 from "bank_accounts" where bank_accounts.driver_id = drivers.id) or exists (select 1 from "bank_pixes" as "bank_pix" where bank_pix.driver_id = drivers.id))) as "exists"  
[2024-08-28 10:52:46] local.INFO: select extract(year from justify_interval(sum(age(finalized_date_at, started_date_at)))) years, extract(month from justify_interval(sum(age(finalized_date_at, started_date_at)))) months, extract(day from justify_interval(sum(age(finalized_date_at, started_date_at)))) days from "driver_experiences" where "driver_id" = 463 limit 1  
[2024-08-28 10:52:46] local.INFO: select * from "driver_behavior_occurrence"  
[2024-08-28 10:52:46] local.INFO: select * from "users" where "id" = 1 limit 1  
[2024-08-28 10:52:46] local.INFO: select * from "users" where "id" = 1 limit 1  
[2024-08-28 10:52:46] local.INFO: select * from "users" where "id" = 1  
[2024-08-28 10:52:46] local.INFO: select * from "role_user" where "role_user"."user_id" in (1)  
[2024-08-28 10:52:46] local.INFO: select * from "users" where "id" = 1  
[2024-08-28 10:52:46] local.INFO: select * from "role_user" where "role_user"."user_id" in (1)  
[2024-08-28 10:52:46] local.INFO: select * from "users" where "id" = 1 limit 1  
[2024-08-28 10:52:46] local.INFO: select * from "users" where "id" = 1  
[2024-08-28 10:52:46] local.INFO: select * from "role_user" where "role_user"."user_id" in (1)  
[2024-08-28 10:52:46] local.INFO: select * from "users" where "id" = 1 limit 1  
[2024-08-28 10:52:46] local.INFO: select * from "users" where "id" = 1  
[2024-08-28 10:52:46] local.INFO: select * from "role_user" where "role_user"."user_id" in (1)  
[2024-08-28 10:52:46] local.INFO: select * from "users" where "id" = 1 limit 1  
[2024-08-28 10:52:46] local.INFO: select * from "users" where "id" = 1 limit 1  
[2024-08-28 10:52:46] local.INFO: select * from "users" where "id" = 1  
[2024-08-28 10:52:46] local.INFO: select * from "role_user" where "role_user"."user_id" in (1)  
[2024-08-28 10:52:46] local.INFO: select * from "users" where "id" = 1  
[2024-08-28 10:52:46] local.INFO: select * from "role_user" where "role_user"."user_id" in (1)  
[2024-08-28 10:52:46] local.INFO: select * from "users" where "id" = 1 limit 1  
[2024-08-28 10:52:46] local.INFO: select * from "users" where "id" = 1  
[2024-08-28 10:52:46] local.INFO: select * from "role_user" where "role_user"."user_id" in (1)  
[2024-08-28 10:52:46] local.INFO: select "name", "id" from "users" order by "name" asc  
[2024-08-28 10:52:46] local.INFO: select "name", "id" from "cadex_driver_give_up_reason" order by "name" asc  
[2024-08-28 10:52:46] local.INFO: select * from "users" where "id" = 1 limit 1  
[2024-08-28 10:52:46] local.INFO: select * from "users" where "id" = 1  
[2024-08-28 10:52:46] local.INFO: select * from "role_user" where "role_user"."user_id" in (1)  
[2024-08-28 10:52:46] local.INFO: select * from "users" where "id" = 1 limit 1  
[2024-08-28 10:52:46] local.INFO: select * from "users" where "id" = 1  
[2024-08-28 10:52:46] local.INFO: select * from "role_user" where "role_user"."user_id" in (1)  
[2024-08-28 10:52:46] local.INFO: select drivers.id as id, drivers.name as name from "drivers" inner join "driver_behavior_occurrence" on "driver_behavior_occurrence"."driver_id" = "drivers"."id" group by "drivers"."id"  
[2024-08-28 10:52:46] local.INFO: select * from "users" where "id" = 1 limit 1  
[2024-08-28 10:52:46] local.INFO: select * from "users" where "id" = 1 limit 1  
[2024-08-28 10:52:46] local.INFO: select * from "users" where "id" = 1  
[2024-08-28 10:52:46] local.INFO: select * from "role_user" where "role_user"."user_id" in (1)  
[2024-08-28 10:52:46] local.INFO: select drivers.id as id, drivers.name as name from "drivers" inner join "driver_behavior_occurrence" on "driver_behavior_occurrence"."driver_id" = "drivers"."id" group by "drivers"."id"  
[2024-08-28 10:52:46] local.INFO: select users.id as id, users.name as name from "users" inner join "driver_behavior_occurrence" on "driver_behavior_occurrence"."created_by" = "users"."id" group by "users"."id"  
[2024-08-28 10:52:46] local.INFO: select company_multitenancy.id as id, company_multitenancy.name as name from "company_multitenancy" inner join "companies" on "companies"."company_multitenancy_id" = "company_multitenancy"."id"  
[2024-08-28 10:52:46] local.INFO: select * from "users" where "id" = 1  
[2024-08-28 10:52:46] local.INFO: select * from "role_user" where "role_user"."user_id" in (1)  
[2024-08-28 10:52:46] local.INFO: select companies.id as id, companies.name as name from "companies" inner join "freights" on "freights"."company_id" = "companies"."id"  
[2024-08-28 10:52:46] local.INFO: select "id", "description" from "driver_behavior_occurrence_type"  
[2024-08-28 10:52:47] local.INFO: select * from "users" where "id" = 1 limit 1  
[2024-08-28 10:52:47] local.INFO: select * from "users" where "id" = 1 limit 1  
[2024-08-28 10:52:47] local.INFO: select * from "users" where "id" = 1  
[2024-08-28 10:52:47] local.INFO: select * from "role_user" where "role_user"."user_id" in (1)  
[2024-08-28 10:52:47] local.INFO: select "id", "type" from "courses" where "type" = toxicological limit 1  
[2024-08-28 10:52:47] local.INFO: select "type" from "courses" where "id" is null limit 1  
[2024-08-28 10:52:47] local.INFO: select * from "users" where "id" = 1 limit 1  
[2024-08-28 10:52:47] local.INFO: select courses.id as id, courses.name as name from "courses" group by "courses"."id"  
[2024-08-28 10:52:47] local.INFO: select * from "users" where "id" = 1  
[2024-08-28 10:52:47] local.INFO: select * from "users" where "id" = 1  
[2024-08-28 10:52:47] local.INFO: select * from "role_user" where "role_user"."user_id" in (1)  
[2024-08-28 10:52:47] local.INFO: select * from "role_user" where "role_user"."user_id" in (1)  
[2024-08-28 10:52:47] local.INFO: select sum("days") as aggregate from "driver_vehicle_px_experiences" where "driver_vehicle_px_experiences"."driver_id" is null and "driver_vehicle_px_experiences"."driver_id" is not null  
[2024-08-28 10:52:47] local.INFO: select sum("days") as aggregate from "driver_supply_px_experiences" where "driver_supply_px_experiences"."driver_id" is null and "driver_supply_px_experiences"."driver_id" is not null and exists (select * from "supplies" where "driver_supply_px_experiences"."supply_id" = "supplies"."id" and "name" != Nenhum)  
[2024-08-28 10:52:47] local.INFO: select exists(select * from "lead_campaign_results" where "lead_campaign_results"."driver_id" is null and "lead_campaign_results"."driver_id" is not null and "status" = campaign_canceled) as "exists"  
[2024-08-28 10:52:47] local.INFO: select "name" as "city" from "cities" order by "name" asc  
[2024-08-28 10:52:47] local.INFO: select * from "users" where "id" = 1 limit 1  
[2024-08-28 10:52:47] local.INFO: select * from "users" where "id" = 1 limit 1  
[2024-08-28 10:52:47] local.INFO: select * from "users" where "id" = 1  
[2024-08-28 10:52:47] local.INFO: select * from "role_user" where "role_user"."user_id" in (1)  
[2024-08-28 10:52:47] local.INFO: select * from "users" where "id" = 1  
[2024-08-28 10:52:47] local.INFO: select * from "role_user" where "role_user"."user_id" in (1)  
[2024-08-28 10:52:47] local.INFO: select * from "users" where "id" = 1 limit 1  
[2024-08-28 10:52:47] local.INFO: select * from "users" where "id" = 1  
[2024-08-28 10:52:47] local.INFO: select * from "role_user" where "role_user"."user_id" in (1)  
[2024-08-28 10:52:47] local.INFO: select * from "users" where "id" = 1 limit 1  
[2024-08-28 10:52:47] local.INFO: select * from "users" where "id" = 1  
[2024-08-28 10:52:47] local.INFO: select "uf" as "state" from "states" group by "uf" order by "uf" asc  
[2024-08-28 10:52:47] local.INFO: select * from "role_user" where "role_user"."user_id" in (1)  
[2024-08-28 10:52:47] local.INFO: select "name" from "supplies" order by "name" asc  
[2024-08-28 10:52:47] local.INFO: select * from "users"  
[2024-08-28 10:52:47] local.INFO: select * from "occurrence_attachments" where "attachable_id" is null and "attachable_type" = App\Models\Discount and "type" = 9 order by "created_at" desc  
[2024-08-28 10:52:47] local.INFO: select "name", "id" from "cadex_driver_give_up_reason" order by "name" asc  
[2024-08-28 10:52:47] local.INFO: select "drivers"."id", "drivers"."name" from "drivers" inner join "discounts" on "drivers"."id" = "discounts"."driver_id"  
[2024-08-28 10:52:47] local.INFO: select "name", "id" from "courses" where "group" = external order by "name" asc  
[2024-08-28 10:52:47] local.INFO: select "name", "id" from "courses" where "group" = internal order by "name" asc  
[2024-08-28 10:52:47] local.INFO: select * from "users" where "id" = 1 limit 1  
[2024-08-28 10:52:47] local.INFO: select * from "users" where "id" = 1 limit 1  
[2024-08-28 10:52:47] local.INFO: select * from "users" where "id" = 1  
[2024-08-28 10:52:47] local.INFO: select * from "role_user" where "role_user"."user_id" in (1)  
[2024-08-28 10:52:47] local.INFO: select * from "users" where "id" = 1  
[2024-08-28 10:52:47] local.INFO: select * from "role_user" where "role_user"."user_id" in (1)  
[2024-08-28 10:52:47] local.INFO: select "id", "name" from "companies"  
[2024-08-28 10:52:47] local.INFO: select * from "users" where "id" = 1 limit 1  
[2024-08-28 10:52:47] local.INFO: select "id", "name" from "drivers" where "status" in (4, 5, 8)  
[2024-08-28 10:52:47] local.INFO: select * from "users" where "id" = 1  
[2024-08-28 10:52:47] local.INFO: select * from "role_user" where "role_user"."user_id" in (1)  
[2024-08-28 10:52:47] local.INFO: select users.id as analyst_success_id, users.name as analyst_success_name from "users" inner join "companies" on "companies"."user_id" = "users"."id"  
[2024-08-28 10:52:47] local.INFO: select users.id as success_manager_id, users.name as success_manager_name from "users" inner join "companies" on "companies"."success_manager_id" = "users"."id"  
[2024-08-28 10:52:47] local.INFO: select array_to_string(array_agg(companies.id), ',') AS ids, company_multitenancy.name AS name from "companies" inner join "company_multitenancy" on "companies"."company_multitenancy_id" = "company_multitenancy"."id" group by "company_multitenancy"."name"  
[2024-08-28 10:52:47] local.INFO: select * from "users" where "id" = 1 limit 1  
[2024-08-28 10:52:47] local.INFO: select * from "users" where "id" = 1  
[2024-08-28 10:52:47] local.INFO: select * from "role_user" where "role_user"."user_id" in (1)  
[2024-08-28 10:52:47] local.INFO: select * from "users" where "id" = 1 limit 1  
[2024-08-28 10:52:47] local.INFO: select * from "users" where "id" = 1  
[2024-08-28 10:52:47] local.INFO: select * from "role_user" where "role_user"."user_id" in (1)  
[2024-08-28 10:52:47] local.INFO: select * from "bank_accounts" where "bank_accounts"."id" = 8 limit 1  
[2024-08-28 10:52:47] local.INFO: select * from "users" where "id" = 1 limit 1  
[2024-08-28 10:52:47] local.INFO: select * from "banks" where "banks"."code" = 21104 limit 1  
[2024-08-28 10:52:47] local.INFO: select sum("days") as aggregate from "driver_vehicle_px_experiences" where "driver_vehicle_px_experiences"."driver_id" is null and "driver_vehicle_px_experiences"."driver_id" is not null  
[2024-08-28 10:52:47] local.INFO: select sum("days") as aggregate from "driver_supply_px_experiences" where "driver_supply_px_experiences"."driver_id" is null and "driver_supply_px_experiences"."driver_id" is not null and exists (select * from "supplies" where "driver_supply_px_experiences"."supply_id" = "supplies"."id" and "name" != Nenhum)  
[2024-08-28 10:52:47] local.INFO: select exists(select * from "lead_campaign_results" where "lead_campaign_results"."driver_id" is null and "lead_campaign_results"."driver_id" is not null and "status" = campaign_canceled) as "exists"  
[2024-08-28 10:52:47] local.INFO: select * from "users" where "id" = 1  
[2024-08-28 10:52:47] local.INFO: select sum("days") as aggregate from "driver_vehicle_px_experiences" where "driver_vehicle_px_experiences"."driver_id" is null and "driver_vehicle_px_experiences"."driver_id" is not null  
[2024-08-28 10:52:47] local.INFO: select * from "role_user" where "role_user"."user_id" in (1)  
[2024-08-28 10:52:47] local.INFO: select sum("days") as aggregate from "driver_supply_px_experiences" where "driver_supply_px_experiences"."driver_id" is null and "driver_supply_px_experiences"."driver_id" is not null and exists (select * from "supplies" where "driver_supply_px_experiences"."supply_id" = "supplies"."id" and "name" != Nenhum)  
[2024-08-28 10:52:47] local.INFO: select exists(select * from "lead_campaign_results" where "lead_campaign_results"."driver_id" is null and "lead_campaign_results"."driver_id" is not null and "status" = campaign_canceled) as "exists"  
[2024-08-28 10:52:47] local.INFO: select * from "users" where "id" = 1 limit 1  
[2024-08-28 10:52:47] local.INFO: select * from "users" where "id" = 1  
[2024-08-28 10:52:47] local.INFO: select * from "role_user" where "role_user"."user_id" in (1)  
[2024-08-28 10:52:47] local.INFO: select * from "bank_pixes" where "bank_pixes"."id" = 27 limit 1  
[2024-08-28 10:52:47] local.INFO: select * from "drivers" where "drivers"."id" = 463 limit 1  
[2024-08-28 10:52:47] local.INFO: select "roles".*, "role_user"."user_id" as "pivot_user_id", "role_user"."role_id" as "pivot_role_id" from "roles" inner join "role_user" on "roles"."id" = "role_user"."role_id" where "role_user"."user_id" = 1  
[2024-08-28 10:52:47] local.INFO: select * from "role_permission" where "role_permission"."role_id" in (3, 7)  
[2024-08-28 10:52:47] local.INFO: select * from "users" where "users"."id" = 2 limit 1  
[2024-08-28 10:52:47] local.INFO: select * from "users" where "id" = 1 limit 1  
[2024-08-28 10:52:47] local.INFO: select sum("days") as aggregate from "driver_vehicle_px_experiences" where "driver_vehicle_px_experiences"."driver_id" is null and "driver_vehicle_px_experiences"."driver_id" is not null  
[2024-08-28 10:52:47] local.INFO: select sum("days") as aggregate from "driver_supply_px_experiences" where "driver_supply_px_experiences"."driver_id" is null and "driver_supply_px_experiences"."driver_id" is not null and exists (select * from "supplies" where "driver_supply_px_experiences"."supply_id" = "supplies"."id" and "name" != Nenhum)  
[2024-08-28 10:52:47] local.INFO: select exists(select * from "lead_campaign_results" where "lead_campaign_results"."driver_id" is null and "lead_campaign_results"."driver_id" is not null and "status" = campaign_canceled) as "exists"  
[2024-08-28 10:52:47] local.INFO: select "status" from "drivers" where "id" = 463 limit 1  
[2024-08-28 10:52:47] local.INFO: select sum("days") as aggregate from "driver_vehicle_px_experiences" where "driver_vehicle_px_experiences"."driver_id" is null and "driver_vehicle_px_experiences"."driver_id" is not null  
[2024-08-28 10:52:47] local.INFO: select * from "users" where "id" = 1  
[2024-08-28 10:52:47] local.INFO: select sum("days") as aggregate from "driver_supply_px_experiences" where "driver_supply_px_experiences"."driver_id" is null and "driver_supply_px_experiences"."driver_id" is not null and exists (select * from "supplies" where "driver_supply_px_experiences"."supply_id" = "supplies"."id" and "name" != Nenhum)  
[2024-08-28 10:52:47] local.INFO: select exists(select * from "lead_campaign_results" where "lead_campaign_results"."driver_id" is null and "lead_campaign_results"."driver_id" is not null and "status" = campaign_canceled) as "exists"  
[2024-08-28 10:52:47] local.INFO: select * from "role_user" where "role_user"."user_id" in (1)  
[2024-08-28 10:52:47] local.INFO: select sum("days") as aggregate from "driver_vehicle_px_experiences" where "driver_vehicle_px_experiences"."driver_id" is null and "driver_vehicle_px_experiences"."driver_id" is not null  
[2024-08-28 10:52:47] local.INFO: select sum("days") as aggregate from "driver_supply_px_experiences" where "driver_supply_px_experiences"."driver_id" is null and "driver_supply_px_experiences"."driver_id" is not null and exists (select * from "supplies" where "driver_supply_px_experiences"."supply_id" = "supplies"."id" and "name" != Nenhum)  
[2024-08-28 10:52:47] local.INFO: select exists(select * from "lead_campaign_results" where "lead_campaign_results"."driver_id" is null and "lead_campaign_results"."driver_id" is not null and "status" = campaign_canceled) as "exists"  
[2024-08-28 10:52:47] local.INFO: select * from "users" where "id" = 1 limit 1  
[2024-08-28 10:52:47] local.INFO: select * from "drivers" where "drivers"."id" = 463 limit 1  
[2024-08-28 10:52:47] local.INFO: select * from "driver_observations" where "driver_observations"."driver_id" = 463 and "driver_observations"."driver_id" is not null order by "driver_observations"."id" desc limit 6 offset 0  
[2024-08-28 10:52:47] local.INFO: select count(*) as aggregate from "driver_observations" where "driver_observations"."driver_id" = 463 and "driver_observations"."driver_id" is not null  
[2024-08-28 10:52:47] local.INFO: select * from "users" where "users"."id" = 1 limit 1  
[2024-08-28 10:52:47] local.INFO: select "roles".*, "role_user"."user_id" as "pivot_user_id", "role_user"."role_id" as "pivot_role_id" from "roles" inner join "role_user" on "roles"."id" = "role_user"."role_id" where "role_user"."user_id" = 1  
[2024-08-28 10:52:47] local.INFO: select * from "role_permission" where "role_permission"."role_id" in (3, 7)  
[2024-08-28 10:52:47] local.INFO: select * from "users" where "id" = 1  
[2024-08-28 10:52:47] local.INFO: select * from "role_user" where "role_user"."user_id" in (1)  
[2024-08-28 10:52:47] local.INFO: select * from "drivers" where "drivers"."id" = 463 limit 1  
[2024-08-28 10:52:47] local.INFO: select * from "users" where "id" = 1 limit 1  
[2024-08-28 10:52:47] local.INFO: select * from "users" where "id" = 1  
[2024-08-28 10:52:47] local.INFO: select * from "role_user" where "role_user"."user_id" in (1)  
[2024-08-28 10:52:47] local.INFO: select "roles".*, "role_user"."user_id" as "pivot_user_id", "role_user"."role_id" as "pivot_role_id" from "roles" inner join "role_user" on "roles"."id" = "role_user"."role_id" where "role_user"."user_id" = 1  
[2024-08-28 10:52:47] local.INFO: select * from "users" where "id" = 1 limit 1  
[2024-08-28 10:52:47] local.INFO: select * from "role_permission" where "role_permission"."role_id" in (3, 7)  
[2024-08-28 10:52:47] local.INFO: select sum("days") as aggregate from "driver_vehicle_px_experiences" where "driver_vehicle_px_experiences"."driver_id" is null and "driver_vehicle_px_experiences"."driver_id" is not null  
[2024-08-28 10:52:47] local.INFO: select sum("days") as aggregate from "driver_supply_px_experiences" where "driver_supply_px_experiences"."driver_id" is null and "driver_supply_px_experiences"."driver_id" is not null and exists (select * from "supplies" where "driver_supply_px_experiences"."supply_id" = "supplies"."id" and "name" != Nenhum)  
[2024-08-28 10:52:47] local.INFO: select * from "users" where "id" = 1  
[2024-08-28 10:52:47] local.INFO: select exists(select * from "lead_campaign_results" where "lead_campaign_results"."driver_id" is null and "lead_campaign_results"."driver_id" is not null and "status" = campaign_canceled) as "exists"  
[2024-08-28 10:52:47] local.INFO: select * from "role_user" where "role_user"."user_id" in (1)  
[2024-08-28 10:52:47] local.INFO: select * from "users" where "id" = 1 limit 1  
[2024-08-28 10:52:47] local.INFO: select * from "discounts" where "discounts"."id" is null limit 1  
[2024-08-28 10:52:47] local.INFO: select * from "drivers" where "drivers"."id" = 463 limit 1  
[2024-08-28 10:52:47] local.INFO: select sum("days") as aggregate from "driver_vehicle_px_experiences" where "driver_vehicle_px_experiences"."driver_id" is null and "driver_vehicle_px_experiences"."driver_id" is not null  
[2024-08-28 10:52:47] local.INFO: select * from "occurrence_attachments" where "attachable_id" is null and "attachable_type" = App\Models\Discount and "type" = 9 order by "created_at" desc  
[2024-08-28 10:52:47] local.INFO: select sum("days") as aggregate from "driver_supply_px_experiences" where "driver_supply_px_experiences"."driver_id" is null and "driver_supply_px_experiences"."driver_id" is not null and exists (select * from "supplies" where "driver_supply_px_experiences"."supply_id" = "supplies"."id" and "name" != Nenhum)  
[2024-08-28 10:52:47] local.INFO: select * from "discounts" where "discounts"."driver_id" = 463 and "discounts"."driver_id" is not null order by "discounts"."id" desc limit 6 offset 0  
[2024-08-28 10:52:47] local.INFO: select exists(select * from "lead_campaign_results" where "lead_campaign_results"."driver_id" is null and "lead_campaign_results"."driver_id" is not null and "status" = campaign_canceled) as "exists"  
[2024-08-28 10:52:47] local.INFO: select * from "discount_negotiations" where "discount_negotiations"."discount_id" in (15, 17, 18, 20, 27, 29)  
[2024-08-28 10:52:47] local.INFO: select * from "discount_balances" where "discount_balances"."discount_id" in (15, 17, 18, 20, 27, 29)  
[2024-08-28 10:52:47] local.INFO: select * from "users" where "id" = 1  
[2024-08-28 10:52:47] local.INFO: select * from "companies" where "companies"."id" in (191, 192)  
[2024-08-28 10:52:47] local.INFO: select sum("days") as aggregate from "driver_vehicle_px_experiences" where "driver_vehicle_px_experiences"."driver_id" is null and "driver_vehicle_px_experiences"."driver_id" is not null  
[2024-08-28 10:52:47] local.INFO: select * from "drivers" where "drivers"."id" in (463)  
[2024-08-28 10:52:47] local.INFO: select * from "role_user" where "role_user"."user_id" in (1)  
[2024-08-28 10:52:47] local.INFO: select sum("days") as aggregate from "driver_supply_px_experiences" where "driver_supply_px_experiences"."driver_id" is null and "driver_supply_px_experiences"."driver_id" is not null and exists (select * from "supplies" where "driver_supply_px_experiences"."supply_id" = "supplies"."id" and "name" != Nenhum)  
[2024-08-28 10:52:47] local.INFO: select exists(select * from "lead_campaign_results" where "lead_campaign_results"."driver_id" is null and "lead_campaign_results"."driver_id" is not null and "status" = campaign_canceled) as "exists"  
[2024-08-28 10:52:47] local.INFO: select * from "discount_statements" where "discount_statements"."discount_id" in (15, 17, 18, 20, 27, 29)  
[2024-08-28 10:52:47] local.INFO: select * from "freights" where "freights"."id" in (2978, 3642, 3754) and "freights"."deleted_at" is null  
[2024-08-28 10:52:47] local.INFO: select * from "discounts" where "discounts"."id" is null limit 1  
[2024-08-28 10:52:47] local.INFO: select count(*) as aggregate from "discounts" where "discounts"."driver_id" = 463 and "discounts"."driver_id" is not null  
[2024-08-28 10:52:47] local.INFO: select * from "occurrence_attachments" where "attachable_id" = 29 and "attachable_type" = App\Models\Discount and "type" = 10 order by "created_at" desc  
[2024-08-28 10:52:47] local.INFO: select "roles".*, "role_user"."user_id" as "pivot_user_id", "role_user"."role_id" as "pivot_role_id" from "roles" inner join "role_user" on "roles"."id" = "role_user"."role_id" where "role_user"."user_id" = 1  
[2024-08-28 10:52:47] local.INFO: select exists(select * from "discount_statements" where "discount_statements"."discount_id" = 29 and "discount_statements"."discount_id" is not null) as "exists"  
[2024-08-28 10:52:47] local.INFO: select * from "role_permission" where "role_permission"."role_id" in (3, 7)  
[2024-08-28 10:52:47] local.INFO: select * from "occurrence_attachments" where "attachable_id" = 29 and "attachable_type" = App\Models\Discount and "type" = 10 order by "created_at" desc  
[2024-08-28 10:52:47] local.INFO: select * from "occurrence_attachments" where "attachable_id" = 27 and "attachable_type" = App\Models\Discount and "type" = 10 order by "created_at" desc  
[2024-08-28 10:52:47] local.INFO: select exists(select * from "discount_statements" where "discount_statements"."discount_id" = 27 and "discount_statements"."discount_id" is not null) as "exists"  
[2024-08-28 10:52:47] local.INFO: select * from "occurrence_attachments" where "attachable_id" = 27 and "attachable_type" = App\Models\Discount and "type" = 10 order by "created_at" desc  
[2024-08-28 10:52:47] local.INFO: select * from "occurrence_attachments" where "attachable_id" = 20 and "attachable_type" = App\Models\Discount and "type" = 10 order by "created_at" desc  
[2024-08-28 10:52:47] local.INFO: select exists(select * from "discount_statements" where "discount_statements"."discount_id" = 20 and "discount_statements"."discount_id" is not null) as "exists"  
[2024-08-28 10:52:47] local.INFO: select * from "occurrence_attachments" where "attachable_id" = 20 and "attachable_type" = App\Models\Discount and "type" = 10 order by "created_at" desc  
[2024-08-28 10:52:47] local.INFO: select * from "occurrence_attachments" where "attachable_id" = 18 and "attachable_type" = App\Models\Discount and "type" = 10 order by "created_at" desc  
[2024-08-28 10:52:47] local.INFO: select exists(select * from "discount_statements" where "discount_statements"."discount_id" = 18 and "discount_statements"."discount_id" is not null) as "exists"  
[2024-08-28 10:52:47] local.INFO: select * from "occurrence_attachments" where "attachable_id" = 18 and "attachable_type" = App\Models\Discount and "type" = 10 order by "created_at" desc  
[2024-08-28 10:52:47] local.INFO: select * from "occurrence_attachments" where "attachable_id" = 17 and "attachable_type" = App\Models\Discount and "type" = 10 order by "created_at" desc  
[2024-08-28 10:52:47] local.INFO: select exists(select * from "discount_statements" where "discount_statements"."discount_id" = 17 and "discount_statements"."discount_id" is not null) as "exists"  
[2024-08-28 10:52:47] local.INFO: select * from "occurrence_attachments" where "attachable_id" = 17 and "attachable_type" = App\Models\Discount and "type" = 10 order by "created_at" desc  
[2024-08-28 10:52:47] local.INFO: select * from "users" where "id" = 1 limit 1  
[2024-08-28 10:52:47] local.INFO: select * from "users" where "id" = 1 limit 1  
[2024-08-28 10:52:47] local.INFO: select * from "users" where "id" = 1  
[2024-08-28 10:52:47] local.INFO: select * from "role_user" where "role_user"."user_id" in (1)  
[2024-08-28 10:52:47] local.INFO: select * from "drivers" where "drivers"."id" = 463 limit 1  
[2024-08-28 10:52:47] local.INFO: select * from "users" where "id" = 1  
[2024-08-28 10:52:47] local.INFO: select * from "users" where "id" = 1 limit 1  
[2024-08-28 10:52:47] local.INFO: select * from "role_user" where "role_user"."user_id" in (1)  
[2024-08-28 10:52:47] local.INFO: select sum("days") as aggregate from "driver_vehicle_px_experiences" where "driver_vehicle_px_experiences"."driver_id" is null and "driver_vehicle_px_experiences"."driver_id" is not null  
[2024-08-28 10:52:47] local.INFO: select sum("days") as aggregate from "driver_supply_px_experiences" where "driver_supply_px_experiences"."driver_id" is null and "driver_supply_px_experiences"."driver_id" is not null and exists (select * from "supplies" where "driver_supply_px_experiences"."supply_id" = "supplies"."id" and "name" != Nenhum)  
[2024-08-28 10:52:47] local.INFO: select exists(select * from "lead_campaign_results" where "lead_campaign_results"."driver_id" is null and "lead_campaign_results"."driver_id" is not null and "status" = campaign_canceled) as "exists"  
[2024-08-28 10:52:47] local.INFO: select * from "users" where "id" = 1  
[2024-08-28 10:52:47] local.INFO: select * from "users" where "id" = 1 limit 1  
[2024-08-28 10:52:47] local.INFO: select * from "role_user" where "role_user"."user_id" in (1)  
[2024-08-28 10:52:47] local.INFO: select * from "drivers" where "drivers"."id" = 463 limit 1  
[2024-08-28 10:52:47] local.INFO: select * from "driver_addresses" where "driver_addresses"."driver_id" = 463 and "driver_addresses"."driver_id" is not null order by "driver_addresses"."id" desc limit 6 offset 0  
[2024-08-28 10:52:47] local.INFO: select count(*) as aggregate from "driver_addresses" where "driver_addresses"."driver_id" = 463 and "driver_addresses"."driver_id" is not null  
[2024-08-28 10:52:47] local.INFO: select * from "users" where "id" = 1  
[2024-08-28 10:52:47] local.INFO: select "roles".*, "role_user"."user_id" as "pivot_user_id", "role_user"."role_id" as "pivot_role_id" from "roles" inner join "role_user" on "roles"."id" = "role_user"."role_id" where "role_user"."user_id" = 1  
[2024-08-28 10:52:47] local.INFO: select * from "role_user" where "role_user"."user_id" in (1)  
[2024-08-28 10:52:47] local.INFO: select * from "role_permission" where "role_permission"."role_id" in (3, 7)  
[2024-08-28 10:52:47] local.INFO: select * from "freights" where "freights"."id" is null limit 1  
[2024-08-28 10:52:47] local.INFO: select sum("days") as aggregate from "driver_vehicle_px_experiences" where "driver_vehicle_px_experiences"."driver_id" is null and "driver_vehicle_px_experiences"."driver_id" is not null  
[2024-08-28 10:52:47] local.INFO: select sum("days") as aggregate from "driver_supply_px_experiences" where "driver_supply_px_experiences"."driver_id" is null and "driver_supply_px_experiences"."driver_id" is not null and exists (select * from "supplies" where "driver_supply_px_experiences"."supply_id" = "supplies"."id" and "name" != Nenhum)  
[2024-08-28 10:52:47] local.INFO: select "roles".*, "role_user"."user_id" as "pivot_user_id", "role_user"."role_id" as "pivot_role_id" from "roles" inner join "role_user" on "roles"."id" = "role_user"."role_id" where "role_user"."user_id" = 1  
[2024-08-28 10:52:47] local.INFO: select exists(select * from "lead_campaign_results" where "lead_campaign_results"."driver_id" is null and "lead_campaign_results"."driver_id" is not null and "status" = campaign_canceled) as "exists"  
[2024-08-28 10:52:47] local.INFO: select * from "role_permission" where "role_permission"."role_id" in (3, 7)  
[2024-08-28 10:52:47] local.INFO: select * from "drivers" where "drivers"."id" = 463 limit 1  
[2024-08-28 10:52:47] local.INFO: select * from "users" where "id" = 1 limit 1  
[2024-08-28 10:52:47] local.INFO: select freights.*, company_freights.company_finished_freights_count from "freights" left join (select count(*) as company_finished_freights_count, company_id as company_id_1 from "freights" where "status" in (250, 260, 270, 280, 300) and "freights"."deleted_at" is null group by "company_id") as "company_freights" on "freights"."company_id" = "company_freights"."company_id_1" where "freights"."driver_id" = 463 and "freights"."driver_id" is not null and "freights"."deleted_at" is null order by "freights"."id" desc limit 6 offset 0  
[2024-08-28 10:52:47] local.INFO: select * from "contract_invoice" where "contract_invoice"."origin_id" in (3793, 3795, 3799, 3802, 3805, 3806) and "contract_invoice"."origin_type" = App\Models\Freight order by "id" desc  
[2024-08-28 10:52:47] local.INFO: select sum("days") as aggregate from "driver_vehicle_px_experiences" where "driver_vehicle_px_experiences"."driver_id" is null and "driver_vehicle_px_experiences"."driver_id" is not null  
[2024-08-28 10:52:47] local.INFO: select "id", "name" from "companies" where "companies"."id" in (191)  
[2024-08-28 10:52:47] local.INFO: select sum("days") as aggregate from "driver_supply_px_experiences" where "driver_supply_px_experiences"."driver_id" is null and "driver_supply_px_experiences"."driver_id" is not null and exists (select * from "supplies" where "driver_supply_px_experiences"."supply_id" = "supplies"."id" and "name" != Nenhum)  
[2024-08-28 10:52:47] local.INFO: select count(*) as aggregate from "freights" left join (select count(*) as company_finished_freights_count, company_id as company_id_1 from "freights" where "status" in (250, 260, 270, 280, 300) and "freights"."deleted_at" is null group by "company_id") as "company_freights" on "freights"."company_id" = "company_freights"."company_id_1" where "freights"."driver_id" = 463 and "freights"."driver_id" is not null and "freights"."deleted_at" is null  
[2024-08-28 10:52:47] local.INFO: select exists(select * from "lead_campaign_results" where "lead_campaign_results"."driver_id" is null and "lead_campaign_results"."driver_id" is not null and "status" = campaign_canceled) as "exists"  
[2024-08-28 10:52:47] local.INFO: select * from "users" where "id" = 1  
[2024-08-28 10:52:47] local.INFO: select * from "role_user" where "role_user"."user_id" in (1)  
[2024-08-28 10:52:47] local.INFO: select * from "px_control" where "px_control"."freight_id" = 3806 and "px_control"."freight_id" is not null limit 1  
[2024-08-28 10:52:47] local.INFO: select sum("days") as aggregate from "driver_vehicle_px_experiences" where "driver_vehicle_px_experiences"."driver_id" is null and "driver_vehicle_px_experiences"."driver_id" is not null  
[2024-08-28 10:52:47] local.INFO: select exists(select * from "discounts" where "driver_id" = 463 and exists (select * from "discount_balances" where "discounts"."id" = "discount_balances"."discount_id" and "value" > 0) and not "status" = rejected) as "exists"  
[2024-08-28 10:52:47] local.INFO: select sum("days") as aggregate from "driver_supply_px_experiences" where "driver_supply_px_experiences"."driver_id" is null and "driver_supply_px_experiences"."driver_id" is not null and exists (select * from "supplies" where "driver_supply_px_experiences"."supply_id" = "supplies"."id" and "name" != Nenhum)  
[2024-08-28 10:52:47] local.INFO: select exists(select * from "lead_campaign_results" where "lead_campaign_results"."driver_id" is null and "lead_campaign_results"."driver_id" is not null and "status" = campaign_canceled) as "exists"  
[2024-08-28 10:52:47] local.INFO: select count(*) as aggregate from "freights" where "driver_id" = 463 and "status" between 250 and 300 and "freights"."deleted_at" is null  
[2024-08-28 10:52:47] local.INFO: select * from "freights" where "freights"."id" is null limit 1  
[2024-08-28 10:52:47] local.INFO: select * from "drivers" where "drivers"."id" = 463 limit 1  
[2024-08-28 10:52:47] local.INFO: select * from "company_addresses" where "id" = 472 and "company_addresses"."deleted_at" is null limit 1  
[2024-08-28 10:52:47] local.INFO: select * from "freights" where "id" = 463 and "freights"."deleted_at" is null limit 1  
[2024-08-28 10:52:47] local.INFO: select * from "states" where "id" = 26 limit 1  
[2024-08-28 10:52:47] local.INFO: select * from "freights" where "id" = 463 and "freights"."deleted_at" is null limit 1  
[2024-08-28 10:52:47] local.INFO: select "roles".*, "role_user"."user_id" as "pivot_user_id", "role_user"."role_id" as "pivot_role_id" from "roles" inner join "role_user" on "roles"."id" = "role_user"."role_id" where "role_user"."user_id" = 1  
[2024-08-28 10:52:47] local.INFO: select sum("boosts"."value") as aggregate from "freight_boosts" inner join "boosts" on "freight_boosts"."boost_id" = "boosts"."id" where "freight_boosts"."freight_id" = 3806 and "freight_boosts"."freight_id" is not null and "boosts"."status" = active  
[2024-08-28 10:52:47] local.INFO: select * from "users" where "id" = 1 limit 1  
[2024-08-28 10:52:47] local.INFO: select sum("value") as aggregate from "discount_statements" where "discount_statements"."freight_id" = 3806 and "discount_statements"."freight_id" is not null  
[2024-08-28 10:52:47] local.INFO: select * from "role_permission" where "role_permission"."role_id" in (3, 7)  
[2024-08-28 10:52:47] local.INFO: select sum("amount") as aggregate from "freights_payment_orders" where "freights_payment_orders"."freight_id" = 3806 and "freights_payment_orders"."freight_id" is not null and exists (select * from "freights" where "freights_payment_orders"."freight_id" = "freights"."id" and "freights"."driver_id" = "freights_payment_orders"."driver_id" and "freights"."deleted_at" is null) and "type" in (1, 0) and "status" = 2  
[2024-08-28 10:52:47] local.INFO: select sum("amount") as aggregate from "freights_payment_orders" where "freights_payment_orders"."freight_id" = 3806 and "freights_payment_orders"."freight_id" is not null and exists (select * from "freights" where "freights_payment_orders"."freight_id" = "freights"."id" and "freights"."driver_id" = "freights_payment_orders"."driver_id" and "freights"."deleted_at" is null) and "type" in (1, 0) and "status" = 2  
[2024-08-28 10:52:47] local.INFO: select sum("value") as aggregate from "discount_statements" where "discount_statements"."freight_id" = 3806 and "discount_statements"."freight_id" is not null  
[2024-08-28 10:52:47] local.INFO: select sum("boosts"."value") as aggregate from "freight_boosts" inner join "boosts" on "freight_boosts"."boost_id" = "boosts"."id" where "freight_boosts"."freight_id" = 3806 and "freight_boosts"."freight_id" is not null and "boosts"."status" = active  
[2024-08-28 10:52:47] local.INFO: select * from "users" where "id" = 1  
[2024-08-28 10:52:47] local.INFO: select count(*) as aggregate from "driver_freight" where "freight_id" = 3806  
[2024-08-28 10:52:47] local.INFO: select * from "role_user" where "role_user"."user_id" in (1)  
[2024-08-28 10:52:47] local.INFO: select * from "bank_accounts" where "bank_accounts"."id" = 8 limit 1  
[2024-08-28 10:52:47] local.INFO: select * from "px_control" where "px_control"."freight_id" = 3805 and "px_control"."freight_id" is not null limit 1  
[2024-08-28 10:52:47] local.INFO: select exists(select * from "discounts" where "driver_id" = 463 and exists (select * from "discount_balances" where "discounts"."id" = "discount_balances"."discount_id" and "value" > 0) and not "status" = rejected) as "exists"  
[2024-08-28 10:52:47] local.INFO: select count(*) as aggregate from "freights" where "driver_id" = 463 and "status" between 250 and 300 and "freights"."deleted_at" is null  
[2024-08-28 10:52:47] local.INFO: select * from "drivers" where "drivers"."id" = 463 limit 1  
[2024-08-28 10:52:47] local.INFO: select * from "company_addresses" where "id" = 471 and "company_addresses"."deleted_at" is null limit 1  
[2024-08-28 10:52:47] local.INFO: select * from "states" where "id" = 26 limit 1  
[2024-08-28 10:52:47] local.INFO: select sum("boosts"."value") as aggregate from "freight_boosts" inner join "boosts" on "freight_boosts"."boost_id" = "boosts"."id" where "freight_boosts"."freight_id" = 3805 and "freight_boosts"."freight_id" is not null and "boosts"."status" = active  
[2024-08-28 10:52:47] local.INFO: select sum("value") as aggregate from "discount_statements" where "discount_statements"."freight_id" = 3805 and "discount_statements"."freight_id" is not null  
[2024-08-28 10:52:47] local.INFO: select sum("amount") as aggregate from "freights_payment_orders" where "freights_payment_orders"."freight_id" = 3805 and "freights_payment_orders"."freight_id" is not null and exists (select * from "freights" where "freights_payment_orders"."freight_id" = "freights"."id" and "freights"."driver_id" = "freights_payment_orders"."driver_id" and "freights"."deleted_at" is null) and "type" in (1, 0) and "status" = 2  
[2024-08-28 10:52:47] local.INFO: select sum("amount") as aggregate from "freights_payment_orders" where "freights_payment_orders"."freight_id" = 3805 and "freights_payment_orders"."freight_id" is not null and exists (select * from "freights" where "freights_payment_orders"."freight_id" = "freights"."id" and "freights"."driver_id" = "freights_payment_orders"."driver_id" and "freights"."deleted_at" is null) and "type" in (1, 0) and "status" = 2  
[2024-08-28 10:52:47] local.INFO: select sum("value") as aggregate from "discount_statements" where "discount_statements"."freight_id" = 3805 and "discount_statements"."freight_id" is not null  
[2024-08-28 10:52:47] local.INFO: select * from "freights" where "id" = 0 and "freights"."deleted_at" is null limit 1  
[2024-08-28 10:52:47] local.INFO: select sum("boosts"."value") as aggregate from "freight_boosts" inner join "boosts" on "freight_boosts"."boost_id" = "boosts"."id" where "freight_boosts"."freight_id" = 3805 and "freight_boosts"."freight_id" is not null and "boosts"."status" = active  
[2024-08-28 10:52:47] local.INFO: select count(*) as aggregate from "driver_freight" where "freight_id" = 3805  
[2024-08-28 10:52:47] local.INFO: select * from "freights" where "id" = 0 and "freights"."deleted_at" is null limit 1  
[2024-08-28 10:52:47] local.INFO: select * from "freights" where "id" = 0 and "freights"."deleted_at" is null limit 1  
[2024-08-28 10:52:47] local.INFO: select * from "freights" where "id" = 0 and "freights"."deleted_at" is null limit 1  
[2024-08-28 10:52:47] local.INFO: select * from "px_control" where "px_control"."freight_id" = 3802 and "px_control"."freight_id" is not null limit 1  
[2024-08-28 10:52:47] local.INFO: select exists(select * from "discounts" where "driver_id" = 463 and exists (select * from "discount_balances" where "discounts"."id" = "discount_balances"."discount_id" and "value" > 0) and not "status" = rejected) as "exists"  
[2024-08-28 10:52:47] local.INFO: select * from "discounts" where exists (select * from "discount_balances" where "discounts"."id" = "discount_balances"."discount_id" and ("value" > 0 or "value" is null)) and not exists (select * from "discount_negotiations" where "discounts"."id" = "discount_negotiations"."discount_id") and not "status" = rejected and not "status" = extra_negotiation  
[2024-08-28 10:52:47] local.INFO: select count(*) as aggregate from "freights" where "driver_id" = 463 and "status" between 250 and 300 and "freights"."deleted_at" is null  
[2024-08-28 10:52:47] local.INFO: select * from "drivers" where "drivers"."id" = 463 limit 1  
[2024-08-28 10:52:47] local.INFO: select * from "company_addresses" where "id" = 462 and "company_addresses"."deleted_at" is null limit 1  
[2024-08-28 10:52:47] local.INFO: select * from "states" where "id" = 24 limit 1  
[2024-08-28 10:52:47] local.INFO: select sum("boosts"."value") as aggregate from "freight_boosts" inner join "boosts" on "freight_boosts"."boost_id" = "boosts"."id" where "freight_boosts"."freight_id" = 3802 and "freight_boosts"."freight_id" is not null and "boosts"."status" = active  
[2024-08-28 10:52:47] local.INFO: select sum("value") as aggregate from "discount_statements" where "discount_statements"."freight_id" = 3802 and "discount_statements"."freight_id" is not null  
[2024-08-28 10:52:47] local.INFO: select sum("amount") as aggregate from "freights_payment_orders" where "freights_payment_orders"."freight_id" = 3802 and "freights_payment_orders"."freight_id" is not null and exists (select * from "freights" where "freights_payment_orders"."freight_id" = "freights"."id" and "freights"."driver_id" = "freights_payment_orders"."driver_id" and "freights"."deleted_at" is null) and "type" in (1, 0) and "status" = 2  
[2024-08-28 10:52:47] local.INFO: select sum("amount") as aggregate from "freights_payment_orders" where "freights_payment_orders"."freight_id" = 3802 and "freights_payment_orders"."freight_id" is not null and exists (select * from "freights" where "freights_payment_orders"."freight_id" = "freights"."id" and "freights"."driver_id" = "freights_payment_orders"."driver_id" and "freights"."deleted_at" is null) and "type" in (1, 0) and "status" = 2  
[2024-08-28 10:52:47] local.INFO: select sum("value") as aggregate from "discount_statements" where "discount_statements"."freight_id" = 3802 and "discount_statements"."freight_id" is not null  
[2024-08-28 10:52:47] local.INFO: select sum("boosts"."value") as aggregate from "freight_boosts" inner join "boosts" on "freight_boosts"."boost_id" = "boosts"."id" where "freight_boosts"."freight_id" = 3802 and "freight_boosts"."freight_id" is not null and "boosts"."status" = active  
[2024-08-28 10:52:47] local.INFO: select count(*) as aggregate from "driver_freight" where "freight_id" = 3802  
[2024-08-28 10:52:47] local.INFO: select * from "px_control" where "px_control"."freight_id" = 3799 and "px_control"."freight_id" is not null limit 1  
[2024-08-28 10:52:47] local.INFO: select * from "users" where "id" = 1 limit 1  
[2024-08-28 10:52:47] local.INFO: select exists(select * from "discounts" where "driver_id" = 463 and exists (select * from "discount_balances" where "discounts"."id" = "discount_balances"."discount_id" and "value" > 0) and not "status" = rejected) as "exists"  
[2024-08-28 10:52:47] local.INFO: select count(*) as aggregate from "freights" where "driver_id" = 463 and "status" between 250 and 300 and "freights"."deleted_at" is null  
[2024-08-28 10:52:47] local.INFO: select * from "drivers" where "drivers"."id" = 463 limit 1  
[2024-08-28 10:52:47] local.INFO: select * from "company_addresses" where "id" = 480 and "company_addresses"."deleted_at" is null limit 1  
[2024-08-28 10:52:47] local.INFO: select * from "states" where "id" = 26 limit 1  
[2024-08-28 10:52:47] local.INFO: select sum("boosts"."value") as aggregate from "freight_boosts" inner join "boosts" on "freight_boosts"."boost_id" = "boosts"."id" where "freight_boosts"."freight_id" = 3799 and "freight_boosts"."freight_id" is not null and "boosts"."status" = active  
[2024-08-28 10:52:47] local.INFO: select * from "users" where "id" = 1  
[2024-08-28 10:52:47] local.INFO: select sum("value") as aggregate from "discount_statements" where "discount_statements"."freight_id" = 3799 and "discount_statements"."freight_id" is not null  
[2024-08-28 10:52:47] local.INFO: select * from "role_user" where "role_user"."user_id" in (1)  
[2024-08-28 10:52:47] local.INFO: select sum("amount") as aggregate from "freights_payment_orders" where "freights_payment_orders"."freight_id" = 3799 and "freights_payment_orders"."freight_id" is not null and exists (select * from "freights" where "freights_payment_orders"."freight_id" = "freights"."id" and "freights"."driver_id" = "freights_payment_orders"."driver_id" and "freights"."deleted_at" is null) and "type" in (1, 0) and "status" = 2  
[2024-08-28 10:52:47] local.INFO: select sum("amount") as aggregate from "freights_payment_orders" where "freights_payment_orders"."freight_id" = 3799 and "freights_payment_orders"."freight_id" is not null and exists (select * from "freights" where "freights_payment_orders"."freight_id" = "freights"."id" and "freights"."driver_id" = "freights_payment_orders"."driver_id" and "freights"."deleted_at" is null) and "type" in (1, 0) and "status" = 2  
[2024-08-28 10:52:47] local.INFO: select sum("value") as aggregate from "discount_statements" where "discount_statements"."freight_id" = 3799 and "discount_statements"."freight_id" is not null  
[2024-08-28 10:52:47] local.INFO: select sum("boosts"."value") as aggregate from "freight_boosts" inner join "boosts" on "freight_boosts"."boost_id" = "boosts"."id" where "freight_boosts"."freight_id" = 3799 and "freight_boosts"."freight_id" is not null and "boosts"."status" = active  
[2024-08-28 10:52:47] local.INFO: select * from "driver_observations" where "driver_observations"."id" is null limit 1  
[2024-08-28 10:52:47] local.INFO: select count(*) as aggregate from "driver_freight" where "freight_id" = 3799  
[2024-08-28 10:52:47] local.INFO: select sum("days") as aggregate from "driver_vehicle_px_experiences" where "driver_vehicle_px_experiences"."driver_id" is null and "driver_vehicle_px_experiences"."driver_id" is not null  
[2024-08-28 10:52:47] local.INFO: select * from "users" where "id" = 1 limit 1  
[2024-08-28 10:52:47] local.INFO: select sum("days") as aggregate from "driver_supply_px_experiences" where "driver_supply_px_experiences"."driver_id" is null and "driver_supply_px_experiences"."driver_id" is not null and exists (select * from "supplies" where "driver_supply_px_experiences"."supply_id" = "supplies"."id" and "name" != Nenhum)  
[2024-08-28 10:52:47] local.INFO: select exists(select * from "lead_campaign_results" where "lead_campaign_results"."driver_id" is null and "lead_campaign_results"."driver_id" is not null and "status" = campaign_canceled) as "exists"  
[2024-08-28 10:52:47] local.INFO: select * from "px_control" where "px_control"."freight_id" = 3795 and "px_control"."freight_id" is not null limit 1  
[2024-08-28 10:52:47] local.INFO: select exists(select * from "discounts" where "driver_id" = 463 and exists (select * from "discount_balances" where "discounts"."id" = "discount_balances"."discount_id" and "value" > 0) and not "status" = rejected) as "exists"  
[2024-08-28 10:52:47] local.INFO: select sum("days") as aggregate from "driver_vehicle_px_experiences" where "driver_vehicle_px_experiences"."driver_id" is null and "driver_vehicle_px_experiences"."driver_id" is not null  
[2024-08-28 10:52:47] local.INFO: select sum("days") as aggregate from "driver_supply_px_experiences" where "driver_supply_px_experiences"."driver_id" is null and "driver_supply_px_experiences"."driver_id" is not null and exists (select * from "supplies" where "driver_supply_px_experiences"."supply_id" = "supplies"."id" and "name" != Nenhum)  
[2024-08-28 10:52:47] local.INFO: select count(*) as aggregate from "freights" where "driver_id" = 463 and "status" between 250 and 300 and "freights"."deleted_at" is null  
[2024-08-28 10:52:47] local.INFO: select exists(select * from "lead_campaign_results" where "lead_campaign_results"."driver_id" is null and "lead_campaign_results"."driver_id" is not null and "status" = campaign_canceled) as "exists"  
[2024-08-28 10:52:47] local.INFO: select * from "drivers" where "drivers"."id" = 463 limit 1  
[2024-08-28 10:52:47] local.INFO: select * from "company_addresses" where "id" = 462 and "company_addresses"."deleted_at" is null limit 1  
[2024-08-28 10:52:47] local.INFO: select * from "states" where "id" = 24 limit 1  
[2024-08-28 10:52:47] local.INFO: select sum("boosts"."value") as aggregate from "freight_boosts" inner join "boosts" on "freight_boosts"."boost_id" = "boosts"."id" where "freight_boosts"."freight_id" = 3795 and "freight_boosts"."freight_id" is not null and "boosts"."status" = active  
[2024-08-28 10:52:47] local.INFO: select * from "users" where "id" = 1  
[2024-08-28 10:52:47] local.INFO: select sum("value") as aggregate from "discount_statements" where "discount_statements"."freight_id" = 3795 and "discount_statements"."freight_id" is not null  
[2024-08-28 10:52:47] local.INFO: select * from "role_user" where "role_user"."user_id" in (1)  
[2024-08-28 10:52:47] local.INFO: select sum("amount") as aggregate from "freights_payment_orders" where "freights_payment_orders"."freight_id" = 3795 and "freights_payment_orders"."freight_id" is not null and exists (select * from "freights" where "freights_payment_orders"."freight_id" = "freights"."id" and "freights"."driver_id" = "freights_payment_orders"."driver_id" and "freights"."deleted_at" is null) and "type" in (1, 0) and "status" = 2  
[2024-08-28 10:52:47] local.INFO: select sum("amount") as aggregate from "freights_payment_orders" where "freights_payment_orders"."freight_id" = 3795 and "freights_payment_orders"."freight_id" is not null and exists (select * from "freights" where "freights_payment_orders"."freight_id" = "freights"."id" and "freights"."driver_id" = "freights_payment_orders"."driver_id" and "freights"."deleted_at" is null) and "type" in (1, 0) and "status" = 2  
[2024-08-28 10:52:47] local.INFO: select * from "bank_pixes" where "bank_pixes"."id" = 27 limit 1  
[2024-08-28 10:52:47] local.INFO: select sum("value") as aggregate from "discount_statements" where "discount_statements"."freight_id" = 3795 and "discount_statements"."freight_id" is not null  
[2024-08-28 10:52:47] local.INFO: select sum("boosts"."value") as aggregate from "freight_boosts" inner join "boosts" on "freight_boosts"."boost_id" = "boosts"."id" where "freight_boosts"."freight_id" = 3795 and "freight_boosts"."freight_id" is not null and "boosts"."status" = active  
[2024-08-28 10:52:47] local.INFO: select count(*) as aggregate from "driver_freight" where "freight_id" = 3795  
[2024-08-28 10:52:47] local.INFO: select * from "users" where "id" = 1 limit 1  
[2024-08-28 10:52:47] local.INFO: select * from "users" where "id" = 1  
[2024-08-28 10:52:47] local.INFO: select * from "role_user" where "role_user"."user_id" in (1)  
[2024-08-28 10:52:47] local.INFO: select * from "driver_observations" where "driver_observations"."id" is null limit 1  
[2024-08-28 10:52:47] local.INFO: select * from "users" where "id" = 1 limit 1  
[2024-08-28 10:52:47] local.INFO: select * from "users" where "id" = 1  
[2024-08-28 10:52:47] local.INFO: select * from "role_user" where "role_user"."user_id" in (1)  
[2024-08-28 10:52:47] local.INFO: select * from "driver_addresses" where "driver_addresses"."id" is null limit 1  
[2024-08-28 10:52:47] local.INFO: select * from "users" where "id" = 1 limit 1  
[2024-08-28 10:52:47] local.INFO: select sum("days") as aggregate from "driver_vehicle_px_experiences" where "driver_vehicle_px_experiences"."driver_id" is null and "driver_vehicle_px_experiences"."driver_id" is not null  
[2024-08-28 10:52:47] local.INFO: select sum("days") as aggregate from "driver_supply_px_experiences" where "driver_supply_px_experiences"."driver_id" is null and "driver_supply_px_experiences"."driver_id" is not null and exists (select * from "supplies" where "driver_supply_px_experiences"."supply_id" = "supplies"."id" and "name" != Nenhum)  
[2024-08-28 10:52:47] local.INFO: select exists(select * from "lead_campaign_results" where "lead_campaign_results"."driver_id" is null and "lead_campaign_results"."driver_id" is not null and "status" = campaign_canceled) as "exists"  
[2024-08-28 10:52:47] local.INFO: select * from "users" where "id" = 1  
[2024-08-28 10:52:47] local.INFO: select * from "role_user" where "role_user"."user_id" in (1)  
[2024-08-28 10:52:47] local.INFO: select sum("days") as aggregate from "driver_vehicle_px_experiences" where "driver_vehicle_px_experiences"."driver_id" is null and "driver_vehicle_px_experiences"."driver_id" is not null  
[2024-08-28 10:52:47] local.INFO: select sum("days") as aggregate from "driver_supply_px_experiences" where "driver_supply_px_experiences"."driver_id" is null and "driver_supply_px_experiences"."driver_id" is not null and exists (select * from "supplies" where "driver_supply_px_experiences"."supply_id" = "supplies"."id" and "name" != Nenhum)  
[2024-08-28 10:52:47] local.INFO: select exists(select * from "lead_campaign_results" where "lead_campaign_results"."driver_id" is null and "lead_campaign_results"."driver_id" is not null and "status" = campaign_canceled) as "exists"  
[2024-08-28 10:52:47] local.INFO: select * from "driver_addresses" where "driver_addresses"."id" is null limit 1  
[2024-08-28 10:52:53] local.INFO: select * from "users" where "id" = 1 limit 1  
[2024-08-28 10:52:53] local.INFO: select * from "users" where "id" = 1  
[2024-08-28 10:52:53] local.INFO: select * from "role_user" where "role_user"."user_id" in (1)  
[2024-08-28 10:52:53] local.INFO: select * from "nova_notifications" where "notifiable_id" = 1 and "nova_notifications"."deleted_at" is null order by "created_at" desc limit 100  
[2024-08-28 10:52:53] local.INFO: select count(*) as aggregate from "nova_notifications" where "read_at" is null and "notifiable_id" = 1 and "nova_notifications"."deleted_at" is null  
[2024-08-28 10:52:55] local.INFO: select * from "users" where "id" = 1 limit 1  
[2024-08-28 10:52:55] local.INFO: select * from "users" where "id" = 1  
[2024-08-28 10:52:55] local.INFO: select * from "role_user" where "role_user"."user_id" in (1)  
[2024-08-28 10:52:55] local.INFO: select * from "users" where "id" = 1 limit 1  
[2024-08-28 10:52:55] local.INFO: select * from "users" where "id" = 1 limit 1  
[2024-08-28 10:52:55] local.INFO: select * from "drivers" where "drivers"."id" = 463 limit 1  
[2024-08-28 10:52:55] local.INFO: select * from "users" where "id" = 1  
[2024-08-28 10:52:55] local.INFO: select * from "role_user" where "role_user"."user_id" in (1)  
[2024-08-28 10:52:55] local.INFO: select * from "users" where "id" = 1  
[2024-08-28 10:52:55] local.INFO: select * from "role_user" where "role_user"."user_id" in (1)  
[2024-08-28 10:52:55] local.INFO: select * from "cadex_driver_qualification_step" where "cadex_driver_qualification_step"."id" is null limit 1  
[2024-08-28 10:52:55] local.INFO: select "roles".*, "role_user"."user_id" as "pivot_user_id", "role_user"."role_id" as "pivot_role_id" from "roles" inner join "role_user" on "roles"."id" = "role_user"."role_id" where "role_user"."user_id" = 1  
[2024-08-28 10:52:55] local.INFO: select * from "role_permission" where "role_permission"."role_id" in (3, 7)  
[2024-08-28 10:52:55] local.INFO: select sum("days") as aggregate from "driver_vehicle_px_experiences" where "driver_vehicle_px_experiences"."driver_id" is null and "driver_vehicle_px_experiences"."driver_id" is not null  
[2024-08-28 10:52:55] local.INFO: select sum("days") as aggregate from "driver_supply_px_experiences" where "driver_supply_px_experiences"."driver_id" is null and "driver_supply_px_experiences"."driver_id" is not null and exists (select * from "supplies" where "driver_supply_px_experiences"."supply_id" = "supplies"."id" and "name" != Nenhum)  
[2024-08-28 10:52:55] local.INFO: select exists(select * from "lead_campaign_results" where "lead_campaign_results"."driver_id" is null and "lead_campaign_results"."driver_id" is not null and "status" = campaign_canceled) as "exists"  
[2024-08-28 10:52:55] local.INFO: select * from "drivers" where "drivers"."id" = 463 limit 1  
[2024-08-28 10:52:55] local.INFO: select sum("days") as aggregate from "driver_vehicle_px_experiences" where "driver_vehicle_px_experiences"."driver_id" is null and "driver_vehicle_px_experiences"."driver_id" is not null  
[2024-08-28 10:52:55] local.INFO: select sum("days") as aggregate from "driver_supply_px_experiences" where "driver_supply_px_experiences"."driver_id" is null and "driver_supply_px_experiences"."driver_id" is not null and exists (select * from "supplies" where "driver_supply_px_experiences"."supply_id" = "supplies"."id" and "name" != Nenhum)  
[2024-08-28 10:52:55] local.INFO: select exists(select * from "lead_campaign_results" where "lead_campaign_results"."driver_id" is null and "lead_campaign_results"."driver_id" is not null and "status" = campaign_canceled) as "exists"  
[2024-08-28 10:52:55] local.INFO: select * from "cadex_driver_qualification_step" where "cadex_driver_qualification_step"."driver_id" = 463 and "cadex_driver_qualification_step"."driver_id" is not null order by "cadex_driver_qualification_step"."id" desc limit 6 offset 0  
[2024-08-28 10:52:55] local.INFO: select count(*) as aggregate from "cadex_driver_qualification_step" where "cadex_driver_qualification_step"."driver_id" = 463 and "cadex_driver_qualification_step"."driver_id" is not null  
[2024-08-28 10:52:55] local.INFO: select sum("days") as aggregate from "driver_vehicle_px_experiences" where "driver_vehicle_px_experiences"."driver_id" is null and "driver_vehicle_px_experiences"."driver_id" is not null  
[2024-08-28 10:52:55] local.INFO: select * from "users" where "id" = 1 limit 1  
[2024-08-28 10:52:55] local.INFO: select sum("days") as aggregate from "driver_supply_px_experiences" where "driver_supply_px_experiences"."driver_id" is null and "driver_supply_px_experiences"."driver_id" is not null and exists (select * from "supplies" where "driver_supply_px_experiences"."supply_id" = "supplies"."id" and "name" != Nenhum)  
[2024-08-28 10:52:55] local.INFO: select exists(select * from "lead_campaign_results" where "lead_campaign_results"."driver_id" is null and "lead_campaign_results"."driver_id" is not null and "status" = campaign_canceled) as "exists"  
[2024-08-28 10:52:55] local.INFO: select * from "users" where "users"."id" = 1 limit 1  
[2024-08-28 10:52:55] local.INFO: select * from "users" where "id" = 1  
[2024-08-28 10:52:55] local.INFO: select * from "role_user" where "role_user"."user_id" in (1)  
[2024-08-28 10:52:55] local.INFO: select * from "cadex_driver_qualification_step" where "cadex_driver_qualification_step"."id" is null limit 1  
[2024-08-28 10:52:55] local.INFO: select sum("days") as aggregate from "driver_vehicle_px_experiences" where "driver_vehicle_px_experiences"."driver_id" is null and "driver_vehicle_px_experiences"."driver_id" is not null  
[2024-08-28 10:52:55] local.INFO: select sum("days") as aggregate from "driver_supply_px_experiences" where "driver_supply_px_experiences"."driver_id" is null and "driver_supply_px_experiences"."driver_id" is not null and exists (select * from "supplies" where "driver_supply_px_experiences"."supply_id" = "supplies"."id" and "name" != Nenhum)  
[2024-08-28 10:52:55] local.INFO: select exists(select * from "lead_campaign_results" where "lead_campaign_results"."driver_id" is null and "lead_campaign_results"."driver_id" is not null and "status" = campaign_canceled) as "exists"  
[2024-08-28 10:52:55] local.INFO: select sum("days") as aggregate from "driver_vehicle_px_experiences" where "driver_vehicle_px_experiences"."driver_id" is null and "driver_vehicle_px_experiences"."driver_id" is not null  
[2024-08-28 10:52:55] local.INFO: select sum("days") as aggregate from "driver_supply_px_experiences" where "driver_supply_px_experiences"."driver_id" is null and "driver_supply_px_experiences"."driver_id" is not null and exists (select * from "supplies" where "driver_supply_px_experiences"."supply_id" = "supplies"."id" and "name" != Nenhum)  
[2024-08-28 10:52:55] local.INFO: select exists(select * from "lead_campaign_results" where "lead_campaign_results"."driver_id" is null and "lead_campaign_results"."driver_id" is not null and "status" = campaign_canceled) as "exists"  
[2024-08-28 10:52:57] local.INFO: select * from "users" where "id" = 1 limit 1  
[2024-08-28 10:52:57] local.INFO: select * from "users" where "id" = 1  
[2024-08-28 10:52:57] local.INFO: select * from "users" where "id" = 1 limit 1  
[2024-08-28 10:52:57] local.INFO: select * from "role_user" where "role_user"."user_id" in (1)  
[2024-08-28 10:52:57] local.INFO: select * from "driver_proof_of_address" where "driver_proof_of_address"."id" is null limit 1  
[2024-08-28 10:52:57] local.INFO: select * from "users" where "id" = 1  
[2024-08-28 10:52:57] local.INFO: select * from "users" where "id" = 1 limit 1  
[2024-08-28 10:52:57] local.INFO: select * from "role_user" where "role_user"."user_id" in (1)  
[2024-08-28 10:52:57] local.INFO: select * from "drivers" where "drivers"."id" = 463 limit 1  
[2024-08-28 10:52:57] local.INFO: select "roles".*, "role_user"."user_id" as "pivot_user_id", "role_user"."role_id" as "pivot_role_id" from "roles" inner join "role_user" on "roles"."id" = "role_user"."role_id" where "role_user"."user_id" = 1  
[2024-08-28 10:52:57] local.INFO: select * from "role_permission" where "role_permission"."role_id" in (3, 7)  
[2024-08-28 10:52:57] local.INFO: select * from "users" where "id" = 1  
[2024-08-28 10:52:57] local.INFO: select * from "role_user" where "role_user"."user_id" in (1)  
[2024-08-28 10:52:57] local.INFO: select "roles".*, "role_user"."user_id" as "pivot_user_id", "role_user"."role_id" as "pivot_role_id" from "roles" inner join "role_user" on "roles"."id" = "role_user"."role_id" where "role_user"."user_id" = 1  
[2024-08-28 10:52:57] local.INFO: select * from "role_permission" where "role_permission"."role_id" in (3, 7)  
[2024-08-28 10:52:57] local.INFO: select sum("days") as aggregate from "driver_vehicle_px_experiences" where "driver_vehicle_px_experiences"."driver_id" is null and "driver_vehicle_px_experiences"."driver_id" is not null  
[2024-08-28 10:52:57] local.INFO: select sum("days") as aggregate from "driver_supply_px_experiences" where "driver_supply_px_experiences"."driver_id" is null and "driver_supply_px_experiences"."driver_id" is not null and exists (select * from "supplies" where "driver_supply_px_experiences"."supply_id" = "supplies"."id" and "name" != Nenhum)  
[2024-08-28 10:52:57] local.INFO: select exists(select * from "lead_campaign_results" where "lead_campaign_results"."driver_id" is null and "lead_campaign_results"."driver_id" is not null and "status" = campaign_canceled) as "exists"  
[2024-08-28 10:52:57] local.INFO: select * from "drivers" where "drivers"."id" = 463 limit 1  
[2024-08-28 10:52:57] local.INFO: select sum("days") as aggregate from "driver_vehicle_px_experiences" where "driver_vehicle_px_experiences"."driver_id" is null and "driver_vehicle_px_experiences"."driver_id" is not null  
[2024-08-28 10:52:57] local.INFO: select sum("days") as aggregate from "driver_supply_px_experiences" where "driver_supply_px_experiences"."driver_id" is null and "driver_supply_px_experiences"."driver_id" is not null and exists (select * from "supplies" where "driver_supply_px_experiences"."supply_id" = "supplies"."id" and "name" != Nenhum)  
[2024-08-28 10:52:57] local.INFO: select exists(select * from "lead_campaign_results" where "lead_campaign_results"."driver_id" is null and "lead_campaign_results"."driver_id" is not null and "status" = campaign_canceled) as "exists"  
[2024-08-28 10:52:57] local.INFO: select * from "driver_proof_of_address" where "driver_proof_of_address"."driver_id" = 463 and "driver_proof_of_address"."driver_id" is not null order by "driver_proof_of_address"."id" desc limit 6 offset 0  
[2024-08-28 10:52:57] local.INFO: select count(*) as aggregate from "driver_proof_of_address" where "driver_proof_of_address"."driver_id" = 463 and "driver_proof_of_address"."driver_id" is not null  
[2024-08-28 10:52:57] local.INFO: select sum("days") as aggregate from "driver_vehicle_px_experiences" where "driver_vehicle_px_experiences"."driver_id" is null and "driver_vehicle_px_experiences"."driver_id" is not null  
[2024-08-28 10:52:57] local.INFO: select sum("days") as aggregate from "driver_supply_px_experiences" where "driver_supply_px_experiences"."driver_id" is null and "driver_supply_px_experiences"."driver_id" is not null and exists (select * from "supplies" where "driver_supply_px_experiences"."supply_id" = "supplies"."id" and "name" != Nenhum)  
[2024-08-28 10:52:57] local.INFO: select exists(select * from "lead_campaign_results" where "lead_campaign_results"."driver_id" is null and "lead_campaign_results"."driver_id" is not null and "status" = campaign_canceled) as "exists"  
[2024-08-28 10:52:57] local.INFO: select * from "users" where "users"."id" = 2 limit 1  
[2024-08-28 10:52:57] local.INFO: select sum("days") as aggregate from "driver_vehicle_px_experiences" where "driver_vehicle_px_experiences"."driver_id" is null and "driver_vehicle_px_experiences"."driver_id" is not null  
[2024-08-28 10:52:57] local.INFO: select sum("days") as aggregate from "driver_supply_px_experiences" where "driver_supply_px_experiences"."driver_id" is null and "driver_supply_px_experiences"."driver_id" is not null and exists (select * from "supplies" where "driver_supply_px_experiences"."supply_id" = "supplies"."id" and "name" != Nenhum)  
[2024-08-28 10:52:57] local.INFO: select exists(select * from "lead_campaign_results" where "lead_campaign_results"."driver_id" is null and "lead_campaign_results"."driver_id" is not null and "status" = campaign_canceled) as "exists"  
[2024-08-28 10:52:57] local.INFO: select * from "users" where "users"."id" = 1 limit 1  
[2024-08-28 10:52:57] local.INFO: select * from "users" where "id" = 1 limit 1  
[2024-08-28 10:52:57] local.INFO: select * from "users" where "id" = 1  
[2024-08-28 10:52:57] local.INFO: select * from "role_user" where "role_user"."user_id" in (1)  
[2024-08-28 10:52:57] local.INFO: select * from "driver_proof_of_address" where "driver_proof_of_address"."id" is null limit 1  
[2024-08-28 10:52:57] local.INFO: select sum("days") as aggregate from "driver_vehicle_px_experiences" where "driver_vehicle_px_experiences"."driver_id" is null and "driver_vehicle_px_experiences"."driver_id" is not null  
[2024-08-28 10:52:57] local.INFO: select sum("days") as aggregate from "driver_supply_px_experiences" where "driver_supply_px_experiences"."driver_id" is null and "driver_supply_px_experiences"."driver_id" is not null and exists (select * from "supplies" where "driver_supply_px_experiences"."supply_id" = "supplies"."id" and "name" != Nenhum)  
[2024-08-28 10:52:57] local.INFO: select exists(select * from "lead_campaign_results" where "lead_campaign_results"."driver_id" is null and "lead_campaign_results"."driver_id" is not null and "status" = campaign_canceled) as "exists"  
[2024-08-28 10:52:57] local.INFO: select sum("days") as aggregate from "driver_vehicle_px_experiences" where "driver_vehicle_px_experiences"."driver_id" is null and "driver_vehicle_px_experiences"."driver_id" is not null  
[2024-08-28 10:52:57] local.INFO: select sum("days") as aggregate from "driver_supply_px_experiences" where "driver_supply_px_experiences"."driver_id" is null and "driver_supply_px_experiences"."driver_id" is not null and exists (select * from "supplies" where "driver_supply_px_experiences"."supply_id" = "supplies"."id" and "name" != Nenhum)  
[2024-08-28 10:52:57] local.INFO: select exists(select * from "lead_campaign_results" where "lead_campaign_results"."driver_id" is null and "lead_campaign_results"."driver_id" is not null and "status" = campaign_canceled) as "exists"  
[2024-08-28 10:52:59] local.INFO: select * from "users" where "id" = 1 limit 1  
[2024-08-28 10:52:59] local.INFO: select * from "users" where "id" = 1 limit 1  
[2024-08-28 10:52:59] local.INFO: select * from "users" where "id" = 1  
[2024-08-28 10:52:59] local.INFO: select * from "role_user" where "role_user"."user_id" in (1)  
[2024-08-28 10:52:59] local.INFO: select * from "driver_behavior_occurrence_update" where "driver_behavior_occurrence_update"."id" is null limit 1  
[2024-08-28 10:52:59] local.INFO: select * from "users" where "id" = 1 limit 1  
[2024-08-28 10:52:59] local.INFO: select sum("days") as aggregate from "driver_vehicle_px_experiences" where "driver_vehicle_px_experiences"."driver_id" is null and "driver_vehicle_px_experiences"."driver_id" is not null  
[2024-08-28 10:52:59] local.INFO: select sum("days") as aggregate from "driver_supply_px_experiences" where "driver_supply_px_experiences"."driver_id" is null and "driver_supply_px_experiences"."driver_id" is not null and exists (select * from "supplies" where "driver_supply_px_experiences"."supply_id" = "supplies"."id" and "name" != Nenhum)  
[2024-08-28 10:52:59] local.INFO: select * from "users" where "id" = 1  
[2024-08-28 10:52:59] local.INFO: select exists(select * from "lead_campaign_results" where "lead_campaign_results"."driver_id" is null and "lead_campaign_results"."driver_id" is not null and "status" = campaign_canceled) as "exists"  
[2024-08-28 10:52:59] local.INFO: select * from "role_user" where "role_user"."user_id" in (1)  
[2024-08-28 10:52:59] local.INFO: select "roles".*, "role_user"."user_id" as "pivot_user_id", "role_user"."role_id" as "pivot_role_id" from "roles" inner join "role_user" on "roles"."id" = "role_user"."role_id" where "role_user"."user_id" = 1  
[2024-08-28 10:52:59] local.INFO: select sum("days") as aggregate from "driver_vehicle_px_experiences" where "driver_vehicle_px_experiences"."driver_id" is null and "driver_vehicle_px_experiences"."driver_id" is not null  
[2024-08-28 10:52:59] local.INFO: select * from "role_permission" where "role_permission"."role_id" in (3, 7)  
[2024-08-28 10:52:59] local.INFO: select * from "users" where "id" = 1  
[2024-08-28 10:52:59] local.INFO: select sum("days") as aggregate from "driver_supply_px_experiences" where "driver_supply_px_experiences"."driver_id" is null and "driver_supply_px_experiences"."driver_id" is not null and exists (select * from "supplies" where "driver_supply_px_experiences"."supply_id" = "supplies"."id" and "name" != Nenhum)  
[2024-08-28 10:52:59] local.INFO: select exists(select * from "lead_campaign_results" where "lead_campaign_results"."driver_id" is null and "lead_campaign_results"."driver_id" is not null and "status" = campaign_canceled) as "exists"  
[2024-08-28 10:52:59] local.INFO: select * from "role_user" where "role_user"."user_id" in (1)  
[2024-08-28 10:52:59] local.INFO: select * from "driver_behavior_occurrence_update" where "driver_behavior_occurrence_update"."id" is null limit 1  
[2024-08-28 10:52:59] local.INFO: select sum("days") as aggregate from "driver_vehicle_px_experiences" where "driver_vehicle_px_experiences"."driver_id" is null and "driver_vehicle_px_experiences"."driver_id" is not null  
[2024-08-28 10:52:59] local.INFO: select sum("days") as aggregate from "driver_supply_px_experiences" where "driver_supply_px_experiences"."driver_id" is null and "driver_supply_px_experiences"."driver_id" is not null and exists (select * from "supplies" where "driver_supply_px_experiences"."supply_id" = "supplies"."id" and "name" != Nenhum)  
[2024-08-28 10:52:59] local.INFO: select exists(select * from "lead_campaign_results" where "lead_campaign_results"."driver_id" is null and "lead_campaign_results"."driver_id" is not null and "status" = campaign_canceled) as "exists"  
[2024-08-28 10:52:59] local.INFO: select * from "drivers" where "drivers"."id" = 463 limit 1  
[2024-08-28 10:52:59] local.INFO: select sum("days") as aggregate from "driver_vehicle_px_experiences" where "driver_vehicle_px_experiences"."driver_id" is null and "driver_vehicle_px_experiences"."driver_id" is not null  
[2024-08-28 10:52:59] local.INFO: select sum("days") as aggregate from "driver_supply_px_experiences" where "driver_supply_px_experiences"."driver_id" is null and "driver_supply_px_experiences"."driver_id" is not null and exists (select * from "supplies" where "driver_supply_px_experiences"."supply_id" = "supplies"."id" and "name" != Nenhum)  
[2024-08-28 10:52:59] local.INFO: select exists(select * from "lead_campaign_results" where "lead_campaign_results"."driver_id" is null and "lead_campaign_results"."driver_id" is not null and "status" = campaign_canceled) as "exists"  
[2024-08-28 10:52:59] local.INFO: select * from "driver_behavior_occurrence_update" where "driver_behavior_occurrence_update"."driver_id" = 463 and "driver_behavior_occurrence_update"."driver_id" is not null order by "driver_behavior_occurrence_update"."id" desc limit 6 offset 0  
[2024-08-28 10:52:59] local.INFO: select "driver_behavior_occurrence".*, "driver_behavior_occurrence_updates"."driver_behavior_occurrence_update_id" as "pivot_driver_behavior_occurrence_update_id", "driver_behavior_occurrence_updates"."driver_behavior_occurrence_id" as "pivot_driver_behavior_occurrence_id" from "driver_behavior_occurrence" inner join "driver_behavior_occurrence_updates" on "driver_behavior_occurrence"."id" = "driver_behavior_occurrence_updates"."driver_behavior_occurrence_id" where "driver_behavior_occurrence_updates"."driver_behavior_occurrence_update_id" in (8, 9, 10, 13, 14, 15)  
[2024-08-28 10:52:59] local.INFO: select count(*) as aggregate from "driver_behavior_occurrence_update" where "driver_behavior_occurrence_update"."driver_id" = 463 and "driver_behavior_occurrence_update"."driver_id" is not null  
[2024-08-28 10:52:59] local.INFO: select sum("days") as aggregate from "driver_vehicle_px_experiences" where "driver_vehicle_px_experiences"."driver_id" is null and "driver_vehicle_px_experiences"."driver_id" is not null  
[2024-08-28 10:52:59] local.INFO: select sum("days") as aggregate from "driver_supply_px_experiences" where "driver_supply_px_experiences"."driver_id" is null and "driver_supply_px_experiences"."driver_id" is not null and exists (select * from "supplies" where "driver_supply_px_experiences"."supply_id" = "supplies"."id" and "name" != Nenhum)  
[2024-08-28 10:52:59] local.INFO: select exists(select * from "lead_campaign_results" where "lead_campaign_results"."driver_id" is null and "lead_campaign_results"."driver_id" is not null and "status" = campaign_canceled) as "exists"  
[2024-08-28 10:52:59] local.INFO: select * from "users" where "users"."id" = 1 limit 1  
[2024-08-28 10:52:59] local.INFO: select sum("days") as aggregate from "driver_vehicle_px_experiences" where "driver_vehicle_px_experiences"."driver_id" is null and "driver_vehicle_px_experiences"."driver_id" is not null  
[2024-08-28 10:52:59] local.INFO: select sum("days") as aggregate from "driver_supply_px_experiences" where "driver_supply_px_experiences"."driver_id" is null and "driver_supply_px_experiences"."driver_id" is not null and exists (select * from "supplies" where "driver_supply_px_experiences"."supply_id" = "supplies"."id" and "name" != Nenhum)  
[2024-08-28 10:52:59] local.INFO: select exists(select * from "lead_campaign_results" where "lead_campaign_results"."driver_id" is null and "lead_campaign_results"."driver_id" is not null and "status" = campaign_canceled) as "exists"  
[2024-08-28 10:52:59] local.INFO: select * from "users" where "users"."id" = 1 limit 1  
[2024-08-28 10:52:59] local.INFO: select sum("days") as aggregate from "driver_vehicle_px_experiences" where "driver_vehicle_px_experiences"."driver_id" is null and "driver_vehicle_px_experiences"."driver_id" is not null  
[2024-08-28 10:52:59] local.INFO: select sum("days") as aggregate from "driver_supply_px_experiences" where "driver_supply_px_experiences"."driver_id" is null and "driver_supply_px_experiences"."driver_id" is not null and exists (select * from "supplies" where "driver_supply_px_experiences"."supply_id" = "supplies"."id" and "name" != Nenhum)  
[2024-08-28 10:52:59] local.INFO: select exists(select * from "lead_campaign_results" where "lead_campaign_results"."driver_id" is null and "lead_campaign_results"."driver_id" is not null and "status" = campaign_canceled) as "exists"  
[2024-08-28 10:52:59] local.INFO: select * from "users" where "users"."id" = 1 limit 1  
[2024-08-28 10:52:59] local.INFO: select sum("days") as aggregate from "driver_vehicle_px_experiences" where "driver_vehicle_px_experiences"."driver_id" is null and "driver_vehicle_px_experiences"."driver_id" is not null  
[2024-08-28 10:52:59] local.INFO: select sum("days") as aggregate from "driver_supply_px_experiences" where "driver_supply_px_experiences"."driver_id" is null and "driver_supply_px_experiences"."driver_id" is not null and exists (select * from "supplies" where "driver_supply_px_experiences"."supply_id" = "supplies"."id" and "name" != Nenhum)  
[2024-08-28 10:52:59] local.INFO: select exists(select * from "lead_campaign_results" where "lead_campaign_results"."driver_id" is null and "lead_campaign_results"."driver_id" is not null and "status" = campaign_canceled) as "exists"  
[2024-08-28 10:52:59] local.INFO: select * from "users" where "users"."id" = 1 limit 1  
[2024-08-28 10:52:59] local.INFO: select sum("days") as aggregate from "driver_vehicle_px_experiences" where "driver_vehicle_px_experiences"."driver_id" is null and "driver_vehicle_px_experiences"."driver_id" is not null  
[2024-08-28 10:52:59] local.INFO: select sum("days") as aggregate from "driver_supply_px_experiences" where "driver_supply_px_experiences"."driver_id" is null and "driver_supply_px_experiences"."driver_id" is not null and exists (select * from "supplies" where "driver_supply_px_experiences"."supply_id" = "supplies"."id" and "name" != Nenhum)  
[2024-08-28 10:52:59] local.INFO: select exists(select * from "lead_campaign_results" where "lead_campaign_results"."driver_id" is null and "lead_campaign_results"."driver_id" is not null and "status" = campaign_canceled) as "exists"  
[2024-08-28 10:52:59] local.INFO: select * from "users" where "users"."id" = 1 limit 1  
[2024-08-28 10:53:00] local.INFO: select * from "users" where "id" = 1 limit 1  
[2024-08-28 10:53:00] local.INFO: select * from "users" where "id" = 1  
[2024-08-28 10:53:00] local.INFO: select * from "role_user" where "role_user"."user_id" in (1)  
[2024-08-28 10:53:00] local.INFO: select * from "nova_notifications" where "notifiable_id" = 1 and "nova_notifications"."deleted_at" is null order by "created_at" desc limit 100  
[2024-08-28 10:53:00] local.INFO: select count(*) as aggregate from "nova_notifications" where "read_at" is null and "notifiable_id" = 1 and "nova_notifications"."deleted_at" is null  
[2024-08-28 10:53:01] local.INFO: select * from "users" where "id" = 1 limit 1  
[2024-08-28 10:53:01] local.INFO: select * from "users" where "id" = 1  
[2024-08-28 10:53:01] local.INFO: select * from "role_user" where "role_user"."user_id" in (1)  
[2024-08-28 10:53:01] local.INFO: select * from "users" where "id" = 1 limit 1  
[2024-08-28 10:53:01] local.INFO: select * from "driver_behavior_occurrence" where "driver_behavior_occurrence"."id" is null limit 1  
[2024-08-28 10:53:01] local.INFO: select * from "users" where "id" = 1  
[2024-08-28 10:53:01] local.INFO: select * from "role_user" where "role_user"."user_id" in (1)  
[2024-08-28 10:53:01] local.INFO: select * from "users" where "id" = 1 limit 1  
[2024-08-28 10:53:01] local.INFO: select "roles".*, "role_user"."user_id" as "pivot_user_id", "role_user"."role_id" as "pivot_role_id" from "roles" inner join "role_user" on "roles"."id" = "role_user"."role_id" where "role_user"."user_id" = 1  
[2024-08-28 10:53:01] local.INFO: select * from "role_permission" where "role_permission"."role_id" in (3, 7)  
[2024-08-28 10:53:01] local.INFO: select * from "users" where "id" = 1  
[2024-08-28 10:53:01] local.INFO: select sum("days") as aggregate from "driver_vehicle_px_experiences" where "driver_vehicle_px_experiences"."driver_id" is null and "driver_vehicle_px_experiences"."driver_id" is not null  
[2024-08-28 10:53:01] local.INFO: select * from "role_user" where "role_user"."user_id" in (1)  
[2024-08-28 10:53:01] local.INFO: select sum("days") as aggregate from "driver_supply_px_experiences" where "driver_supply_px_experiences"."driver_id" is null and "driver_supply_px_experiences"."driver_id" is not null and exists (select * from "supplies" where "driver_supply_px_experiences"."supply_id" = "supplies"."id" and "name" != Nenhum)  
[2024-08-28 10:53:01] local.INFO: select exists(select * from "lead_campaign_results" where "lead_campaign_results"."driver_id" is null and "lead_campaign_results"."driver_id" is not null and "status" = campaign_canceled) as "exists"  
[2024-08-28 10:53:01] local.INFO: select * from "drivers" where "drivers"."id" = 463 limit 1  
[2024-08-28 10:53:01] local.INFO: select "roles".*, "role_user"."user_id" as "pivot_user_id", "role_user"."role_id" as "pivot_role_id" from "roles" inner join "role_user" on "roles"."id" = "role_user"."role_id" where "role_user"."user_id" = 1  
[2024-08-28 10:53:01] local.INFO: select * from "drivers" where "drivers"."id" = 463 limit 1  
[2024-08-28 10:53:01] local.INFO: select * from "role_permission" where "role_permission"."role_id" in (3, 7)  
[2024-08-28 10:53:01] local.INFO: select sum("days") as aggregate from "driver_vehicle_px_experiences" where "driver_vehicle_px_experiences"."driver_id" is null and "driver_vehicle_px_experiences"."driver_id" is not null  
[2024-08-28 10:53:01] local.INFO: select sum("days") as aggregate from "driver_supply_px_experiences" where "driver_supply_px_experiences"."driver_id" is null and "driver_supply_px_experiences"."driver_id" is not null and exists (select * from "supplies" where "driver_supply_px_experiences"."supply_id" = "supplies"."id" and "name" != Nenhum)  
[2024-08-28 10:53:01] local.INFO: select exists(select * from "lead_campaign_results" where "lead_campaign_results"."driver_id" is null and "lead_campaign_results"."driver_id" is not null and "status" = campaign_canceled) as "exists"  
[2024-08-28 10:53:01] local.INFO: select * from "driver_behavior_occurrence" where "driver_behavior_occurrence"."driver_id" = 463 and "driver_behavior_occurrence"."driver_id" is not null order by "driver_behavior_occurrence"."id" desc limit 6 offset 0  
[2024-08-28 10:53:01] local.INFO: select count(*) as aggregate from "driver_behavior_occurrence" where "driver_behavior_occurrence"."driver_id" = 463 and "driver_behavior_occurrence"."driver_id" is not null  
[2024-08-28 10:53:01] local.INFO: select * from "attachments" where "origin_id" = 18 and "origin_type" = App\Models\DriverBehaviorOccurrence  
[2024-08-28 10:53:01] local.INFO: select sum("days") as aggregate from "driver_vehicle_px_experiences" where "driver_vehicle_px_experiences"."driver_id" is null and "driver_vehicle_px_experiences"."driver_id" is not null  
[2024-08-28 10:53:01] local.INFO: select sum("days") as aggregate from "driver_supply_px_experiences" where "driver_supply_px_experiences"."driver_id" is null and "driver_supply_px_experiences"."driver_id" is not null and exists (select * from "supplies" where "driver_supply_px_experiences"."supply_id" = "supplies"."id" and "name" != Nenhum)  
[2024-08-28 10:53:01] local.INFO: select exists(select * from "lead_campaign_results" where "lead_campaign_results"."driver_id" is null and "lead_campaign_results"."driver_id" is not null and "status" = campaign_canceled) as "exists"  
[2024-08-28 10:53:01] local.INFO: select "driver_behavior_occurrence_type".*, "driver_behavior_occurrence_types"."driver_behavior_occurrence_id" as "pivot_driver_behavior_occurrence_id", "driver_behavior_occurrence_types"."driver_behavior_occurrence_type_id" as "pivot_driver_behavior_occurrence_type_id" from "driver_behavior_occurrence_type" inner join "driver_behavior_occurrence_types" on "driver_behavior_occurrence_type"."id" = "driver_behavior_occurrence_types"."driver_behavior_occurrence_type_id" where "driver_behavior_occurrence_types"."driver_behavior_occurrence_id" = 18  
[2024-08-28 10:53:01] local.INFO: select count(*) as aggregate from "driver_behavior_occurrence" where "driver_id" = 463 and "contract_id" = 3787  
[2024-08-28 10:53:01] local.INFO: select * from "freights" where "freights"."id" = 3787 limit 1  
[2024-08-28 10:53:01] local.INFO: select "companies".* from "freights" inner join "companies" on "freights"."company_id" = "companies"."id" where "freights"."id" = 3787 limit 1  
[2024-08-28 10:53:01] local.INFO: select * from "users" where "users"."id" = 2 limit 1  
[2024-08-28 10:53:01] local.INFO: select * from "attachments" where "origin_id" = 18 and "origin_type" = App\Models\DriverBehaviorOccurrence  
[2024-08-28 10:53:01] local.INFO: select * from "attachments" where "origin_id" = 17 and "origin_type" = App\Models\DriverBehaviorOccurrence  
[2024-08-28 10:53:01] local.INFO: select sum("days") as aggregate from "driver_vehicle_px_experiences" where "driver_vehicle_px_experiences"."driver_id" is null and "driver_vehicle_px_experiences"."driver_id" is not null  
[2024-08-28 10:53:01] local.INFO: select sum("days") as aggregate from "driver_supply_px_experiences" where "driver_supply_px_experiences"."driver_id" is null and "driver_supply_px_experiences"."driver_id" is not null and exists (select * from "supplies" where "driver_supply_px_experiences"."supply_id" = "supplies"."id" and "name" != Nenhum)  
[2024-08-28 10:53:01] local.INFO: select exists(select * from "lead_campaign_results" where "lead_campaign_results"."driver_id" is null and "lead_campaign_results"."driver_id" is not null and "status" = campaign_canceled) as "exists"  
[2024-08-28 10:53:01] local.INFO: select "driver_behavior_occurrence_type".*, "driver_behavior_occurrence_types"."driver_behavior_occurrence_id" as "pivot_driver_behavior_occurrence_id", "driver_behavior_occurrence_types"."driver_behavior_occurrence_type_id" as "pivot_driver_behavior_occurrence_type_id" from "driver_behavior_occurrence_type" inner join "driver_behavior_occurrence_types" on "driver_behavior_occurrence_type"."id" = "driver_behavior_occurrence_types"."driver_behavior_occurrence_type_id" where "driver_behavior_occurrence_types"."driver_behavior_occurrence_id" = 17  
[2024-08-28 10:53:01] local.INFO: select * from "users" where "users"."id" = 2 limit 1  
[2024-08-28 10:53:01] local.INFO: select * from "attachments" where "origin_id" = 17 and "origin_type" = App\Models\DriverBehaviorOccurrence  
[2024-08-28 10:53:01] local.INFO: select * from "attachments" where "origin_id" = 16 and "origin_type" = App\Models\DriverBehaviorOccurrence  
[2024-08-28 10:53:01] local.INFO: select sum("days") as aggregate from "driver_vehicle_px_experiences" where "driver_vehicle_px_experiences"."driver_id" is null and "driver_vehicle_px_experiences"."driver_id" is not null  
[2024-08-28 10:53:01] local.INFO: select sum("days") as aggregate from "driver_supply_px_experiences" where "driver_supply_px_experiences"."driver_id" is null and "driver_supply_px_experiences"."driver_id" is not null and exists (select * from "supplies" where "driver_supply_px_experiences"."supply_id" = "supplies"."id" and "name" != Nenhum)  
[2024-08-28 10:53:01] local.INFO: select exists(select * from "lead_campaign_results" where "lead_campaign_results"."driver_id" is null and "lead_campaign_results"."driver_id" is not null and "status" = campaign_canceled) as "exists"  
[2024-08-28 10:53:01] local.INFO: select "driver_behavior_occurrence_type".*, "driver_behavior_occurrence_types"."driver_behavior_occurrence_id" as "pivot_driver_behavior_occurrence_id", "driver_behavior_occurrence_types"."driver_behavior_occurrence_type_id" as "pivot_driver_behavior_occurrence_type_id" from "driver_behavior_occurrence_type" inner join "driver_behavior_occurrence_types" on "driver_behavior_occurrence_type"."id" = "driver_behavior_occurrence_types"."driver_behavior_occurrence_type_id" where "driver_behavior_occurrence_types"."driver_behavior_occurrence_id" = 16  
[2024-08-28 10:53:01] local.INFO: select * from "users" where "users"."id" = 2 limit 1  
[2024-08-28 10:53:01] local.INFO: select * from "attachments" where "origin_id" = 16 and "origin_type" = App\Models\DriverBehaviorOccurrence  
[2024-08-28 10:53:01] local.INFO: select * from "users" where "id" = 1 limit 1  
[2024-08-28 10:53:01] local.INFO: select * from "attachments" where "origin_id" = 15 and "origin_type" = App\Models\DriverBehaviorOccurrence  
[2024-08-28 10:53:01] local.INFO: select sum("days") as aggregate from "driver_vehicle_px_experiences" where "driver_vehicle_px_experiences"."driver_id" is null and "driver_vehicle_px_experiences"."driver_id" is not null  
[2024-08-28 10:53:01] local.INFO: select sum("days") as aggregate from "driver_supply_px_experiences" where "driver_supply_px_experiences"."driver_id" is null and "driver_supply_px_experiences"."driver_id" is not null and exists (select * from "supplies" where "driver_supply_px_experiences"."supply_id" = "supplies"."id" and "name" != Nenhum)  
[2024-08-28 10:53:01] local.INFO: select exists(select * from "lead_campaign_results" where "lead_campaign_results"."driver_id" is null and "lead_campaign_results"."driver_id" is not null and "status" = campaign_canceled) as "exists"  
[2024-08-28 10:53:01] local.INFO: select "driver_behavior_occurrence_type".*, "driver_behavior_occurrence_types"."driver_behavior_occurrence_id" as "pivot_driver_behavior_occurrence_id", "driver_behavior_occurrence_types"."driver_behavior_occurrence_type_id" as "pivot_driver_behavior_occurrence_type_id" from "driver_behavior_occurrence_type" inner join "driver_behavior_occurrence_types" on "driver_behavior_occurrence_type"."id" = "driver_behavior_occurrence_types"."driver_behavior_occurrence_type_id" where "driver_behavior_occurrence_types"."driver_behavior_occurrence_id" = 15  
[2024-08-28 10:53:01] local.INFO: select count(*) as aggregate from "driver_behavior_occurrence" where "driver_id" = 463 and "contract_id" = 2900  
[2024-08-28 10:53:01] local.INFO: select * from "freights" where "freights"."id" = 2900 limit 1  
[2024-08-28 10:53:01] local.INFO: select "companies".* from "freights" inner join "companies" on "freights"."company_id" = "companies"."id" where "freights"."id" = 2900 limit 1  
[2024-08-28 10:53:01] local.INFO: select * from "users" where "users"."id" = 1 limit 1  
[2024-08-28 10:53:01] local.INFO: select * from "users" where "id" = 1  
[2024-08-28 10:53:01] local.INFO: select * from "role_user" where "role_user"."user_id" in (1)  
[2024-08-28 10:53:01] local.INFO: select * from "attachments" where "origin_id" = 15 and "origin_type" = App\Models\DriverBehaviorOccurrence  
[2024-08-28 10:53:01] local.INFO: select * from "attachments" where "origin_id" = 14 and "origin_type" = App\Models\DriverBehaviorOccurrence  
[2024-08-28 10:53:01] local.INFO: select * from "driver_behavior_occurrence" where "driver_behavior_occurrence"."id" is null limit 1  
[2024-08-28 10:53:01] local.INFO: select sum("days") as aggregate from "driver_vehicle_px_experiences" where "driver_vehicle_px_experiences"."driver_id" is null and "driver_vehicle_px_experiences"."driver_id" is not null  
[2024-08-28 10:53:01] local.INFO: select sum("days") as aggregate from "driver_vehicle_px_experiences" where "driver_vehicle_px_experiences"."driver_id" is null and "driver_vehicle_px_experiences"."driver_id" is not null  
[2024-08-28 10:53:01] local.INFO: select sum("days") as aggregate from "driver_supply_px_experiences" where "driver_supply_px_experiences"."driver_id" is null and "driver_supply_px_experiences"."driver_id" is not null and exists (select * from "supplies" where "driver_supply_px_experiences"."supply_id" = "supplies"."id" and "name" != Nenhum)  
[2024-08-28 10:53:01] local.INFO: select exists(select * from "lead_campaign_results" where "lead_campaign_results"."driver_id" is null and "lead_campaign_results"."driver_id" is not null and "status" = campaign_canceled) as "exists"  
[2024-08-28 10:53:01] local.INFO: select sum("days") as aggregate from "driver_supply_px_experiences" where "driver_supply_px_experiences"."driver_id" is null and "driver_supply_px_experiences"."driver_id" is not null and exists (select * from "supplies" where "driver_supply_px_experiences"."supply_id" = "supplies"."id" and "name" != Nenhum)  
[2024-08-28 10:53:01] local.INFO: select exists(select * from "lead_campaign_results" where "lead_campaign_results"."driver_id" is null and "lead_campaign_results"."driver_id" is not null and "status" = campaign_canceled) as "exists"  
[2024-08-28 10:53:01] local.INFO: select "driver_behavior_occurrence_type".*, "driver_behavior_occurrence_types"."driver_behavior_occurrence_id" as "pivot_driver_behavior_occurrence_id", "driver_behavior_occurrence_types"."driver_behavior_occurrence_type_id" as "pivot_driver_behavior_occurrence_type_id" from "driver_behavior_occurrence_type" inner join "driver_behavior_occurrence_types" on "driver_behavior_occurrence_type"."id" = "driver_behavior_occurrence_types"."driver_behavior_occurrence_type_id" where "driver_behavior_occurrence_types"."driver_behavior_occurrence_id" = 14  
[2024-08-28 10:53:01] local.INFO: select count(*) as aggregate from "driver_behavior_occurrence" where "driver_id" = 463 and "contract_id" = 2900  
[2024-08-28 10:53:01] local.INFO: select * from "freights" where "freights"."id" = 2900 limit 1  
[2024-08-28 10:53:01] local.INFO: select sum("days") as aggregate from "driver_vehicle_px_experiences" where "driver_vehicle_px_experiences"."driver_id" is null and "driver_vehicle_px_experiences"."driver_id" is not null  
[2024-08-28 10:53:01] local.INFO: select sum("days") as aggregate from "driver_supply_px_experiences" where "driver_supply_px_experiences"."driver_id" is null and "driver_supply_px_experiences"."driver_id" is not null and exists (select * from "supplies" where "driver_supply_px_experiences"."supply_id" = "supplies"."id" and "name" != Nenhum)  
[2024-08-28 10:53:01] local.INFO: select exists(select * from "lead_campaign_results" where "lead_campaign_results"."driver_id" is null and "lead_campaign_results"."driver_id" is not null and "status" = campaign_canceled) as "exists"  
[2024-08-28 10:53:01] local.INFO: select "companies".* from "freights" inner join "companies" on "freights"."company_id" = "companies"."id" where "freights"."id" = 2900 limit 1  
[2024-08-28 10:53:01] local.INFO: select * from "users" where "users"."id" = 1 limit 1  
[2024-08-28 10:53:01] local.INFO: select * from "attachments" where "origin_id" = 14 and "origin_type" = App\Models\DriverBehaviorOccurrence  
[2024-08-28 10:53:03] local.INFO: select * from "users" where "id" = 1 limit 1  
[2024-08-28 10:53:03] local.INFO: select * from "users" where "id" = 1  
[2024-08-28 10:53:03] local.INFO: select * from "role_user" where "role_user"."user_id" in (1)  
[2024-08-28 10:53:03] local.INFO: select * from "driver_company_integrations" where "driver_company_integrations"."id" is null limit 1  
[2024-08-28 10:53:03] local.INFO: select sum("days") as aggregate from "driver_vehicle_px_experiences" where "driver_vehicle_px_experiences"."driver_id" is null and "driver_vehicle_px_experiences"."driver_id" is not null  
[2024-08-28 10:53:03] local.INFO: select sum("days") as aggregate from "driver_supply_px_experiences" where "driver_supply_px_experiences"."driver_id" is null and "driver_supply_px_experiences"."driver_id" is not null and exists (select * from "supplies" where "driver_supply_px_experiences"."supply_id" = "supplies"."id" and "name" != Nenhum)  
[2024-08-28 10:53:03] local.INFO: select exists(select * from "lead_campaign_results" where "lead_campaign_results"."driver_id" is null and "lead_campaign_results"."driver_id" is not null and "status" = campaign_canceled) as "exists"  
[2024-08-28 10:53:03] local.INFO: select * from "users" where "id" = 1 limit 1  
[2024-08-28 10:53:03] local.INFO: select sum("days") as aggregate from "driver_vehicle_px_experiences" where "driver_vehicle_px_experiences"."driver_id" is null and "driver_vehicle_px_experiences"."driver_id" is not null  
[2024-08-28 10:53:03] local.INFO: select * from "users" where "id" = 1 limit 1  
[2024-08-28 10:53:03] local.INFO: select sum("days") as aggregate from "driver_supply_px_experiences" where "driver_supply_px_experiences"."driver_id" is null and "driver_supply_px_experiences"."driver_id" is not null and exists (select * from "supplies" where "driver_supply_px_experiences"."supply_id" = "supplies"."id" and "name" != Nenhum)  
[2024-08-28 10:53:03] local.INFO: select exists(select * from "lead_campaign_results" where "lead_campaign_results"."driver_id" is null and "lead_campaign_results"."driver_id" is not null and "status" = campaign_canceled) as "exists"  
[2024-08-28 10:53:03] local.INFO: select * from "users" where "id" = 1  
[2024-08-28 10:53:03] local.INFO: select * from "users" where "id" = 1  
[2024-08-28 10:53:03] local.INFO: select * from "role_user" where "role_user"."user_id" in (1)  
[2024-08-28 10:53:03] local.INFO: select * from "role_user" where "role_user"."user_id" in (1)  
[2024-08-28 10:53:03] local.INFO: select * from "driver_company_integrations" where "driver_company_integrations"."id" is null limit 1  
[2024-08-28 10:53:03] local.INFO: select sum("days") as aggregate from "driver_vehicle_px_experiences" where "driver_vehicle_px_experiences"."driver_id" is null and "driver_vehicle_px_experiences"."driver_id" is not null  
[2024-08-28 10:53:03] local.INFO: select sum("days") as aggregate from "driver_supply_px_experiences" where "driver_supply_px_experiences"."driver_id" is null and "driver_supply_px_experiences"."driver_id" is not null and exists (select * from "supplies" where "driver_supply_px_experiences"."supply_id" = "supplies"."id" and "name" != Nenhum)  
[2024-08-28 10:53:03] local.INFO: select exists(select * from "lead_campaign_results" where "lead_campaign_results"."driver_id" is null and "lead_campaign_results"."driver_id" is not null and "status" = campaign_canceled) as "exists"  
[2024-08-28 10:53:03] local.INFO: select * from "drivers" where "drivers"."id" = 463 limit 1  
[2024-08-28 10:53:03] local.INFO: select sum("days") as aggregate from "driver_vehicle_px_experiences" where "driver_vehicle_px_experiences"."driver_id" is null and "driver_vehicle_px_experiences"."driver_id" is not null  
[2024-08-28 10:53:03] local.INFO: select sum("days") as aggregate from "driver_supply_px_experiences" where "driver_supply_px_experiences"."driver_id" is null and "driver_supply_px_experiences"."driver_id" is not null and exists (select * from "supplies" where "driver_supply_px_experiences"."supply_id" = "supplies"."id" and "name" != Nenhum)  
[2024-08-28 10:53:03] local.INFO: select exists(select * from "lead_campaign_results" where "lead_campaign_results"."driver_id" is null and "lead_campaign_results"."driver_id" is not null and "status" = campaign_canceled) as "exists"  
[2024-08-28 10:53:03] local.INFO: select * from "driver_company_integrations" where "driver_company_integrations"."driver_id" = 463 and "driver_company_integrations"."driver_id" is not null order by "driver_company_integrations"."id" desc limit 6 offset 0  
[2024-08-28 10:53:03] local.INFO: select count(*) as aggregate from "driver_company_integrations" where "driver_company_integrations"."driver_id" = 463 and "driver_company_integrations"."driver_id" is not null  
[2024-08-28 10:53:03] local.INFO: select sum("days") as aggregate from "driver_vehicle_px_experiences" where "driver_vehicle_px_experiences"."driver_id" is null and "driver_vehicle_px_experiences"."driver_id" is not null  
[2024-08-28 10:53:03] local.INFO: select sum("days") as aggregate from "driver_supply_px_experiences" where "driver_supply_px_experiences"."driver_id" is null and "driver_supply_px_experiences"."driver_id" is not null and exists (select * from "supplies" where "driver_supply_px_experiences"."supply_id" = "supplies"."id" and "name" != Nenhum)  
[2024-08-28 10:53:03] local.INFO: select exists(select * from "lead_campaign_results" where "lead_campaign_results"."driver_id" is null and "lead_campaign_results"."driver_id" is not null and "status" = campaign_canceled) as "exists"  
[2024-08-28 10:53:03] local.INFO: select * from "company_integrations" where "company_integrations"."id" = 87 limit 1  
[2024-08-28 10:53:03] local.INFO: select "companies".* from "companies" inner join "company_integrations" on "company_integrations"."company_id" = "companies"."id" where "company_integrations"."id" = 87 limit 1  
[2024-08-28 10:53:03] local.INFO: select "roles".*, "role_user"."user_id" as "pivot_user_id", "role_user"."role_id" as "pivot_role_id" from "roles" inner join "role_user" on "roles"."id" = "role_user"."role_id" where "role_user"."user_id" = 1  
[2024-08-28 10:53:03] local.INFO: select * from "role_permission" where "role_permission"."role_id" in (3, 7)  
[2024-08-28 10:53:03] local.INFO: select * from "drivers" where "drivers"."id" = 463 limit 1  
[2024-08-28 10:53:03] local.INFO: select sum("days") as aggregate from "driver_vehicle_px_experiences" where "driver_vehicle_px_experiences"."driver_id" is null and "driver_vehicle_px_experiences"."driver_id" is not null  
[2024-08-28 10:53:03] local.INFO: select sum("days") as aggregate from "driver_supply_px_experiences" where "driver_supply_px_experiences"."driver_id" is null and "driver_supply_px_experiences"."driver_id" is not null and exists (select * from "supplies" where "driver_supply_px_experiences"."supply_id" = "supplies"."id" and "name" != Nenhum)  
[2024-08-28 10:53:03] local.INFO: select exists(select * from "lead_campaign_results" where "lead_campaign_results"."driver_id" is null and "lead_campaign_results"."driver_id" is not null and "status" = campaign_canceled) as "exists"  
[2024-08-28 10:53:03] local.INFO: select * from "company_integrations" where "company_integrations"."id" = 36 limit 1  
[2024-08-28 10:53:03] local.INFO: select "companies".* from "companies" inner join "company_integrations" on "company_integrations"."company_id" = "companies"."id" where "company_integrations"."id" = 36 limit 1  
[2024-08-28 10:53:03] local.INFO: select * from "drivers" where "drivers"."id" = 463 limit 1  
[2024-08-28 10:53:03] local.INFO: select sum("days") as aggregate from "driver_vehicle_px_experiences" where "driver_vehicle_px_experiences"."driver_id" is null and "driver_vehicle_px_experiences"."driver_id" is not null  
[2024-08-28 10:53:03] local.INFO: select sum("days") as aggregate from "driver_supply_px_experiences" where "driver_supply_px_experiences"."driver_id" is null and "driver_supply_px_experiences"."driver_id" is not null and exists (select * from "supplies" where "driver_supply_px_experiences"."supply_id" = "supplies"."id" and "name" != Nenhum)  
[2024-08-28 10:53:03] local.INFO: select exists(select * from "lead_campaign_results" where "lead_campaign_results"."driver_id" is null and "lead_campaign_results"."driver_id" is not null and "status" = campaign_canceled) as "exists"  
[2024-08-28 10:53:03] local.INFO: select * from "company_integrations" where "company_integrations"."id" = 45 limit 1  
[2024-08-28 10:53:03] local.INFO: select "companies".* from "companies" inner join "company_integrations" on "company_integrations"."company_id" = "companies"."id" where "company_integrations"."id" = 45 limit 1  
[2024-08-28 10:53:03] local.INFO: select * from "drivers" where "drivers"."id" = 463 limit 1  
[2024-08-28 10:53:03] local.INFO: select sum("days") as aggregate from "driver_vehicle_px_experiences" where "driver_vehicle_px_experiences"."driver_id" is null and "driver_vehicle_px_experiences"."driver_id" is not null  
[2024-08-28 10:53:03] local.INFO: select sum("days") as aggregate from "driver_supply_px_experiences" where "driver_supply_px_experiences"."driver_id" is null and "driver_supply_px_experiences"."driver_id" is not null and exists (select * from "supplies" where "driver_supply_px_experiences"."supply_id" = "supplies"."id" and "name" != Nenhum)  
[2024-08-28 10:53:03] local.INFO: select exists(select * from "lead_campaign_results" where "lead_campaign_results"."driver_id" is null and "lead_campaign_results"."driver_id" is not null and "status" = campaign_canceled) as "exists"  
[2024-08-28 10:53:03] local.INFO: select * from "company_integrations" where "company_integrations"."id" = 37 limit 1  
[2024-08-28 10:53:03] local.INFO: select "companies".* from "companies" inner join "company_integrations" on "company_integrations"."company_id" = "companies"."id" where "company_integrations"."id" = 37 limit 1  
[2024-08-28 10:53:03] local.INFO: select * from "drivers" where "drivers"."id" = 463 limit 1  
[2024-08-28 10:53:03] local.INFO: select sum("days") as aggregate from "driver_vehicle_px_experiences" where "driver_vehicle_px_experiences"."driver_id" is null and "driver_vehicle_px_experiences"."driver_id" is not null  
[2024-08-28 10:53:03] local.INFO: select sum("days") as aggregate from "driver_supply_px_experiences" where "driver_supply_px_experiences"."driver_id" is null and "driver_supply_px_experiences"."driver_id" is not null and exists (select * from "supplies" where "driver_supply_px_experiences"."supply_id" = "supplies"."id" and "name" != Nenhum)  
[2024-08-28 10:53:03] local.INFO: select exists(select * from "lead_campaign_results" where "lead_campaign_results"."driver_id" is null and "lead_campaign_results"."driver_id" is not null and "status" = campaign_canceled) as "exists"  
[2024-08-28 10:53:03] local.INFO: select * from "company_integrations" where "company_integrations"."id" = 35 limit 1  
[2024-08-28 10:53:03] local.INFO: select "companies".* from "companies" inner join "company_integrations" on "company_integrations"."company_id" = "companies"."id" where "company_integrations"."id" = 35 limit 1  
[2024-08-28 10:53:03] local.INFO: select * from "drivers" where "drivers"."id" = 463 limit 1  
[2024-08-28 10:53:05] local.INFO: select * from "users" where "id" = 1 limit 1  
[2024-08-28 10:53:05] local.INFO: select * from "users" where "id" = 1 limit 1  
[2024-08-28 10:53:05] local.INFO: select * from "users" where "id" = 1  
[2024-08-28 10:53:05] local.INFO: select * from "role_user" where "role_user"."user_id" in (1)  
[2024-08-28 10:53:05] local.INFO: select * from "users" where "id" = 1  
[2024-08-28 10:53:05] local.INFO: select * from "role_user" where "role_user"."user_id" in (1)  
[2024-08-28 10:53:05] local.INFO: select "roles".*, "role_user"."user_id" as "pivot_user_id", "role_user"."role_id" as "pivot_role_id" from "roles" inner join "role_user" on "roles"."id" = "role_user"."role_id" where "role_user"."user_id" = 1  
[2024-08-28 10:53:05] local.INFO: select * from "role_permission" where "role_permission"."role_id" in (3, 7)  
[2024-08-28 10:53:05] local.INFO: select * from "drivers" where "drivers"."id" = 463 limit 1  
[2024-08-28 10:53:05] local.INFO: select * from "users" where "id" = 1 limit 1  
[2024-08-28 10:53:05] local.INFO: select "roles".*, "role_user"."user_id" as "pivot_user_id", "role_user"."role_id" as "pivot_role_id" from "roles" inner join "role_user" on "roles"."id" = "role_user"."role_id" where "role_user"."user_id" = 1  
[2024-08-28 10:53:05] local.INFO: select sum("days") as aggregate from "driver_vehicle_px_experiences" where "driver_vehicle_px_experiences"."driver_id" is null and "driver_vehicle_px_experiences"."driver_id" is not null  
[2024-08-28 10:53:05] local.INFO: select * from "role_permission" where "role_permission"."role_id" in (3, 7)  
[2024-08-28 10:53:05] local.INFO: select sum("days") as aggregate from "driver_supply_px_experiences" where "driver_supply_px_experiences"."driver_id" is null and "driver_supply_px_experiences"."driver_id" is not null and exists (select * from "supplies" where "driver_supply_px_experiences"."supply_id" = "supplies"."id" and "name" != Nenhum)  
[2024-08-28 10:53:05] local.INFO: select * from "users" where "id" = 1  
[2024-08-28 10:53:05] local.INFO: select exists(select * from "lead_campaign_results" where "lead_campaign_results"."driver_id" is null and "lead_campaign_results"."driver_id" is not null and "status" = campaign_canceled) as "exists"  
[2024-08-28 10:53:05] local.INFO: select * from "role_user" where "role_user"."user_id" in (1)  
[2024-08-28 10:53:05] local.INFO: select * from "driver_courses" where "driver_courses"."id" is null limit 1  
[2024-08-28 10:53:05] local.INFO: select * from "drivers" where "drivers"."id" = 463 limit 1  
[2024-08-28 10:53:05] local.INFO: select "id", "type" from "courses" where "type" = toxicological limit 1  
[2024-08-28 10:53:05] local.INFO: select "type" from "courses" where "id" is null limit 1  
[2024-08-28 10:53:05] local.INFO: select sum("days") as aggregate from "driver_vehicle_px_experiences" where "driver_vehicle_px_experiences"."driver_id" is null and "driver_vehicle_px_experiences"."driver_id" is not null  
[2024-08-28 10:53:05] local.INFO: select sum("days") as aggregate from "driver_supply_px_experiences" where "driver_supply_px_experiences"."driver_id" is null and "driver_supply_px_experiences"."driver_id" is not null and exists (select * from "supplies" where "driver_supply_px_experiences"."supply_id" = "supplies"."id" and "name" != Nenhum)  
[2024-08-28 10:53:05] local.INFO: select exists(select * from "lead_campaign_results" where "lead_campaign_results"."driver_id" is null and "lead_campaign_results"."driver_id" is not null and "status" = campaign_canceled) as "exists"  
[2024-08-28 10:53:05] local.INFO: select * from "driver_courses" where "driver_courses"."driver_id" = 463 and "driver_courses"."driver_id" is not null order by "driver_courses"."id" desc limit 6 offset 0  
[2024-08-28 10:53:05] local.INFO: select count(*) as aggregate from "driver_courses" where "driver_courses"."driver_id" = 463 and "driver_courses"."driver_id" is not null  
[2024-08-28 10:53:05] local.INFO: select "id", "type" from "courses" where "type" = toxicological limit 1  
[2024-08-28 10:53:05] local.INFO: select "type" from "courses" where "id" = 9 limit 1  
[2024-08-28 10:53:05] local.INFO: select sum("days") as aggregate from "driver_vehicle_px_experiences" where "driver_vehicle_px_experiences"."driver_id" is null and "driver_vehicle_px_experiences"."driver_id" is not null  
[2024-08-28 10:53:05] local.INFO: select sum("days") as aggregate from "driver_supply_px_experiences" where "driver_supply_px_experiences"."driver_id" is null and "driver_supply_px_experiences"."driver_id" is not null and exists (select * from "supplies" where "driver_supply_px_experiences"."supply_id" = "supplies"."id" and "name" != Nenhum)  
[2024-08-28 10:53:05] local.INFO: select exists(select * from "lead_campaign_results" where "lead_campaign_results"."driver_id" is null and "lead_campaign_results"."driver_id" is not null and "status" = campaign_canceled) as "exists"  
[2024-08-28 10:53:05] local.INFO: select * from "courses" where "courses"."id" = 9 limit 1  
[2024-08-28 10:53:05] local.INFO: select "id", "type" from "courses" where "type" = toxicological limit 1  
[2024-08-28 10:53:05] local.INFO: select "type" from "courses" where "id" = 9 limit 1  
[2024-08-28 10:53:05] local.INFO: select "id", "type" from "courses" where "type" = toxicological limit 1  
[2024-08-28 10:53:05] local.INFO: select "type" from "courses" where "id" = 5 limit 1  
[2024-08-28 10:53:05] local.INFO: select sum("days") as aggregate from "driver_vehicle_px_experiences" where "driver_vehicle_px_experiences"."driver_id" is null and "driver_vehicle_px_experiences"."driver_id" is not null  
[2024-08-28 10:53:05] local.INFO: select sum("days") as aggregate from "driver_supply_px_experiences" where "driver_supply_px_experiences"."driver_id" is null and "driver_supply_px_experiences"."driver_id" is not null and exists (select * from "supplies" where "driver_supply_px_experiences"."supply_id" = "supplies"."id" and "name" != Nenhum)  
[2024-08-28 10:53:05] local.INFO: select exists(select * from "lead_campaign_results" where "lead_campaign_results"."driver_id" is null and "lead_campaign_results"."driver_id" is not null and "status" = campaign_canceled) as "exists"  
[2024-08-28 10:53:05] local.INFO: select * from "courses" where "courses"."id" = 5 limit 1  
[2024-08-28 10:53:05] local.INFO: select * from "users" where "id" = 1 limit 1  
[2024-08-28 10:53:05] local.INFO: select "id", "type" from "courses" where "type" = toxicological limit 1  
[2024-08-28 10:53:05] local.INFO: select "type" from "courses" where "id" = 5 limit 1  
[2024-08-28 10:53:05] local.INFO: select "id", "type" from "courses" where "type" = toxicological limit 1  
[2024-08-28 10:53:05] local.INFO: select "type" from "courses" where "id" = 6 limit 1  
[2024-08-28 10:53:05] local.INFO: select sum("days") as aggregate from "driver_vehicle_px_experiences" where "driver_vehicle_px_experiences"."driver_id" is null and "driver_vehicle_px_experiences"."driver_id" is not null  
[2024-08-28 10:53:05] local.INFO: select sum("days") as aggregate from "driver_supply_px_experiences" where "driver_supply_px_experiences"."driver_id" is null and "driver_supply_px_experiences"."driver_id" is not null and exists (select * from "supplies" where "driver_supply_px_experiences"."supply_id" = "supplies"."id" and "name" != Nenhum)  
[2024-08-28 10:53:05] local.INFO: select exists(select * from "lead_campaign_results" where "lead_campaign_results"."driver_id" is null and "lead_campaign_results"."driver_id" is not null and "status" = campaign_canceled) as "exists"  
[2024-08-28 10:53:05] local.INFO: select * from "courses" where "courses"."id" = 6 limit 1  
[2024-08-28 10:53:05] local.INFO: select * from "users" where "id" = 1  
[2024-08-28 10:53:05] local.INFO: select * from "role_user" where "role_user"."user_id" in (1)  
[2024-08-28 10:53:05] local.INFO: select * from "driver_courses" where "driver_courses"."id" is null limit 1  
[2024-08-28 10:53:05] local.INFO: select sum("days") as aggregate from "driver_vehicle_px_experiences" where "driver_vehicle_px_experiences"."driver_id" is null and "driver_vehicle_px_experiences"."driver_id" is not null  
[2024-08-28 10:53:05] local.INFO: select sum("days") as aggregate from "driver_supply_px_experiences" where "driver_supply_px_experiences"."driver_id" is null and "driver_supply_px_experiences"."driver_id" is not null and exists (select * from "supplies" where "driver_supply_px_experiences"."supply_id" = "supplies"."id" and "name" != Nenhum)  
[2024-08-28 10:53:05] local.INFO: select exists(select * from "lead_campaign_results" where "lead_campaign_results"."driver_id" is null and "lead_campaign_results"."driver_id" is not null and "status" = campaign_canceled) as "exists"  
[2024-08-28 10:53:05] local.INFO: select "id", "type" from "courses" where "type" = toxicological limit 1  
[2024-08-28 10:53:05] local.INFO: select "type" from "courses" where "id" = 6 limit 1  
[2024-08-28 10:53:05] local.INFO: select sum("days") as aggregate from "driver_vehicle_px_experiences" where "driver_vehicle_px_experiences"."driver_id" is null and "driver_vehicle_px_experiences"."driver_id" is not null  
[2024-08-28 10:53:05] local.INFO: select "id", "type" from "courses" where "type" = toxicological limit 1  
[2024-08-28 10:53:05] local.INFO: select sum("days") as aggregate from "driver_supply_px_experiences" where "driver_supply_px_experiences"."driver_id" is null and "driver_supply_px_experiences"."driver_id" is not null and exists (select * from "supplies" where "driver_supply_px_experiences"."supply_id" = "supplies"."id" and "name" != Nenhum)  
[2024-08-28 10:53:05] local.INFO: select "type" from "courses" where "id" = 4 limit 1  
[2024-08-28 10:53:05] local.INFO: select exists(select * from "lead_campaign_results" where "lead_campaign_results"."driver_id" is null and "lead_campaign_results"."driver_id" is not null and "status" = campaign_canceled) as "exists"  
[2024-08-28 10:53:05] local.INFO: select sum("days") as aggregate from "driver_vehicle_px_experiences" where "driver_vehicle_px_experiences"."driver_id" is null and "driver_vehicle_px_experiences"."driver_id" is not null  
[2024-08-28 10:53:05] local.INFO: select sum("days") as aggregate from "driver_supply_px_experiences" where "driver_supply_px_experiences"."driver_id" is null and "driver_supply_px_experiences"."driver_id" is not null and exists (select * from "supplies" where "driver_supply_px_experiences"."supply_id" = "supplies"."id" and "name" != Nenhum)  
[2024-08-28 10:53:05] local.INFO: select exists(select * from "lead_campaign_results" where "lead_campaign_results"."driver_id" is null and "lead_campaign_results"."driver_id" is not null and "status" = campaign_canceled) as "exists"  
[2024-08-28 10:53:05] local.INFO: select * from "courses" where "courses"."id" = 4 limit 1  
[2024-08-28 10:53:05] local.INFO: select "id", "type" from "courses" where "type" = toxicological limit 1  
[2024-08-28 10:53:05] local.INFO: select "type" from "courses" where "id" = 4 limit 1  
[2024-08-28 10:53:05] local.INFO: select "id", "type" from "courses" where "type" = toxicological limit 1  
[2024-08-28 10:53:05] local.INFO: select "type" from "courses" where "id" = 3 limit 1  
[2024-08-28 10:53:05] local.INFO: select sum("days") as aggregate from "driver_vehicle_px_experiences" where "driver_vehicle_px_experiences"."driver_id" is null and "driver_vehicle_px_experiences"."driver_id" is not null  
[2024-08-28 10:53:05] local.INFO: select sum("days") as aggregate from "driver_supply_px_experiences" where "driver_supply_px_experiences"."driver_id" is null and "driver_supply_px_experiences"."driver_id" is not null and exists (select * from "supplies" where "driver_supply_px_experiences"."supply_id" = "supplies"."id" and "name" != Nenhum)  
[2024-08-28 10:53:05] local.INFO: select exists(select * from "lead_campaign_results" where "lead_campaign_results"."driver_id" is null and "lead_campaign_results"."driver_id" is not null and "status" = campaign_canceled) as "exists"  
[2024-08-28 10:53:05] local.INFO: select * from "courses" where "courses"."id" = 3 limit 1  
[2024-08-28 10:53:05] local.INFO: select "id", "type" from "courses" where "type" = toxicological limit 1  
[2024-08-28 10:53:05] local.INFO: select "type" from "courses" where "id" = 3 limit 1  
[2024-08-28 10:53:07] local.INFO: select * from "users" where "id" = 1 limit 1  
[2024-08-28 10:53:07] local.INFO: select * from "users" where "id" = 1  
[2024-08-28 10:53:07] local.INFO: select * from "role_user" where "role_user"."user_id" in (1)  
[2024-08-28 10:53:07] local.INFO: select * from "nova_notifications" where "notifiable_id" = 1 and "nova_notifications"."deleted_at" is null order by "created_at" desc limit 100  
[2024-08-28 10:53:07] local.INFO: select count(*) as aggregate from "nova_notifications" where "read_at" is null and "notifiable_id" = 1 and "nova_notifications"."deleted_at" is null  
[2024-08-28 10:53:07] local.INFO: select * from "users" where "id" = 1 limit 1  
[2024-08-28 10:53:07] local.INFO: select * from "users" where "id" = 1  
[2024-08-28 10:53:07] local.INFO: select * from "role_user" where "role_user"."user_id" in (1)  
[2024-08-28 10:53:07] local.INFO: select sum("days") as aggregate from "driver_vehicle_px_experiences" where "driver_vehicle_px_experiences"."driver_id" is null and "driver_vehicle_px_experiences"."driver_id" is not null  
[2024-08-28 10:53:07] local.INFO: select sum("days") as aggregate from "driver_supply_px_experiences" where "driver_supply_px_experiences"."driver_id" is null and "driver_supply_px_experiences"."driver_id" is not null and exists (select * from "supplies" where "driver_supply_px_experiences"."supply_id" = "supplies"."id" and "name" != Nenhum)  
[2024-08-28 10:53:07] local.INFO: select exists(select * from "lead_campaign_results" where "lead_campaign_results"."driver_id" is null and "lead_campaign_results"."driver_id" is not null and "status" = campaign_canceled) as "exists"  
[2024-08-28 10:53:07] local.INFO: select * from "drivers" where "drivers"."id" = 463 limit 1  
[2024-08-28 10:53:07] local.INFO: select sum("days") as aggregate from "driver_vehicle_px_experiences" where "driver_vehicle_px_experiences"."driver_id" is null and "driver_vehicle_px_experiences"."driver_id" is not null  
[2024-08-28 10:53:07] local.INFO: select sum("days") as aggregate from "driver_supply_px_experiences" where "driver_supply_px_experiences"."driver_id" is null and "driver_supply_px_experiences"."driver_id" is not null and exists (select * from "supplies" where "driver_supply_px_experiences"."supply_id" = "supplies"."id" and "name" != Nenhum)  
[2024-08-28 10:53:07] local.INFO: select exists(select * from "lead_campaign_results" where "lead_campaign_results"."driver_id" is null and "lead_campaign_results"."driver_id" is not null and "status" = campaign_canceled) as "exists"  
[2024-08-28 10:53:07] local.INFO: select * from "users" where "id" = 1 limit 1  
[2024-08-28 10:53:07] local.INFO: select * from "driver_vaccines" where "driver_vaccines"."driver_id" = 463 and "driver_vaccines"."driver_id" is not null order by "driver_vaccines"."id" desc limit 6 offset 0  
[2024-08-28 10:53:07] local.INFO: select count(*) as aggregate from "driver_vaccines" where "driver_vaccines"."driver_id" = 463 and "driver_vaccines"."driver_id" is not null  
[2024-08-28 10:53:07] local.INFO: select * from "users" where "id" = 1 limit 1  
[2024-08-28 10:53:07] local.INFO: select * from "users" where "id" = 1  
[2024-08-28 10:53:07] local.INFO: select * from "role_user" where "role_user"."user_id" in (1)  
[2024-08-28 10:53:07] local.INFO: select * from "driver_vaccines" where "driver_vaccines"."id" is null limit 1  
[2024-08-28 10:53:07] local.INFO: select * from "users" where "id" = 1  
[2024-08-28 10:53:07] local.INFO: select * from "role_user" where "role_user"."user_id" in (1)  
[2024-08-28 10:53:07] local.INFO: select * from "drivers" where "drivers"."id" = 463 limit 1  
[2024-08-28 10:53:07] local.INFO: select * from "users" where "id" = 1 limit 1  
[2024-08-28 10:53:07] local.INFO: select * from "users" where "id" = 1  
[2024-08-28 10:53:07] local.INFO: select * from "role_user" where "role_user"."user_id" in (1)  
[2024-08-28 10:53:07] local.INFO: select * from "driver_vaccines" where "driver_vaccines"."id" is null limit 1  
[2024-08-28 10:53:07] local.INFO: select sum("days") as aggregate from "driver_vehicle_px_experiences" where "driver_vehicle_px_experiences"."driver_id" is null and "driver_vehicle_px_experiences"."driver_id" is not null  
[2024-08-28 10:53:07] local.INFO: select sum("days") as aggregate from "driver_supply_px_experiences" where "driver_supply_px_experiences"."driver_id" is null and "driver_supply_px_experiences"."driver_id" is not null and exists (select * from "supplies" where "driver_supply_px_experiences"."supply_id" = "supplies"."id" and "name" != Nenhum)  
[2024-08-28 10:53:07] local.INFO: select exists(select * from "lead_campaign_results" where "lead_campaign_results"."driver_id" is null and "lead_campaign_results"."driver_id" is not null and "status" = campaign_canceled) as "exists"  
[2024-08-28 10:53:07] local.INFO: select sum("days") as aggregate from "driver_vehicle_px_experiences" where "driver_vehicle_px_experiences"."driver_id" is null and "driver_vehicle_px_experiences"."driver_id" is not null  
[2024-08-28 10:53:07] local.INFO: select sum("days") as aggregate from "driver_supply_px_experiences" where "driver_supply_px_experiences"."driver_id" is null and "driver_supply_px_experiences"."driver_id" is not null and exists (select * from "supplies" where "driver_supply_px_experiences"."supply_id" = "supplies"."id" and "name" != Nenhum)  
[2024-08-28 10:53:07] local.INFO: select exists(select * from "lead_campaign_results" where "lead_campaign_results"."driver_id" is null and "lead_campaign_results"."driver_id" is not null and "status" = campaign_canceled) as "exists"  
[2024-08-28 10:53:09] local.INFO: select * from "users" where "id" = 1 limit 1  
[2024-08-28 10:53:09] local.INFO: select * from "users" where "id" = 1  
[2024-08-28 10:53:09] local.INFO: select * from "role_user" where "role_user"."user_id" in (1)  
[2024-08-28 10:53:09] local.INFO: select * from "users" where "id" = 1 limit 1  
[2024-08-28 10:53:09] local.INFO: select * from "drivers" where "drivers"."id" = 463 limit 1  
[2024-08-28 10:53:09] local.INFO: select "roles".*, "role_user"."user_id" as "pivot_user_id", "role_user"."role_id" as "pivot_role_id" from "roles" inner join "role_user" on "roles"."id" = "role_user"."role_id" where "role_user"."user_id" = 1  
[2024-08-28 10:53:09] local.INFO: select * from "role_permission" where "role_permission"."role_id" in (3, 7)  
[2024-08-28 10:53:09] local.INFO: select * from "users" where "id" = 1  
[2024-08-28 10:53:09] local.INFO: select * from "role_user" where "role_user"."user_id" in (1)  
[2024-08-28 10:53:09] local.INFO: select * from "drivers" where "drivers"."id" is null limit 1  
[2024-08-28 10:53:09] local.INFO: select * from "users" where "id" = 1 limit 1  
[2024-08-28 10:53:09] local.INFO: select "roles".*, "role_user"."user_id" as "pivot_user_id", "role_user"."role_id" as "pivot_role_id" from "roles" inner join "role_user" on "roles"."id" = "role_user"."role_id" where "role_user"."user_id" = 1  
[2024-08-28 10:53:09] local.INFO: select * from "role_permission" where "role_permission"."role_id" in (3, 7)  
[2024-08-28 10:53:09] local.INFO: select * from "users" where "id" = 1  
[2024-08-28 10:53:09] local.INFO: select * from "role_user" where "role_user"."user_id" in (1)  
[2024-08-28 10:53:09] local.INFO: select "roles".*, "role_user"."user_id" as "pivot_user_id", "role_user"."role_id" as "pivot_role_id" from "roles" inner join "role_user" on "roles"."id" = "role_user"."role_id" where "role_user"."user_id" = 1  
[2024-08-28 10:53:09] local.INFO: select * from "role_permission" where "role_permission"."role_id" in (3, 7)  
[2024-08-28 10:53:09] local.INFO: select * from "users"  
[2024-08-28 10:53:09] local.INFO: select sum("days") as aggregate from "driver_vehicle_px_experiences" where "driver_vehicle_px_experiences"."driver_id" is null and "driver_vehicle_px_experiences"."driver_id" is not null  
[2024-08-28 10:53:09] local.INFO: select * from "cadex_driver_give_up_reason"  
[2024-08-28 10:53:09] local.INFO: select sum("days") as aggregate from "driver_supply_px_experiences" where "driver_supply_px_experiences"."driver_id" is null and "driver_supply_px_experiences"."driver_id" is not null and exists (select * from "supplies" where "driver_supply_px_experiences"."supply_id" = "supplies"."id" and "name" != Nenhum)  
[2024-08-28 10:53:09] local.INFO: select * from "driver_behavior_occurrence"  
[2024-08-28 10:53:09] local.INFO: select exists(select * from "lead_campaign_results" where "lead_campaign_results"."driver_id" is null and "lead_campaign_results"."driver_id" is not null and "status" = campaign_canceled) as "exists"  
[2024-08-28 10:53:09] local.INFO: select * from "drivers" where "drivers"."id" = 463 limit 1  
[2024-08-28 10:53:09] local.INFO: select sum("days") as aggregate from "driver_vehicle_px_experiences" where "driver_vehicle_px_experiences"."driver_id" is null and "driver_vehicle_px_experiences"."driver_id" is not null  
[2024-08-28 10:53:09] local.INFO: select sum("days") as aggregate from "driver_supply_px_experiences" where "driver_supply_px_experiences"."driver_id" is null and "driver_supply_px_experiences"."driver_id" is not null and exists (select * from "supplies" where "driver_supply_px_experiences"."supply_id" = "supplies"."id" and "name" != Nenhum)  
[2024-08-28 10:53:09] local.INFO: select exists(select * from "lead_campaign_results" where "lead_campaign_results"."driver_id" is null and "lead_campaign_results"."driver_id" is not null and "status" = campaign_canceled) as "exists"  
[2024-08-28 10:53:09] local.INFO: select * from "users" where "id" = 1 limit 1  
[2024-08-28 10:53:09] local.INFO: select sum("days") as aggregate from "driver_vehicle_px_experiences" where "driver_vehicle_px_experiences"."driver_id" is null and "driver_vehicle_px_experiences"."driver_id" is not null  
[2024-08-28 10:53:09] local.INFO: select sum("days") as aggregate from "driver_supply_px_experiences" where "driver_supply_px_experiences"."driver_id" is null and "driver_supply_px_experiences"."driver_id" is not null and exists (select * from "supplies" where "driver_supply_px_experiences"."supply_id" = "supplies"."id" and "name" != Nenhum)  
[2024-08-28 10:53:09] local.INFO: select exists(select * from "lead_campaign_results" where "lead_campaign_results"."driver_id" is null and "lead_campaign_results"."driver_id" is not null and "status" = campaign_canceled) as "exists"  
[2024-08-28 10:53:09] local.INFO: select * from "users" where "id" = 1  
[2024-08-28 10:53:09] local.INFO: select * from "role_user" where "role_user"."user_id" in (1)  
[2024-08-28 10:53:09] local.INFO: select * from "drivers" where "drivers"."id" is null limit 1  
[2024-08-28 10:53:09] local.INFO: select "roles".*, "role_user"."user_id" as "pivot_user_id", "role_user"."role_id" as "pivot_role_id" from "roles" inner join "role_user" on "roles"."id" = "role_user"."role_id" where "role_user"."user_id" = 1  
[2024-08-28 10:53:09] local.INFO: select * from "drivers" where "drivers"."referred_by" = 463 and "drivers"."referred_by" is not null order by "drivers"."id" desc limit 6 offset 0  
[2024-08-28 10:53:09] local.INFO: select * from "role_permission" where "role_permission"."role_id" in (3, 7)  
[2024-08-28 10:53:09] local.INFO: select * from "driver_attendance_summaries" where "driver_attendance_summaries"."driver_id" in (11025, 11026, 11033, 11034, 11041, 11089) order by "driver_attendance_summaries"."id" desc  
[2024-08-28 10:53:09] local.INFO: select sum("days") as aggregate from "driver_vehicle_px_experiences" where "driver_vehicle_px_experiences"."driver_id" is null and "driver_vehicle_px_experiences"."driver_id" is not null  
[2024-08-28 10:53:09] local.INFO: select count(*) as aggregate from "drivers" where "drivers"."referred_by" = 463 and "drivers"."referred_by" is not null  
[2024-08-28 10:53:09] local.INFO: select sum("days") as aggregate from "driver_vehicle_px_experiences" where "driver_vehicle_px_experiences"."driver_id" = 11089 and "driver_vehicle_px_experiences"."driver_id" is not null  
[2024-08-28 10:53:09] local.INFO: select sum("days") as aggregate from "driver_supply_px_experiences" where "driver_supply_px_experiences"."driver_id" is null and "driver_supply_px_experiences"."driver_id" is not null and exists (select * from "supplies" where "driver_supply_px_experiences"."supply_id" = "supplies"."id" and "name" != Nenhum)  
[2024-08-28 10:53:09] local.INFO: select sum("days") as aggregate from "driver_supply_px_experiences" where "driver_supply_px_experiences"."driver_id" = 11089 and "driver_supply_px_experiences"."driver_id" is not null and exists (select * from "supplies" where "driver_supply_px_experiences"."supply_id" = "supplies"."id" and "name" != Nenhum)  
[2024-08-28 10:53:10] local.INFO: select exists(select * from "lead_campaign_results" where "lead_campaign_results"."driver_id" = 11089 and "lead_campaign_results"."driver_id" is not null and "status" = campaign_canceled) as "exists"  
[2024-08-28 10:53:10] local.INFO: select exists(select * from "lead_campaign_results" where "lead_campaign_results"."driver_id" is null and "lead_campaign_results"."driver_id" is not null and "status" = campaign_canceled) as "exists"  
[2024-08-28 10:53:10] local.INFO: select "group", "tier" from "driver_scores" where "driver_id" = 11089 limit 1  
[2024-08-28 10:53:10] local.INFO: select sum("days") as aggregate from "driver_vehicle_px_experiences" where "driver_vehicle_px_experiences"."driver_id" is null and "driver_vehicle_px_experiences"."driver_id" is not null  
[2024-08-28 10:53:10] local.INFO: select sum("days") as aggregate from "driver_supply_px_experiences" where "driver_supply_px_experiences"."driver_id" is null and "driver_supply_px_experiences"."driver_id" is not null and exists (select * from "supplies" where "driver_supply_px_experiences"."supply_id" = "supplies"."id" and "name" != Nenhum)  
[2024-08-28 10:53:10] local.INFO: select exists(select * from "lead_campaign_results" where "lead_campaign_results"."driver_id" is null and "lead_campaign_results"."driver_id" is not null and "status" = campaign_canceled) as "exists"  
[2024-08-28 10:53:10] local.INFO: select * from "users"  
[2024-08-28 10:53:10] local.INFO: select * from "cadex_driver_give_up_reason"  
[2024-08-28 10:53:10] local.INFO: select * from "driver_behavior_occurrence"  
[2024-08-28 10:53:10] local.INFO: select sum("days") as aggregate from "driver_vehicle_px_experiences" where "driver_vehicle_px_experiences"."driver_id" = 11089 and "driver_vehicle_px_experiences"."driver_id" is not null  
[2024-08-28 10:53:10] local.INFO: select sum("days") as aggregate from "driver_supply_px_experiences" where "driver_supply_px_experiences"."driver_id" = 11089 and "driver_supply_px_experiences"."driver_id" is not null and exists (select * from "supplies" where "driver_supply_px_experiences"."supply_id" = "supplies"."id" and "name" != Nenhum)  
[2024-08-28 10:53:10] local.INFO: select exists(select * from "lead_campaign_results" where "lead_campaign_results"."driver_id" = 11089 and "lead_campaign_results"."driver_id" is not null and "status" = campaign_canceled) as "exists"  
[2024-08-28 10:53:10] local.INFO: select sum("days") as aggregate from "driver_vehicle_px_experiences" where "driver_vehicle_px_experiences"."driver_id" = 11041 and "driver_vehicle_px_experiences"."driver_id" is not null  
[2024-08-28 10:53:10] local.INFO: select sum("days") as aggregate from "driver_supply_px_experiences" where "driver_supply_px_experiences"."driver_id" = 11041 and "driver_supply_px_experiences"."driver_id" is not null and exists (select * from "supplies" where "driver_supply_px_experiences"."supply_id" = "supplies"."id" and "name" != Nenhum)  
[2024-08-28 10:53:10] local.INFO: select exists(select * from "lead_campaign_results" where "lead_campaign_results"."driver_id" = 11041 and "lead_campaign_results"."driver_id" is not null and "status" = campaign_canceled) as "exists"  
[2024-08-28 10:53:10] local.INFO: select "group", "tier" from "driver_scores" where "driver_id" = 11041 limit 1  
[2024-08-28 10:53:10] local.INFO: select * from "users" where "users"."id" = 13 limit 1  
[2024-08-28 10:53:10] local.INFO: select sum("days") as aggregate from "driver_vehicle_px_experiences" where "driver_vehicle_px_experiences"."driver_id" = 11041 and "driver_vehicle_px_experiences"."driver_id" is not null  
[2024-08-28 10:53:10] local.INFO: select sum("days") as aggregate from "driver_supply_px_experiences" where "driver_supply_px_experiences"."driver_id" = 11041 and "driver_supply_px_experiences"."driver_id" is not null and exists (select * from "supplies" where "driver_supply_px_experiences"."supply_id" = "supplies"."id" and "name" != Nenhum)  
[2024-08-28 10:53:10] local.INFO: select exists(select * from "lead_campaign_results" where "lead_campaign_results"."driver_id" = 11041 and "lead_campaign_results"."driver_id" is not null and "status" = campaign_canceled) as "exists"  
[2024-08-28 10:53:10] local.INFO: select sum("days") as aggregate from "driver_vehicle_px_experiences" where "driver_vehicle_px_experiences"."driver_id" = 11034 and "driver_vehicle_px_experiences"."driver_id" is not null  
[2024-08-28 10:53:10] local.INFO: select sum("days") as aggregate from "driver_supply_px_experiences" where "driver_supply_px_experiences"."driver_id" = 11034 and "driver_supply_px_experiences"."driver_id" is not null and exists (select * from "supplies" where "driver_supply_px_experiences"."supply_id" = "supplies"."id" and "name" != Nenhum)  
[2024-08-28 10:53:10] local.INFO: select exists(select * from "lead_campaign_results" where "lead_campaign_results"."driver_id" = 11034 and "lead_campaign_results"."driver_id" is not null and "status" = campaign_canceled) as "exists"  
[2024-08-28 10:53:10] local.INFO: select "group", "tier" from "driver_scores" where "driver_id" = 11034 limit 1  
[2024-08-28 10:53:10] local.INFO: select * from "users" where "users"."id" = 2 limit 1  
[2024-08-28 10:53:10] local.INFO: select sum("days") as aggregate from "driver_vehicle_px_experiences" where "driver_vehicle_px_experiences"."driver_id" = 11034 and "driver_vehicle_px_experiences"."driver_id" is not null  
[2024-08-28 10:53:10] local.INFO: select sum("days") as aggregate from "driver_supply_px_experiences" where "driver_supply_px_experiences"."driver_id" = 11034 and "driver_supply_px_experiences"."driver_id" is not null and exists (select * from "supplies" where "driver_supply_px_experiences"."supply_id" = "supplies"."id" and "name" != Nenhum)  
[2024-08-28 10:53:10] local.INFO: select exists(select * from "lead_campaign_results" where "lead_campaign_results"."driver_id" = 11034 and "lead_campaign_results"."driver_id" is not null and "status" = campaign_canceled) as "exists"  
[2024-08-28 10:53:10] local.INFO: select sum("days") as aggregate from "driver_vehicle_px_experiences" where "driver_vehicle_px_experiences"."driver_id" = 11033 and "driver_vehicle_px_experiences"."driver_id" is not null  
[2024-08-28 10:53:10] local.INFO: select sum("days") as aggregate from "driver_supply_px_experiences" where "driver_supply_px_experiences"."driver_id" = 11033 and "driver_supply_px_experiences"."driver_id" is not null and exists (select * from "supplies" where "driver_supply_px_experiences"."supply_id" = "supplies"."id" and "name" != Nenhum)  
[2024-08-28 10:53:10] local.INFO: select exists(select * from "lead_campaign_results" where "lead_campaign_results"."driver_id" = 11033 and "lead_campaign_results"."driver_id" is not null and "status" = campaign_canceled) as "exists"  
[2024-08-28 10:53:10] local.INFO: select "group", "tier" from "driver_scores" where "driver_id" = 11033 limit 1  
[2024-08-28 10:53:10] local.INFO: select * from "users" where "users"."id" = 2 limit 1  
[2024-08-28 10:53:10] local.INFO: select sum("days") as aggregate from "driver_vehicle_px_experiences" where "driver_vehicle_px_experiences"."driver_id" = 11033 and "driver_vehicle_px_experiences"."driver_id" is not null  
[2024-08-28 10:53:10] local.INFO: select sum("days") as aggregate from "driver_supply_px_experiences" where "driver_supply_px_experiences"."driver_id" = 11033 and "driver_supply_px_experiences"."driver_id" is not null and exists (select * from "supplies" where "driver_supply_px_experiences"."supply_id" = "supplies"."id" and "name" != Nenhum)  
[2024-08-28 10:53:10] local.INFO: select exists(select * from "lead_campaign_results" where "lead_campaign_results"."driver_id" = 11033 and "lead_campaign_results"."driver_id" is not null and "status" = campaign_canceled) as "exists"  
[2024-08-28 10:53:10] local.INFO: select sum("days") as aggregate from "driver_vehicle_px_experiences" where "driver_vehicle_px_experiences"."driver_id" = 11026 and "driver_vehicle_px_experiences"."driver_id" is not null  
[2024-08-28 10:53:10] local.INFO: select sum("days") as aggregate from "driver_supply_px_experiences" where "driver_supply_px_experiences"."driver_id" = 11026 and "driver_supply_px_experiences"."driver_id" is not null and exists (select * from "supplies" where "driver_supply_px_experiences"."supply_id" = "supplies"."id" and "name" != Nenhum)  
[2024-08-28 10:53:10] local.INFO: select exists(select * from "lead_campaign_results" where "lead_campaign_results"."driver_id" = 11026 and "lead_campaign_results"."driver_id" is not null and "status" = campaign_canceled) as "exists"  
[2024-08-28 10:53:10] local.INFO: select "group", "tier" from "driver_scores" where "driver_id" = 11026 limit 1  
[2024-08-28 10:53:10] local.INFO: select * from "users" where "users"."id" = 2 limit 1  
[2024-08-28 10:53:10] local.INFO: select sum("days") as aggregate from "driver_vehicle_px_experiences" where "driver_vehicle_px_experiences"."driver_id" = 11026 and "driver_vehicle_px_experiences"."driver_id" is not null  
[2024-08-28 10:53:10] local.INFO: select sum("days") as aggregate from "driver_supply_px_experiences" where "driver_supply_px_experiences"."driver_id" = 11026 and "driver_supply_px_experiences"."driver_id" is not null and exists (select * from "supplies" where "driver_supply_px_experiences"."supply_id" = "supplies"."id" and "name" != Nenhum)  
[2024-08-28 10:53:10] local.INFO: select exists(select * from "lead_campaign_results" where "lead_campaign_results"."driver_id" = 11026 and "lead_campaign_results"."driver_id" is not null and "status" = campaign_canceled) as "exists"  
[2024-08-28 10:53:14] local.INFO: select * from "users" where "id" = 1 limit 1  
[2024-08-28 10:53:14] local.INFO: select * from "users" where "id" = 1  
[2024-08-28 10:53:14] local.INFO: select * from "role_user" where "role_user"."user_id" in (1)  
[2024-08-28 10:53:14] local.INFO: select * from "nova_notifications" where "notifiable_id" = 1 and "nova_notifications"."deleted_at" is null order by "created_at" desc limit 100  
[2024-08-28 10:53:14] local.INFO: select count(*) as aggregate from "nova_notifications" where "read_at" is null and "notifiable_id" = 1 and "nova_notifications"."deleted_at" is null  
[2024-08-28 10:53:18] local.INFO: select * from "users" where "id" = 1 limit 1  
[2024-08-28 10:53:18] local.INFO: select * from "users" where "id" = 1 limit 1  
[2024-08-28 10:53:18] local.INFO: select * from "users" where "id" = 1  
[2024-08-28 10:53:18] local.INFO: select * from "role_user" where "role_user"."user_id" in (1)  
[2024-08-28 10:53:18] local.INFO: select * from "driver_ratings" where "driver_ratings"."id" is null limit 1  
[2024-08-28 10:53:18] local.INFO: select sum("days") as aggregate from "driver_vehicle_px_experiences" where "driver_vehicle_px_experiences"."driver_id" is null and "driver_vehicle_px_experiences"."driver_id" is not null  
[2024-08-28 10:53:18] local.INFO: select * from "users" where "id" = 1  
[2024-08-28 10:53:18] local.INFO: select sum("days") as aggregate from "driver_supply_px_experiences" where "driver_supply_px_experiences"."driver_id" is null and "driver_supply_px_experiences"."driver_id" is not null and exists (select * from "supplies" where "driver_supply_px_experiences"."supply_id" = "supplies"."id" and "name" != Nenhum)  
[2024-08-28 10:53:18] local.INFO: select * from "role_user" where "role_user"."user_id" in (1)  
[2024-08-28 10:53:18] local.INFO: select exists(select * from "lead_campaign_results" where "lead_campaign_results"."driver_id" is null and "lead_campaign_results"."driver_id" is not null and "status" = campaign_canceled) as "exists"  
[2024-08-28 10:53:18] local.INFO: select * from "users" where "id" = 1 limit 1  
[2024-08-28 10:53:18] local.INFO: select sum("days") as aggregate from "driver_vehicle_px_experiences" where "driver_vehicle_px_experiences"."driver_id" is null and "driver_vehicle_px_experiences"."driver_id" is not null  
[2024-08-28 10:53:18] local.INFO: select sum("days") as aggregate from "driver_vehicle_px_experiences" where "driver_vehicle_px_experiences"."driver_id" is null and "driver_vehicle_px_experiences"."driver_id" is not null  
[2024-08-28 10:53:18] local.INFO: select sum("days") as aggregate from "driver_supply_px_experiences" where "driver_supply_px_experiences"."driver_id" is null and "driver_supply_px_experiences"."driver_id" is not null and exists (select * from "supplies" where "driver_supply_px_experiences"."supply_id" = "supplies"."id" and "name" != Nenhum)  
[2024-08-28 10:53:18] local.INFO: select sum("days") as aggregate from "driver_supply_px_experiences" where "driver_supply_px_experiences"."driver_id" is null and "driver_supply_px_experiences"."driver_id" is not null and exists (select * from "supplies" where "driver_supply_px_experiences"."supply_id" = "supplies"."id" and "name" != Nenhum)  
[2024-08-28 10:53:18] local.INFO: select exists(select * from "lead_campaign_results" where "lead_campaign_results"."driver_id" is null and "lead_campaign_results"."driver_id" is not null and "status" = campaign_canceled) as "exists"  
[2024-08-28 10:53:18] local.INFO: select exists(select * from "lead_campaign_results" where "lead_campaign_results"."driver_id" is null and "lead_campaign_results"."driver_id" is not null and "status" = campaign_canceled) as "exists"  
[2024-08-28 10:53:18] local.INFO: select * from "users" where "id" = 1  
[2024-08-28 10:53:18] local.INFO: select * from "role_user" where "role_user"."user_id" in (1)  
[2024-08-28 10:53:18] local.INFO: select * from "drivers" where "drivers"."id" = 463 limit 1  
[2024-08-28 10:53:18] local.INFO: select * from "driver_ratings" where "driver_ratings"."id" is null limit 1  
[2024-08-28 10:53:18] local.INFO: select * from "driver_ratings" where "driver_ratings"."driver_id" = 463 and "driver_ratings"."driver_id" is not null order by "driver_ratings"."id" desc limit 6 offset 0  
[2024-08-28 10:53:18] local.INFO: select count(*) as aggregate from "driver_ratings" where "driver_ratings"."driver_id" = 463 and "driver_ratings"."driver_id" is not null  
[2024-08-28 10:53:18] local.INFO: select * from "companies" where "companies"."id" = 191 limit 1  
[2024-08-28 10:53:18] local.INFO: select "roles".*, "role_user"."user_id" as "pivot_user_id", "role_user"."role_id" as "pivot_role_id" from "roles" inner join "role_user" on "roles"."id" = "role_user"."role_id" where "role_user"."user_id" = 1  
[2024-08-28 10:53:18] local.INFO: select * from "role_permission" where "role_permission"."role_id" in (3, 7)  
[2024-08-28 10:53:18] local.INFO: select * from "companies" where "companies"."id" = 191 limit 1  
[2024-08-28 10:53:18] local.INFO: select * from "companies" where "companies"."id" = 191 limit 1  
[2024-08-28 10:53:18] local.INFO: select * from "companies" where "companies"."id" = 191 limit 1  
[2024-08-28 10:53:18] local.INFO: select * from "companies" where "companies"."id" = 191 limit 1  
[2024-08-28 10:53:21] local.INFO: select * from "users" where "id" = 1 limit 1  
[2024-08-28 10:53:21] local.INFO: select * from "users" where "id" = 1  
[2024-08-28 10:53:21] local.INFO: select * from "role_user" where "role_user"."user_id" in (1)  
[2024-08-28 10:53:21] local.INFO: select * from "nova_notifications" where "notifiable_id" = 1 and "nova_notifications"."deleted_at" is null order by "created_at" desc limit 100  
[2024-08-28 10:53:21] local.INFO: select count(*) as aggregate from "nova_notifications" where "read_at" is null and "notifiable_id" = 1 and "nova_notifications"."deleted_at" is null  
[2024-08-28 10:53:21] local.INFO: select * from "users" where "id" = 1 limit 1  
[2024-08-28 10:53:21] local.INFO: select * from "users" where "id" = 1  
[2024-08-28 10:53:21] local.INFO: select * from "role_user" where "role_user"."user_id" in (1)  
[2024-08-28 10:53:21] local.INFO: select * from "accepted_terms" where "accepted_terms"."id" is null limit 1  
[2024-08-28 10:53:21] local.INFO: select * from "users" where "id" = 1 limit 1  
[2024-08-28 10:53:21] local.INFO: select * from "users" where "id" = 1  
[2024-08-28 10:53:21] local.INFO: select * from "role_user" where "role_user"."user_id" in (1)  
[2024-08-28 10:53:21] local.INFO: select * from "users" where "id" = 1 limit 1  
[2024-08-28 10:53:21] local.INFO: select * from "accepted_terms" where "accepted_terms"."id" is null limit 1  
[2024-08-28 10:53:21] local.INFO: select sum("days") as aggregate from "driver_vehicle_px_experiences" where "driver_vehicle_px_experiences"."driver_id" is null and "driver_vehicle_px_experiences"."driver_id" is not null  
[2024-08-28 10:53:21] local.INFO: select * from "users" where "id" = 1  
[2024-08-28 10:53:21] local.INFO: select * from "role_user" where "role_user"."user_id" in (1)  
[2024-08-28 10:53:21] local.INFO: select sum("days") as aggregate from "driver_supply_px_experiences" where "driver_supply_px_experiences"."driver_id" is null and "driver_supply_px_experiences"."driver_id" is not null and exists (select * from "supplies" where "driver_supply_px_experiences"."supply_id" = "supplies"."id" and "name" != Nenhum)  
[2024-08-28 10:53:21] local.INFO: select sum("days") as aggregate from "driver_vehicle_px_experiences" where "driver_vehicle_px_experiences"."driver_id" is null and "driver_vehicle_px_experiences"."driver_id" is not null  
[2024-08-28 10:53:21] local.INFO: select exists(select * from "lead_campaign_results" where "lead_campaign_results"."driver_id" is null and "lead_campaign_results"."driver_id" is not null and "status" = campaign_canceled) as "exists"  
[2024-08-28 10:53:21] local.INFO: select sum("days") as aggregate from "driver_supply_px_experiences" where "driver_supply_px_experiences"."driver_id" is null and "driver_supply_px_experiences"."driver_id" is not null and exists (select * from "supplies" where "driver_supply_px_experiences"."supply_id" = "supplies"."id" and "name" != Nenhum)  
[2024-08-28 10:53:21] local.INFO: select exists(select * from "lead_campaign_results" where "lead_campaign_results"."driver_id" is null and "lead_campaign_results"."driver_id" is not null and "status" = campaign_canceled) as "exists"  
[2024-08-28 10:53:21] local.INFO: select sum("days") as aggregate from "driver_vehicle_px_experiences" where "driver_vehicle_px_experiences"."driver_id" is null and "driver_vehicle_px_experiences"."driver_id" is not null  
[2024-08-28 10:53:21] local.INFO: select * from "drivers" where "drivers"."id" = 463 limit 1  
[2024-08-28 10:53:21] local.INFO: select sum("days") as aggregate from "driver_supply_px_experiences" where "driver_supply_px_experiences"."driver_id" is null and "driver_supply_px_experiences"."driver_id" is not null and exists (select * from "supplies" where "driver_supply_px_experiences"."supply_id" = "supplies"."id" and "name" != Nenhum)  
[2024-08-28 10:53:21] local.INFO: select sum("days") as aggregate from "driver_vehicle_px_experiences" where "driver_vehicle_px_experiences"."driver_id" is null and "driver_vehicle_px_experiences"."driver_id" is not null  
[2024-08-28 10:53:21] local.INFO: select exists(select * from "lead_campaign_results" where "lead_campaign_results"."driver_id" is null and "lead_campaign_results"."driver_id" is not null and "status" = campaign_canceled) as "exists"  
[2024-08-28 10:53:21] local.INFO: select sum("days") as aggregate from "driver_supply_px_experiences" where "driver_supply_px_experiences"."driver_id" is null and "driver_supply_px_experiences"."driver_id" is not null and exists (select * from "supplies" where "driver_supply_px_experiences"."supply_id" = "supplies"."id" and "name" != Nenhum)  
[2024-08-28 10:53:21] local.INFO: select exists(select * from "lead_campaign_results" where "lead_campaign_results"."driver_id" is null and "lead_campaign_results"."driver_id" is not null and "status" = campaign_canceled) as "exists"  
[2024-08-28 10:53:21] local.INFO: select * from "accepted_terms" where "accepted_terms"."acceptable_type" = App\Models\Driver and "accepted_terms"."acceptable_id" = 463 and "accepted_terms"."acceptable_id" is not null order by "accepted_terms"."id" desc limit 6 offset 0  
[2024-08-28 10:53:21] local.INFO: select count(*) as aggregate from "accepted_terms" where "accepted_terms"."acceptable_type" = App\Models\Driver and "accepted_terms"."acceptable_id" = 463 and "accepted_terms"."acceptable_id" is not null  
[2024-08-28 10:53:21] local.INFO: select sum("days") as aggregate from "driver_vehicle_px_experiences" where "driver_vehicle_px_experiences"."driver_id" is null and "driver_vehicle_px_experiences"."driver_id" is not null  
[2024-08-28 10:53:21] local.INFO: select sum("days") as aggregate from "driver_supply_px_experiences" where "driver_supply_px_experiences"."driver_id" is null and "driver_supply_px_experiences"."driver_id" is not null and exists (select * from "supplies" where "driver_supply_px_experiences"."supply_id" = "supplies"."id" and "name" != Nenhum)  
[2024-08-28 10:53:21] local.INFO: select exists(select * from "lead_campaign_results" where "lead_campaign_results"."driver_id" is null and "lead_campaign_results"."driver_id" is not null and "status" = campaign_canceled) as "exists"  
[2024-08-28 10:53:21] local.INFO: select * from "drivers" where "drivers"."id" = 463 limit 1  
[2024-08-28 10:53:21] local.INFO: select * from "terms" where "terms"."id" = 12 limit 1  
[2024-08-28 10:53:21] local.INFO: select "roles".*, "role_user"."user_id" as "pivot_user_id", "role_user"."role_id" as "pivot_role_id" from "roles" inner join "role_user" on "roles"."id" = "role_user"."role_id" where "role_user"."user_id" = 1  
[2024-08-28 10:53:21] local.INFO: select * from "role_permission" where "role_permission"."role_id" in (3, 7)  
[2024-08-28 10:53:21] local.INFO: select * from "terms" where "terms"."id" = 12 limit 1  
[2024-08-28 10:53:21] local.INFO: select sum("days") as aggregate from "driver_vehicle_px_experiences" where "driver_vehicle_px_experiences"."driver_id" is null and "driver_vehicle_px_experiences"."driver_id" is not null  
[2024-08-28 10:53:21] local.INFO: select sum("days") as aggregate from "driver_supply_px_experiences" where "driver_supply_px_experiences"."driver_id" is null and "driver_supply_px_experiences"."driver_id" is not null and exists (select * from "supplies" where "driver_supply_px_experiences"."supply_id" = "supplies"."id" and "name" != Nenhum)  
[2024-08-28 10:53:21] local.INFO: select exists(select * from "lead_campaign_results" where "lead_campaign_results"."driver_id" is null and "lead_campaign_results"."driver_id" is not null and "status" = campaign_canceled) as "exists"  
[2024-08-28 10:53:21] local.INFO: select * from "drivers" where "drivers"."id" = 463 limit 1  
[2024-08-28 10:53:21] local.INFO: select * from "terms" where "terms"."id" = 11 limit 1  
[2024-08-28 10:53:21] local.INFO: select * from "terms" where "terms"."id" = 11 limit 1  
[2024-08-28 10:53:21] local.INFO: select sum("days") as aggregate from "driver_vehicle_px_experiences" where "driver_vehicle_px_experiences"."driver_id" is null and "driver_vehicle_px_experiences"."driver_id" is not null  
[2024-08-28 10:53:21] local.INFO: select sum("days") as aggregate from "driver_supply_px_experiences" where "driver_supply_px_experiences"."driver_id" is null and "driver_supply_px_experiences"."driver_id" is not null and exists (select * from "supplies" where "driver_supply_px_experiences"."supply_id" = "supplies"."id" and "name" != Nenhum)  
[2024-08-28 10:53:21] local.INFO: select exists(select * from "lead_campaign_results" where "lead_campaign_results"."driver_id" is null and "lead_campaign_results"."driver_id" is not null and "status" = campaign_canceled) as "exists"  
[2024-08-28 10:53:21] local.INFO: select * from "drivers" where "drivers"."id" = 463 limit 1  
[2024-08-28 10:53:21] local.INFO: select * from "terms" where "terms"."id" = 10 limit 1  
[2024-08-28 10:53:21] local.INFO: select * from "terms" where "terms"."id" = 10 limit 1  
[2024-08-28 10:53:21] local.INFO: select sum("days") as aggregate from "driver_vehicle_px_experiences" where "driver_vehicle_px_experiences"."driver_id" is null and "driver_vehicle_px_experiences"."driver_id" is not null  
[2024-08-28 10:53:21] local.INFO: select sum("days") as aggregate from "driver_supply_px_experiences" where "driver_supply_px_experiences"."driver_id" is null and "driver_supply_px_experiences"."driver_id" is not null and exists (select * from "supplies" where "driver_supply_px_experiences"."supply_id" = "supplies"."id" and "name" != Nenhum)  
[2024-08-28 10:53:21] local.INFO: select exists(select * from "lead_campaign_results" where "lead_campaign_results"."driver_id" is null and "lead_campaign_results"."driver_id" is not null and "status" = campaign_canceled) as "exists"  
[2024-08-28 10:53:21] local.INFO: select * from "drivers" where "drivers"."id" = 463 limit 1  
[2024-08-28 10:53:21] local.INFO: select * from "terms" where "terms"."id" = 9 limit 1  
[2024-08-28 10:53:21] local.INFO: select * from "terms" where "terms"."id" = 9 limit 1  
[2024-08-28 10:53:21] local.INFO: select sum("days") as aggregate from "driver_vehicle_px_experiences" where "driver_vehicle_px_experiences"."driver_id" is null and "driver_vehicle_px_experiences"."driver_id" is not null  
[2024-08-28 10:53:21] local.INFO: select sum("days") as aggregate from "driver_supply_px_experiences" where "driver_supply_px_experiences"."driver_id" is null and "driver_supply_px_experiences"."driver_id" is not null and exists (select * from "supplies" where "driver_supply_px_experiences"."supply_id" = "supplies"."id" and "name" != Nenhum)  
[2024-08-28 10:53:21] local.INFO: select exists(select * from "lead_campaign_results" where "lead_campaign_results"."driver_id" is null and "lead_campaign_results"."driver_id" is not null and "status" = campaign_canceled) as "exists"  
[2024-08-28 10:53:21] local.INFO: select * from "drivers" where "drivers"."id" = 463 limit 1  
[2024-08-28 10:53:21] local.INFO: select * from "terms" where "terms"."id" = 6 limit 1  
[2024-08-28 10:53:21] local.INFO: select * from "terms" where "terms"."id" = 6 limit 1  
[2024-08-28 10:53:23] local.INFO: select * from "users" where "id" = 1 limit 1  
[2024-08-28 10:53:23] local.INFO: select * from "users" where "id" = 1 limit 1  
[2024-08-28 10:53:23] local.INFO: select * from "users" where "id" = 1  
[2024-08-28 10:53:23] local.INFO: select * from "role_user" where "role_user"."user_id" in (1)  
[2024-08-28 10:53:23] local.INFO: select * from "users" where "id" = 1  
[2024-08-28 10:53:23] local.INFO: select * from "role_user" where "role_user"."user_id" in (1)  
[2024-08-28 10:53:23] local.INFO: select sum("days") as aggregate from "driver_vehicle_px_experiences" where "driver_vehicle_px_experiences"."driver_id" is null and "driver_vehicle_px_experiences"."driver_id" is not null  
[2024-08-28 10:53:23] local.INFO: select * from "driver_histories" where "driver_histories"."id" is null limit 1  
[2024-08-28 10:53:23] local.INFO: select sum("days") as aggregate from "driver_supply_px_experiences" where "driver_supply_px_experiences"."driver_id" is null and "driver_supply_px_experiences"."driver_id" is not null and exists (select * from "supplies" where "driver_supply_px_experiences"."supply_id" = "supplies"."id" and "name" != Nenhum)  
[2024-08-28 10:53:23] local.INFO: select exists(select * from "lead_campaign_results" where "lead_campaign_results"."driver_id" is null and "lead_campaign_results"."driver_id" is not null and "status" = campaign_canceled) as "exists"  
[2024-08-28 10:53:23] local.INFO: select * from "drivers" where "drivers"."id" = 463 limit 1  
[2024-08-28 10:53:23] local.INFO: select sum("days") as aggregate from "driver_vehicle_px_experiences" where "driver_vehicle_px_experiences"."driver_id" is null and "driver_vehicle_px_experiences"."driver_id" is not null  
[2024-08-28 10:53:23] local.INFO: select sum("days") as aggregate from "driver_supply_px_experiences" where "driver_supply_px_experiences"."driver_id" is null and "driver_supply_px_experiences"."driver_id" is not null and exists (select * from "supplies" where "driver_supply_px_experiences"."supply_id" = "supplies"."id" and "name" != Nenhum)  
[2024-08-28 10:53:23] local.INFO: select exists(select * from "lead_campaign_results" where "lead_campaign_results"."driver_id" is null and "lead_campaign_results"."driver_id" is not null and "status" = campaign_canceled) as "exists"  
[2024-08-28 10:53:23] local.INFO: select * from "driver_histories" where "driver_histories"."driver_id" = 463 and "driver_histories"."driver_id" is not null order by "driver_histories"."id" desc limit 6 offset 0  
[2024-08-28 10:53:23] local.INFO: select * from "users" where "id" = 1 limit 1  
[2024-08-28 10:53:23] local.INFO: select count(*) as aggregate from "driver_histories" where "driver_histories"."driver_id" = 463 and "driver_histories"."driver_id" is not null  
[2024-08-28 10:53:23] local.INFO: select sum("days") as aggregate from "driver_vehicle_px_experiences" where "driver_vehicle_px_experiences"."driver_id" is null and "driver_vehicle_px_experiences"."driver_id" is not null  
[2024-08-28 10:53:23] local.INFO: select sum("days") as aggregate from "driver_supply_px_experiences" where "driver_supply_px_experiences"."driver_id" is null and "driver_supply_px_experiences"."driver_id" is not null and exists (select * from "supplies" where "driver_supply_px_experiences"."supply_id" = "supplies"."id" and "name" != Nenhum)  
[2024-08-28 10:53:23] local.INFO: select exists(select * from "lead_campaign_results" where "lead_campaign_results"."driver_id" is null and "lead_campaign_results"."driver_id" is not null and "status" = campaign_canceled) as "exists"  
[2024-08-28 10:53:23] local.INFO: select * from "users" where "id" = 1  
[2024-08-28 10:53:23] local.INFO: select * from "role_user" where "role_user"."user_id" in (1)  
[2024-08-28 10:53:23] local.INFO: select sum("days") as aggregate from "driver_vehicle_px_experiences" where "driver_vehicle_px_experiences"."driver_id" is null and "driver_vehicle_px_experiences"."driver_id" is not null  
[2024-08-28 10:53:23] local.INFO: select sum("days") as aggregate from "driver_supply_px_experiences" where "driver_supply_px_experiences"."driver_id" is null and "driver_supply_px_experiences"."driver_id" is not null and exists (select * from "supplies" where "driver_supply_px_experiences"."supply_id" = "supplies"."id" and "name" != Nenhum)  
[2024-08-28 10:53:23] local.INFO: select exists(select * from "lead_campaign_results" where "lead_campaign_results"."driver_id" is null and "lead_campaign_results"."driver_id" is not null and "status" = campaign_canceled) as "exists"  
[2024-08-28 10:53:23] local.INFO: select * from "driver_histories" where "driver_histories"."id" is null limit 1  
[2024-08-28 10:53:23] local.INFO: select sum("days") as aggregate from "driver_vehicle_px_experiences" where "driver_vehicle_px_experiences"."driver_id" is null and "driver_vehicle_px_experiences"."driver_id" is not null  
[2024-08-28 10:53:23] local.INFO: select sum("days") as aggregate from "driver_vehicle_px_experiences" where "driver_vehicle_px_experiences"."driver_id" is null and "driver_vehicle_px_experiences"."driver_id" is not null  
[2024-08-28 10:53:23] local.INFO: select sum("days") as aggregate from "driver_supply_px_experiences" where "driver_supply_px_experiences"."driver_id" is null and "driver_supply_px_experiences"."driver_id" is not null and exists (select * from "supplies" where "driver_supply_px_experiences"."supply_id" = "supplies"."id" and "name" != Nenhum)  
[2024-08-28 10:53:23] local.INFO: select sum("days") as aggregate from "driver_supply_px_experiences" where "driver_supply_px_experiences"."driver_id" is null and "driver_supply_px_experiences"."driver_id" is not null and exists (select * from "supplies" where "driver_supply_px_experiences"."supply_id" = "supplies"."id" and "name" != Nenhum)  
[2024-08-28 10:53:23] local.INFO: select exists(select * from "lead_campaign_results" where "lead_campaign_results"."driver_id" is null and "lead_campaign_results"."driver_id" is not null and "status" = campaign_canceled) as "exists"  
[2024-08-28 10:53:23] local.INFO: select exists(select * from "lead_campaign_results" where "lead_campaign_results"."driver_id" is null and "lead_campaign_results"."driver_id" is not null and "status" = campaign_canceled) as "exists"  
[2024-08-28 10:53:23] local.INFO: select sum("days") as aggregate from "driver_vehicle_px_experiences" where "driver_vehicle_px_experiences"."driver_id" is null and "driver_vehicle_px_experiences"."driver_id" is not null  
[2024-08-28 10:53:23] local.INFO: select sum("days") as aggregate from "driver_vehicle_px_experiences" where "driver_vehicle_px_experiences"."driver_id" is null and "driver_vehicle_px_experiences"."driver_id" is not null  
[2024-08-28 10:53:23] local.INFO: select sum("days") as aggregate from "driver_supply_px_experiences" where "driver_supply_px_experiences"."driver_id" is null and "driver_supply_px_experiences"."driver_id" is not null and exists (select * from "supplies" where "driver_supply_px_experiences"."supply_id" = "supplies"."id" and "name" != Nenhum)  
[2024-08-28 10:53:23] local.INFO: select sum("days") as aggregate from "driver_supply_px_experiences" where "driver_supply_px_experiences"."driver_id" is null and "driver_supply_px_experiences"."driver_id" is not null and exists (select * from "supplies" where "driver_supply_px_experiences"."supply_id" = "supplies"."id" and "name" != Nenhum)  
[2024-08-28 10:53:23] local.INFO: select exists(select * from "lead_campaign_results" where "lead_campaign_results"."driver_id" is null and "lead_campaign_results"."driver_id" is not null and "status" = campaign_canceled) as "exists"  
[2024-08-28 10:53:23] local.INFO: select exists(select * from "lead_campaign_results" where "lead_campaign_results"."driver_id" is null and "lead_campaign_results"."driver_id" is not null and "status" = campaign_canceled) as "exists"  
[2024-08-28 10:53:23] local.INFO: select sum("days") as aggregate from "driver_vehicle_px_experiences" where "driver_vehicle_px_experiences"."driver_id" is null and "driver_vehicle_px_experiences"."driver_id" is not null  
[2024-08-28 10:53:23] local.INFO: select sum("days") as aggregate from "driver_supply_px_experiences" where "driver_supply_px_experiences"."driver_id" is null and "driver_supply_px_experiences"."driver_id" is not null and exists (select * from "supplies" where "driver_supply_px_experiences"."supply_id" = "supplies"."id" and "name" != Nenhum)  
[2024-08-28 10:53:23] local.INFO: select exists(select * from "lead_campaign_results" where "lead_campaign_results"."driver_id" is null and "lead_campaign_results"."driver_id" is not null and "status" = campaign_canceled) as "exists"  
[2024-08-28 10:53:23] local.INFO: select "roles".*, "role_user"."user_id" as "pivot_user_id", "role_user"."role_id" as "pivot_role_id" from "roles" inner join "role_user" on "roles"."id" = "role_user"."role_id" where "role_user"."user_id" = 1  
[2024-08-28 10:53:23] local.INFO: select * from "role_permission" where "role_permission"."role_id" in (3, 7)  
[2024-08-28 10:53:28] local.INFO: select * from "users" where "id" = 1 limit 1  
[2024-08-28 10:53:28] local.INFO: select * from "users" where "id" = 1  
[2024-08-28 10:53:28] local.INFO: select * from "role_user" where "role_user"."user_id" in (1)  
[2024-08-28 10:53:28] local.INFO: select * from "nova_notifications" where "notifiable_id" = 1 and "nova_notifications"."deleted_at" is null order by "created_at" desc limit 100  
[2024-08-28 10:53:28] local.INFO: select count(*) as aggregate from "nova_notifications" where "read_at" is null and "notifiable_id" = 1 and "nova_notifications"."deleted_at" is null  
[2024-08-28 10:53:32] local.INFO: select * from "users" where "id" = 1 limit 1  
[2024-08-28 10:53:32] local.INFO: select * from "users" where "id" = 1 limit 1  
[2024-08-28 10:53:32] local.INFO: select * from "users" where "id" = 1  
[2024-08-28 10:53:32] local.INFO: select * from "users" where "id" = 1  
[2024-08-28 10:53:32] local.INFO: select * from "users" where "id" = 1 limit 1  
[2024-08-28 10:53:32] local.INFO: select * from "role_user" where "role_user"."user_id" in (1)  
[2024-08-28 10:53:32] local.INFO: select * from "role_user" where "role_user"."user_id" in (1)  
[2024-08-28 10:53:32] local.INFO: select sum("days") as aggregate from "driver_vehicle_px_experiences" where "driver_vehicle_px_experiences"."driver_id" is null and "driver_vehicle_px_experiences"."driver_id" is not null  
[2024-08-28 10:53:32] local.INFO: select sum("days") as aggregate from "driver_supply_px_experiences" where "driver_supply_px_experiences"."driver_id" is null and "driver_supply_px_experiences"."driver_id" is not null and exists (select * from "supplies" where "driver_supply_px_experiences"."supply_id" = "supplies"."id" and "name" != Nenhum)  
[2024-08-28 10:53:32] local.INFO: select exists(select * from "lead_campaign_results" where "lead_campaign_results"."driver_id" is null and "lead_campaign_results"."driver_id" is not null and "status" = campaign_canceled) as "exists"  
[2024-08-28 10:53:32] local.INFO: select * from "lead_documents" where "lead_documents"."id" is null limit 1  
[2024-08-28 10:53:32] local.INFO: select * from "drivers" where "drivers"."id" = 463 limit 1  
[2024-08-28 10:53:32] local.INFO: select * from "users" where "id" = 1  
[2024-08-28 10:53:32] local.INFO: select * from "lead_documents" where "lead_documents"."driver_id" = 463 and "lead_documents"."driver_id" is not null order by "lead_documents"."id" desc limit 6 offset 0  
[2024-08-28 10:53:32] local.INFO: select * from "role_user" where "role_user"."user_id" in (1)  
[2024-08-28 10:53:32] local.INFO: select count(*) as aggregate from "lead_documents" where "lead_documents"."driver_id" = 463 and "lead_documents"."driver_id" is not null  
[2024-08-28 10:53:32] local.INFO: select * from "lead_documents" where "lead_documents"."id" is null limit 1  
[2024-08-28 10:53:32] local.INFO: select sum("days") as aggregate from "driver_vehicle_px_experiences" where "driver_vehicle_px_experiences"."driver_id" is null and "driver_vehicle_px_experiences"."driver_id" is not null  
[2024-08-28 10:53:32] local.INFO: select sum("days") as aggregate from "driver_supply_px_experiences" where "driver_supply_px_experiences"."driver_id" is null and "driver_supply_px_experiences"."driver_id" is not null and exists (select * from "supplies" where "driver_supply_px_experiences"."supply_id" = "supplies"."id" and "name" != Nenhum)  
[2024-08-28 10:53:32] local.INFO: select exists(select * from "lead_campaign_results" where "lead_campaign_results"."driver_id" is null and "lead_campaign_results"."driver_id" is not null and "status" = campaign_canceled) as "exists"  
[2024-08-28 10:53:32] local.INFO: select sum("days") as aggregate from "driver_vehicle_px_experiences" where "driver_vehicle_px_experiences"."driver_id" is null and "driver_vehicle_px_experiences"."driver_id" is not null  
[2024-08-28 10:53:32] local.INFO: select sum("days") as aggregate from "driver_supply_px_experiences" where "driver_supply_px_experiences"."driver_id" is null and "driver_supply_px_experiences"."driver_id" is not null and exists (select * from "supplies" where "driver_supply_px_experiences"."supply_id" = "supplies"."id" and "name" != Nenhum)  
[2024-08-28 10:53:32] local.INFO: select exists(select * from "lead_campaign_results" where "lead_campaign_results"."driver_id" is null and "lead_campaign_results"."driver_id" is not null and "status" = campaign_canceled) as "exists"  
[2024-08-28 10:53:34] local.INFO: select * from "users" where "id" = 1 limit 1  
[2024-08-28 10:53:34] local.INFO: select * from "users" where "id" = 1 limit 1  
[2024-08-28 10:53:34] local.INFO: select * from "users" where "id" = 1 limit 1  
[2024-08-28 10:53:34] local.INFO: select * from "users" where "id" = 1  
[2024-08-28 10:53:34] local.INFO: select * from "users" where "id" = 1  
[2024-08-28 10:53:34] local.INFO: select * from "role_user" where "role_user"."user_id" in (1)  
[2024-08-28 10:53:34] local.INFO: select * from "role_user" where "role_user"."user_id" in (1)  
[2024-08-28 10:53:34] local.INFO: select * from "users" where "id" = 1  
[2024-08-28 10:53:34] local.INFO: select * from "driver_vehicle_px_experiences" where "driver_vehicle_px_experiences"."id" is null limit 1  
[2024-08-28 10:53:34] local.INFO: select * from "driver_vehicle_px_experiences" where "driver_vehicle_px_experiences"."id" is null limit 1  
[2024-08-28 10:53:34] local.INFO: select sum("days") as aggregate from "driver_vehicle_px_experiences" where "driver_vehicle_px_experiences"."driver_id" is null and "driver_vehicle_px_experiences"."driver_id" is not null  
[2024-08-28 10:53:34] local.INFO: select * from "role_user" where "role_user"."user_id" in (1)  
[2024-08-28 10:53:34] local.INFO: select sum("days") as aggregate from "driver_supply_px_experiences" where "driver_supply_px_experiences"."driver_id" is null and "driver_supply_px_experiences"."driver_id" is not null and exists (select * from "supplies" where "driver_supply_px_experiences"."supply_id" = "supplies"."id" and "name" != Nenhum)  
[2024-08-28 10:53:34] local.INFO: select exists(select * from "lead_campaign_results" where "lead_campaign_results"."driver_id" is null and "lead_campaign_results"."driver_id" is not null and "status" = campaign_canceled) as "exists"  
[2024-08-28 10:53:34] local.INFO: select sum("days") as aggregate from "driver_vehicle_px_experiences" where "driver_vehicle_px_experiences"."driver_id" is null and "driver_vehicle_px_experiences"."driver_id" is not null  
[2024-08-28 10:53:34] local.INFO: select sum("days") as aggregate from "driver_supply_px_experiences" where "driver_supply_px_experiences"."driver_id" is null and "driver_supply_px_experiences"."driver_id" is not null and exists (select * from "supplies" where "driver_supply_px_experiences"."supply_id" = "supplies"."id" and "name" != Nenhum)  
[2024-08-28 10:53:34] local.INFO: select sum("days") as aggregate from "driver_vehicle_px_experiences" where "driver_vehicle_px_experiences"."driver_id" is null and "driver_vehicle_px_experiences"."driver_id" is not null  
[2024-08-28 10:53:34] local.INFO: select exists(select * from "lead_campaign_results" where "lead_campaign_results"."driver_id" is null and "lead_campaign_results"."driver_id" is not null and "status" = campaign_canceled) as "exists"  
[2024-08-28 10:53:34] local.INFO: select sum("days") as aggregate from "driver_supply_px_experiences" where "driver_supply_px_experiences"."driver_id" is null and "driver_supply_px_experiences"."driver_id" is not null and exists (select * from "supplies" where "driver_supply_px_experiences"."supply_id" = "supplies"."id" and "name" != Nenhum)  
[2024-08-28 10:53:34] local.INFO: select exists(select * from "lead_campaign_results" where "lead_campaign_results"."driver_id" is null and "lead_campaign_results"."driver_id" is not null and "status" = campaign_canceled) as "exists"  
[2024-08-28 10:53:34] local.INFO: select * from "drivers" where "drivers"."id" = 463 limit 1  
[2024-08-28 10:53:34] local.INFO: select * from "driver_vehicle_px_experiences" where "driver_vehicle_px_experiences"."driver_id" = 463 and "driver_vehicle_px_experiences"."driver_id" is not null order by "driver_vehicle_px_experiences"."id" desc limit 6 offset 0  
[2024-08-28 10:53:34] local.INFO: select count(*) as aggregate from "driver_vehicle_px_experiences" where "driver_vehicle_px_experiences"."driver_id" = 463 and "driver_vehicle_px_experiences"."driver_id" is not null  
[2024-08-28 10:53:35] local.INFO: select * from "users" where "id" = 1 limit 1  
[2024-08-28 10:53:35] local.INFO: select * from "users" where "id" = 1  
[2024-08-28 10:53:35] local.INFO: select * from "role_user" where "role_user"."user_id" in (1)  
[2024-08-28 10:53:35] local.INFO: select * from "nova_notifications" where "notifiable_id" = 1 and "nova_notifications"."deleted_at" is null order by "created_at" desc limit 100  
[2024-08-28 10:53:35] local.INFO: select count(*) as aggregate from "nova_notifications" where "read_at" is null and "notifiable_id" = 1 and "nova_notifications"."deleted_at" is null  
[2024-08-28 10:53:36] local.INFO: select * from "users" where "id" = 1 limit 1  
[2024-08-28 10:53:36] local.INFO: select * from "users" where "id" = 1 limit 1  
[2024-08-28 10:53:36] local.INFO: select * from "users" where "id" = 1  
[2024-08-28 10:53:36] local.INFO: select * from "users" where "id" = 1  
[2024-08-28 10:53:36] local.INFO: select * from "role_user" where "role_user"."user_id" in (1)  
[2024-08-28 10:53:36] local.INFO: select * from "role_user" where "role_user"."user_id" in (1)  
[2024-08-28 10:53:36] local.INFO: select * from "driver_supply_px_experiences" where "driver_supply_px_experiences"."id" is null limit 1  
[2024-08-28 10:53:36] local.INFO: select sum("days") as aggregate from "driver_vehicle_px_experiences" where "driver_vehicle_px_experiences"."driver_id" is null and "driver_vehicle_px_experiences"."driver_id" is not null  
[2024-08-28 10:53:36] local.INFO: select sum("days") as aggregate from "driver_vehicle_px_experiences" where "driver_vehicle_px_experiences"."driver_id" is null and "driver_vehicle_px_experiences"."driver_id" is not null  
[2024-08-28 10:53:36] local.INFO: select sum("days") as aggregate from "driver_supply_px_experiences" where "driver_supply_px_experiences"."driver_id" is null and "driver_supply_px_experiences"."driver_id" is not null and exists (select * from "supplies" where "driver_supply_px_experiences"."supply_id" = "supplies"."id" and "name" != Nenhum)  
[2024-08-28 10:53:36] local.INFO: select sum("days") as aggregate from "driver_supply_px_experiences" where "driver_supply_px_experiences"."driver_id" is null and "driver_supply_px_experiences"."driver_id" is not null and exists (select * from "supplies" where "driver_supply_px_experiences"."supply_id" = "supplies"."id" and "name" != Nenhum)  
[2024-08-28 10:53:36] local.INFO: select exists(select * from "lead_campaign_results" where "lead_campaign_results"."driver_id" is null and "lead_campaign_results"."driver_id" is not null and "status" = campaign_canceled) as "exists"  
[2024-08-28 10:53:36] local.INFO: select exists(select * from "lead_campaign_results" where "lead_campaign_results"."driver_id" is null and "lead_campaign_results"."driver_id" is not null and "status" = campaign_canceled) as "exists"  
[2024-08-28 10:53:36] local.INFO: select sum("days") as aggregate from "driver_vehicle_px_experiences" where "driver_vehicle_px_experiences"."driver_id" is null and "driver_vehicle_px_experiences"."driver_id" is not null  
[2024-08-28 10:53:36] local.INFO: select sum("days") as aggregate from "driver_supply_px_experiences" where "driver_supply_px_experiences"."driver_id" is null and "driver_supply_px_experiences"."driver_id" is not null and exists (select * from "supplies" where "driver_supply_px_experiences"."supply_id" = "supplies"."id" and "name" != Nenhum)  
[2024-08-28 10:53:36] local.INFO: select * from "users" where "id" = 1 limit 1  
[2024-08-28 10:53:36] local.INFO: select exists(select * from "lead_campaign_results" where "lead_campaign_results"."driver_id" is null and "lead_campaign_results"."driver_id" is not null and "status" = campaign_canceled) as "exists"  
[2024-08-28 10:53:36] local.INFO: select * from "drivers" where "drivers"."id" = 463 limit 1  
[2024-08-28 10:53:36] local.INFO: select * from "driver_supply_px_experiences" where "driver_supply_px_experiences"."driver_id" = 463 and "driver_supply_px_experiences"."driver_id" is not null and exists (select * from "supplies" where "driver_supply_px_experiences"."supply_id" = "supplies"."id" and "name" != Nenhum) order by "driver_supply_px_experiences"."id" desc limit 6 offset 0  
[2024-08-28 10:53:36] local.INFO: select count(*) as aggregate from "driver_supply_px_experiences" where "driver_supply_px_experiences"."driver_id" = 463 and "driver_supply_px_experiences"."driver_id" is not null and exists (select * from "supplies" where "driver_supply_px_experiences"."supply_id" = "supplies"."id" and "name" != Nenhum)  
[2024-08-28 10:53:36] local.INFO: select * from "users" where "id" = 1  
[2024-08-28 10:53:36] local.INFO: select * from "role_user" where "role_user"."user_id" in (1)  
[2024-08-28 10:53:36] local.INFO: select * from "driver_supply_px_experiences" where "driver_supply_px_experiences"."id" is null limit 1  
[2024-08-28 10:53:38] local.INFO: select * from "users" where "id" = 1 limit 1  
[2024-08-28 10:53:38] local.INFO: select * from "users" where "id" = 1 limit 1  
[2024-08-28 10:53:38] local.INFO: select * from "users" where "id" = 1  
[2024-08-28 10:53:38] local.INFO: select * from "role_user" where "role_user"."user_id" in (1)  
[2024-08-28 10:53:38] local.INFO: select * from "users" where "id" = 1  
[2024-08-28 10:53:38] local.INFO: select * from "role_user" where "role_user"."user_id" in (1)  
[2024-08-28 10:53:38] local.INFO: select * from "driver_experiences" where "driver_experiences"."id" is null limit 1  
[2024-08-28 10:53:38] local.INFO: select * from "drivers" where "drivers"."id" = 463 limit 1  
[2024-08-28 10:53:38] local.INFO: select * from "users" where "id" = 1 limit 1  
[2024-08-28 10:53:38] local.INFO: select * from "users" where "id" = 1  
[2024-08-28 10:53:38] local.INFO: select * from "role_user" where "role_user"."user_id" in (1)  
[2024-08-28 10:53:38] local.INFO: select sum("days") as aggregate from "driver_vehicle_px_experiences" where "driver_vehicle_px_experiences"."driver_id" is null and "driver_vehicle_px_experiences"."driver_id" is not null  
[2024-08-28 10:53:38] local.INFO: select sum("days") as aggregate from "driver_supply_px_experiences" where "driver_supply_px_experiences"."driver_id" is null and "driver_supply_px_experiences"."driver_id" is not null and exists (select * from "supplies" where "driver_supply_px_experiences"."supply_id" = "supplies"."id" and "name" != Nenhum)  
[2024-08-28 10:53:38] local.INFO: select exists(select * from "lead_campaign_results" where "lead_campaign_results"."driver_id" is null and "lead_campaign_results"."driver_id" is not null and "status" = campaign_canceled) as "exists"  
[2024-08-28 10:53:38] local.INFO: select * from "drivers" where "drivers"."id" = 463 limit 1  
[2024-08-28 10:53:38] local.INFO: select sum("days") as aggregate from "driver_vehicle_px_experiences" where "driver_vehicle_px_experiences"."driver_id" is null and "driver_vehicle_px_experiences"."driver_id" is not null  
[2024-08-28 10:53:38] local.INFO: select sum("days") as aggregate from "driver_supply_px_experiences" where "driver_supply_px_experiences"."driver_id" is null and "driver_supply_px_experiences"."driver_id" is not null and exists (select * from "supplies" where "driver_supply_px_experiences"."supply_id" = "supplies"."id" and "name" != Nenhum)  
[2024-08-28 10:53:38] local.INFO: select exists(select * from "lead_campaign_results" where "lead_campaign_results"."driver_id" is null and "lead_campaign_results"."driver_id" is not null and "status" = campaign_canceled) as "exists"  
[2024-08-28 10:53:38] local.INFO: select * from "driver_experiences" where "driver_experiences"."driver_id" = 463 and "driver_experiences"."driver_id" is not null order by "driver_experiences"."id" desc limit 6 offset 0  
[2024-08-28 10:53:38] local.INFO: select count(*) as aggregate from "driver_experiences" where "driver_experiences"."driver_id" = 463 and "driver_experiences"."driver_id" is not null  
[2024-08-28 10:53:38] local.INFO: select * from "users" where "id" = 1 limit 1  
[2024-08-28 10:53:38] local.INFO: select * from "users" where "id" = 1  
[2024-08-28 10:53:38] local.INFO: select * from "role_user" where "role_user"."user_id" in (1)  
[2024-08-28 10:53:38] local.INFO: select * from "driver_experiences" where "driver_experiences"."id" is null limit 1  
[2024-08-28 10:53:38] local.INFO: select sum("days") as aggregate from "driver_vehicle_px_experiences" where "driver_vehicle_px_experiences"."driver_id" is null and "driver_vehicle_px_experiences"."driver_id" is not null  
[2024-08-28 10:53:38] local.INFO: select sum("days") as aggregate from "driver_supply_px_experiences" where "driver_supply_px_experiences"."driver_id" is null and "driver_supply_px_experiences"."driver_id" is not null and exists (select * from "supplies" where "driver_supply_px_experiences"."supply_id" = "supplies"."id" and "name" != Nenhum)  
[2024-08-28 10:53:38] local.INFO: select exists(select * from "lead_campaign_results" where "lead_campaign_results"."driver_id" is null and "lead_campaign_results"."driver_id" is not null and "status" = campaign_canceled) as "exists"  
[2024-08-28 10:53:38] local.INFO: select sum("days") as aggregate from "driver_vehicle_px_experiences" where "driver_vehicle_px_experiences"."driver_id" is null and "driver_vehicle_px_experiences"."driver_id" is not null  
[2024-08-28 10:53:38] local.INFO: select sum("days") as aggregate from "driver_supply_px_experiences" where "driver_supply_px_experiences"."driver_id" is null and "driver_supply_px_experiences"."driver_id" is not null and exists (select * from "supplies" where "driver_supply_px_experiences"."supply_id" = "supplies"."id" and "name" != Nenhum)  
[2024-08-28 10:53:38] local.INFO: select exists(select * from "lead_campaign_results" where "lead_campaign_results"."driver_id" is null and "lead_campaign_results"."driver_id" is not null and "status" = campaign_canceled) as "exists"  
[2024-08-28 10:53:42] local.INFO: select * from "users" where "id" = 1 limit 1  
[2024-08-28 10:53:42] local.INFO: select * from "users" where "id" = 1  
[2024-08-28 10:53:42] local.INFO: select * from "role_user" where "role_user"."user_id" in (1)  
[2024-08-28 10:53:42] local.INFO: select * from "nova_notifications" where "notifiable_id" = 1 and "nova_notifications"."deleted_at" is null order by "created_at" desc limit 100  
[2024-08-28 10:53:42] local.INFO: select count(*) as aggregate from "nova_notifications" where "read_at" is null and "notifiable_id" = 1 and "nova_notifications"."deleted_at" is null  
[2024-08-28 10:53:49] local.INFO: select * from "users" where "id" = 1 limit 1  
[2024-08-28 10:53:49] local.INFO: select * from "users" where "id" = 1  
[2024-08-28 10:53:49] local.INFO: select * from "role_user" where "role_user"."user_id" in (1)  
[2024-08-28 10:53:49] local.INFO: select * from "nova_notifications" where "notifiable_id" = 1 and "nova_notifications"."deleted_at" is null order by "created_at" desc limit 100  
[2024-08-28 10:53:49] local.INFO: select count(*) as aggregate from "nova_notifications" where "read_at" is null and "notifiable_id" = 1 and "nova_notifications"."deleted_at" is null  
[2024-08-28 10:53:50] local.INFO: select * from "users" where "id" = 1 limit 1  
[2024-08-28 10:53:50] local.INFO: select * from "users" where "id" = 1  
[2024-08-28 10:53:50] local.INFO: select * from "role_user" where "role_user"."user_id" in (1)  
[2024-08-28 10:53:50] local.INFO: select sum("days") as aggregate from "driver_vehicle_px_experiences" where "driver_vehicle_px_experiences"."driver_id" is null and "driver_vehicle_px_experiences"."driver_id" is not null  
[2024-08-28 10:53:50] local.INFO: select * from "users" where "id" = 1 limit 1  
[2024-08-28 10:53:50] local.INFO: select sum("days") as aggregate from "driver_supply_px_experiences" where "driver_supply_px_experiences"."driver_id" is null and "driver_supply_px_experiences"."driver_id" is not null and exists (select * from "supplies" where "driver_supply_px_experiences"."supply_id" = "supplies"."id" and "name" != Nenhum)  
[2024-08-28 10:53:50] local.INFO: select * from "users" where "id" = 1 limit 1  
[2024-08-28 10:53:50] local.INFO: select exists(select * from "lead_campaign_results" where "lead_campaign_results"."driver_id" is null and "lead_campaign_results"."driver_id" is not null and "status" = campaign_canceled) as "exists"  
[2024-08-28 10:53:50] local.INFO: select * from "drivers" where "drivers"."id" = 463 limit 1  
[2024-08-28 10:53:50] local.INFO: select * from "users" where "id" = 1  
[2024-08-28 10:53:50] local.INFO: select * from "users" where "id" = 1  
[2024-08-28 10:53:50] local.INFO: select * from "risk_manager_researches" where "risk_manager_researches"."driver_id" = 463 and "risk_manager_researches"."driver_id" is not null order by "risk_manager_researches"."id" desc limit 6 offset 0  
[2024-08-28 10:53:50] local.INFO: select * from "role_user" where "role_user"."user_id" in (1)  
[2024-08-28 10:53:50] local.INFO: select count(*) as aggregate from "risk_manager_researches" where "risk_manager_researches"."driver_id" = 463 and "risk_manager_researches"."driver_id" is not null  
[2024-08-28 10:53:50] local.INFO: select * from "role_user" where "role_user"."user_id" in (1)  
[2024-08-28 10:53:50] local.INFO: select * from "risk_manager_researches" where "risk_manager_researches"."id" is null limit 1  
[2024-08-28 10:53:50] local.INFO: select * from "risk_manager_researches" where "risk_manager_researches"."id" is null limit 1  
[2024-08-28 10:53:50] local.INFO: select sum("days") as aggregate from "driver_vehicle_px_experiences" where "driver_vehicle_px_experiences"."driver_id" is null and "driver_vehicle_px_experiences"."driver_id" is not null  
[2024-08-28 10:53:50] local.INFO: select sum("days") as aggregate from "driver_supply_px_experiences" where "driver_supply_px_experiences"."driver_id" is null and "driver_supply_px_experiences"."driver_id" is not null and exists (select * from "supplies" where "driver_supply_px_experiences"."supply_id" = "supplies"."id" and "name" != Nenhum)  
[2024-08-28 10:53:50] local.INFO: select exists(select * from "lead_campaign_results" where "lead_campaign_results"."driver_id" is null and "lead_campaign_results"."driver_id" is not null and "status" = campaign_canceled) as "exists"  
[2024-08-28 10:53:50] local.INFO: select sum("days") as aggregate from "driver_vehicle_px_experiences" where "driver_vehicle_px_experiences"."driver_id" is null and "driver_vehicle_px_experiences"."driver_id" is not null  
[2024-08-28 10:53:50] local.INFO: select sum("days") as aggregate from "driver_supply_px_experiences" where "driver_supply_px_experiences"."driver_id" is null and "driver_supply_px_experiences"."driver_id" is not null and exists (select * from "supplies" where "driver_supply_px_experiences"."supply_id" = "supplies"."id" and "name" != Nenhum)  
[2024-08-28 10:53:50] local.INFO: select exists(select * from "lead_campaign_results" where "lead_campaign_results"."driver_id" is null and "lead_campaign_results"."driver_id" is not null and "status" = campaign_canceled) as "exists"  
[2024-08-28 10:53:56] local.INFO: select * from "users" where "id" = 1 limit 1  
[2024-08-28 10:53:56] local.INFO: select * from "users" where "id" = 1  
[2024-08-28 10:53:56] local.INFO: select * from "role_user" where "role_user"."user_id" in (1)  
[2024-08-28 10:53:56] local.INFO: select * from "nova_notifications" where "notifiable_id" = 1 and "nova_notifications"."deleted_at" is null order by "created_at" desc limit 100  
[2024-08-28 10:53:56] local.INFO: select count(*) as aggregate from "nova_notifications" where "read_at" is null and "notifiable_id" = 1 and "nova_notifications"."deleted_at" is null  
[2024-08-28 10:54:03] local.INFO: select * from "users" where "id" = 1 limit 1  
[2024-08-28 10:54:03] local.INFO: select * from "users" where "id" = 1  
[2024-08-28 10:54:03] local.INFO: select * from "role_user" where "role_user"."user_id" in (1)  
[2024-08-28 10:54:03] local.INFO: select * from "nova_notifications" where "notifiable_id" = 1 and "nova_notifications"."deleted_at" is null order by "created_at" desc limit 100  
[2024-08-28 10:54:03] local.INFO: select count(*) as aggregate from "nova_notifications" where "read_at" is null and "notifiable_id" = 1 and "nova_notifications"."deleted_at" is null  
with motoristas as (
SELECT id as driver_id,
created_at,
qualified_at
FROM drivers
where status not in ( 0, 1, 2, 3, 6, 7, 8 )
and service_supplier = 0
),
candidaturas as (
select driver_id,
count(*) as candidaturas
from driver_freight_history dfh
group by dfh.driver_id
),
visitas as (
select driver_id,
sum(count_visit) as visitas
from driver_freight_history dfh
group by dfh.driver_id
),
nao_comparecimento AS (
select driver_behavior_occurrence.driver_id, 
count(*) as nao_comparecimento
FROM driver_behavior_occurrence_types
join driver_behavior_occurrence on driver_behavior_occurrence.id = driver_behavior_occurrence_types.driver_behavior_occurrence_id
where driver_behavior_occurrence_type_id in (9,23)
group by driver_behavior_occurrence.driver_id
),
cursos_contagem as (
SELECT driver_id, count( distinct driver_courses.course_id ) as contagem
FROM driver_courses
join courses on courses.id = driver_courses.course_id
where driver_courses.expired_at > now( )
and (courses.type is null or courses.type not in ('toxicological'))
and driver_courses.status in ('approved', 'expired')
group by driver_id
),
toxicologico as (
select dc.driver_id,
GREATEST(0, extract( epoch from justify_interval( (dc.issued_at + interval '1 year') - now( ) ) ) / 2.628e+6) as toxicologico
from driver_courses dc
join courses on courses.id = dc.course_id
and courses.type = 'toxicological'
and dc.status in ('approved', 'expired')
and dc.issued_at is not null
),
dias_agenciados as (
SELECT f.driver_id, SUM( kc.days ) AS dias_agenciados
FROM freights f
left join kpi_contracts kc on kc.freight_id = f.id
WHERE f.status = 300
GROUP BY f.driver_id
),
empresas_CLT_duracao as (
select driver_id, count(distinct month_worked) duracao from (
select distinct driver_id, generate_series(date_trunc( 'month' , started_date_at ), date_trunc( 'month' , finalized_date_at ), '1 month') as month_worked
from driver_experiences
where started_date_at is not null
and finalized_date_at is not null
and finalized_date_at < now( )
and started_date_at < now( )
and started_date_at < finalized_date_at
and started_date_at > now( ) - interval '70 years'
and finalized_date_at > now( ) - interval '70 years'
group by driver_id, date_trunc( 'month' , started_date_at ), date_trunc( 'month' , finalized_date_at )
) pre_px_experiences
group by driver_id
),
ultima_viagem as (
select
driver_id,
greatest(EXTRACT( EPOCH FROM (NOW( ) - MAX( end_at )) / 86400 )::FLOAT, 0) as ultima_viagem
from freights f
where f.status between 220 and 300
group by driver_id
),
nivel_px as ( 
select 
driver_id,
"group" as grupo,
tier as tier
from driver_scores ds 
),
multas as (
select
o.driver_id, 
sum(ds.value) / 100.0 as multas
from occurrences o
left join discounts d on d.occurrence_id = o.id and d.driver_id = o.driver_id 
left join discount_statements ds on ds.discount_id=d.id
where ds.status in (4, 6, 1) -- pago ou atrasado pendente  where ds.status in (4, -6,-1)
and o.type = 5
group by o.driver_id
)
select motoristas.driver_id,
nivel_px.grupo as grupo,
nivel_px.tier as tier,
candidaturas.candidaturas as candidaturas,
visitas.visitas as visitas,
coalesce(nao_comparecimento.nao_comparecimento,0) as nao_comparecimento,
coalesce(toxicologico.toxicologico,0) as toxicologico,
dias_agenciados.dias_agenciados as dias_agenciados,
empresas_CLT_duracao.duracao as empresas_CLT_duracao,
ultima_viagem.ultima_viagem as ultima_viagem,
multas.multas as multas
from motoristas
left join nivel_px on nivel_px.driver_id = motoristas.driver_id
left join candidaturas on candidaturas.driver_id = motoristas.driver_id
left join visitas on visitas.driver_id = motoristas.driver_id
left join nao_comparecimento on nao_comparecimento.driver_id = motoristas.driver_id
left join toxicologico on toxicologico.driver_id = motoristas.driver_id
left join dias_agenciados on dias_agenciados.driver_id = motoristas.driver_id
left join empresas_CLT_duracao on empresas_CLT_duracao.driver_id = motoristas.driver_id
left join ultima_viagem on ultima_viagem.driver_id = motoristas.driver_id
left join multas on multas.driver_id = motoristas.driver_id
where grupo is not null












with notas as (
select 
dr.id,
dr.updated_at,
dr.rating,
f.contract_days,
f.id as contract_id,
dr.driver_id,
coalesce( dr.rating * f.contract_days, 0) as rating_weight
from driver_ratings dr 
left join freights f on f.id = dr.freight_id and f.driver_id = dr.driver_id
where f.updated_at >= CURRENT_DATE - INTERVAL '1 year'
and contract_days > 0
),
nova_nota as (
select 
driver_id,
sum(rating_weight) / sum(contract_days) as rating_weight
from notas
group by driver_id
) 
select
driver_id,
nn.rating_weight,
d.rating  from nova_nota nn
left join drivers d on d.id = nn.driver_id SELECT DISTINCT ON (driver_id) dr.updated_at, dr.driver_id, dr.rating, drivers_situation_enum(situation_enum)
FROM driver_ratings dr
left join drivers d on d.id = dr.driver_id
ORDER BY driver_id, updated_at desc
with reembolso as (
select 
r.id,
r.updated_at,
r.freight_id as contract_id,
r.amount /100 as value,
coalesce (r.reason, '') as reason,
coalesce (r.reason_description, '') as reason_description,
r.type as type,
coalesce (r.description, '') as description
from reimbursements r
where r.status = 2
),
contract as (
select
f.id as contract_id,
f.company_id as company_id,
f.contract_days as contract_days,
f.price/100 as price,
f.day_of_week as contract_day_of_week,
d.id as driver_id,
d.name as driver_name,
d.service_supplier as service_supplier,
c.name as company_name
from freights f
left join companies c on c.id = f.company_id
left join drivers d on d.id = f.driver_id 
)
select * from reembolso r
left join contract c on c.contract_id = r.contract_id
-- where updated_at > '2024-08-01'


SELECT
  table_schema,
  table_name,
  string_agg(
    column_name
    || ' ' || data_type
    || COALESCE('('||character_maximum_length||')','')
    || CASE WHEN is_nullable = 'NO' THEN ' NOT NULL' ELSE '' END,
    ', ' ORDER BY ordinal_position
  ) AS columns_summary
FROM information_schema.columns
WHERE table_schema NOT IN ('information_schema','pg_catalog')
GROUP BY table_schema, table_name
ORDER BY table_schema, table_name;

BEGIN
DECLARE driver_score_id INTEGER;
IF EXISTS (SELECT 1 FROM driver_scores WHERE driver_id = 34034) THEN
    UPDATE driver_scores SET updated_at=CURRENT_TIMESTAMP,normalized_score = 100000, "group" = 'top_tier' WHERE driver_id = 34034;
    RETURNING id INTO driver_score_id
ELSE    
    INSERT INTO driver_scores (created_at, updated_at, driver_id, normalized_score, "group") VALUES (CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, 34034, 100000, 'top_tier');
    RETURNING id INTO driver_score_id
END IF;
INSERT INTO driver_score_compositions (created_at, updated_at, score_id, normalized_score, "group", parameters) VALUES (CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, driver_score_id, 96819, 'top_tier')
COMMIT
/* 
Motoristas
*/
with motoristas as (
SELECT id as driver_id,
created_at,
qualified_at
FROM drivers
where status not in ( 0, 1, 2, 3, 6, 7, 8 )
and service_supplier = 0
),
/* 
Viagens
*/
viagens_contagem as (
select driver_id,
count( * ) as contagem
from freights
where status = 300
group by driver_id
),
/* 
Não comparecimento contagem
*/
nao_comparecimento_contagem as (
WITH RECURSIVE recursive_balance AS (
WITH dias AS (
select driver_id, 
freight_id, 
min("when") as created_at,
sum(kc.days) as dias
from kpi_contracts kc
group by driver_id, freight_id
),
nao_comparecimento AS (
select driver_behavior_occurrence.driver_id, 
driver_behavior_occurrence.id as driver_behavior_occurrence_id,
driver_behavior_occurrence.created_at as created_at,
-74 as days
FROM driver_behavior_occurrence_types
join driver_behavior_occurrence on driver_behavior_occurrence.id = driver_behavior_occurrence_types.driver_behavior_occurrence_id
where driver_behavior_occurrence_type_id in (9,23)
and not exists 
(select 1 from driver_behavior_occurrence_update dbou
join driver_behavior_occurrence_updates dbou3  on dbou3.driver_behavior_occurrence_update_id = dbou.id
where status = 9
and dbou3.driver_behavior_occurrence_id = driver_behavior_occurrence.id)
group by driver_behavior_occurrence.id
),
combined AS (
SELECT created_at, 'dias' as type, driver_id, dias FROM dias
UNION ALL
SELECT created_at, 'no-show' as type, driver_id, days AS dias FROM nao_comparecimento
),
sorted AS (
SELECT
created_at,
driver_id,
dias,
type,
ROW_NUMBER() OVER (PARTITION BY driver_id ORDER BY created_at) AS rn
FROM combined
)
SELECT
created_at,
driver_id,
dias,
CASE
when type = 'dias' then 0
WHEN dias < 0 THEN dias
ELSE 0
END AS saldo,
rn
FROM sorted
WHERE rn = 1
UNION ALL
SELECT
s.created_at,
s.driver_id,
s.dias,
CASE
when s.type = 'dias' and rb.saldo = 0 then 0
WHEN s.dias < 0 THEN LEAST(s.dias, rb.saldo + s.dias)
ELSE LEAST(0, rb.saldo + s.dias)
END AS saldo,
s.rn
FROM sorted s
JOIN recursive_balance rb ON s.driver_id = rb.driver_id AND s.rn = rb.rn + 1
),
extrato_completo_nao_comparecimento as (
SELECT created_at, driver_id, dias, saldo
FROM recursive_balance
ORDER BY driver_id, created_at
)
select driver_id, (-1)*saldo / 74 as contagem from extrato_completo_nao_comparecimento
WHERE (driver_id, created_at) IN (SELECT driver_id, MAX(created_at) FROM extrato_completo_nao_comparecimento GROUP BY driver_id)
and saldo <> 0
order by driver_id, created_at
),
/* 
Cursos contagem de realizados que não expiraram
*/
cursos_contagem as (
SELECT driver_id, count( distinct driver_courses.course_id ) as contagem
FROM driver_courses
join courses on courses.id = driver_courses.course_id
where driver_courses.expired_at > now( )
and (courses.type is null or courses.type not in ('toxicological'))
and driver_courses.status in ('approved', 'expired')
group by driver_id
),
/* 
Ocorrencias comportamentais contagem
*/
ocorrencias_comportamentais_contagem as (
WITH RECURSIVE recursive_balance AS (
WITH dias AS (
select driver_id, 
freight_id, 
min("when") as created_at,
sum(kc.days) as dias
from kpi_contracts kc
group by driver_id, freight_id
),
ocorrencia_comportamental AS (
select driver_behavior_occurrence.driver_id, 
driver_behavior_occurrence.id as driver_behavior_occurrence_id,
driver_behavior_occurrence.created_at as created_at,
-107 as days
FROM driver_behavior_occurrence_types
join driver_behavior_occurrence on driver_behavior_occurrence.id = driver_behavior_occurrence_types.driver_behavior_occurrence_id
where driver_behavior_occurrence_type_id not in (9,23, 24)
and not exists 
(select 1 from driver_behavior_occurrence_update dbou
join driver_behavior_occurrence_updates dbou3  on dbou3.driver_behavior_occurrence_update_id = dbou.id
where status = 9
and dbou3.driver_behavior_occurrence_id = driver_behavior_occurrence.id)
group by driver_behavior_occurrence.id
),
combined AS (
SELECT created_at, 'dias' as type, driver_id, dias FROM dias
UNION ALL
SELECT created_at, 'no-show' as type, driver_id, days AS dias FROM ocorrencia_comportamental
),
sorted AS (
SELECT
created_at,
driver_id,
dias,
type,
ROW_NUMBER() OVER (PARTITION BY driver_id ORDER BY created_at) AS rn
FROM combined
)
SELECT
created_at,
driver_id,
dias,
CASE
when type = 'dias' then 0
WHEN dias < 0 THEN dias
ELSE 0
END AS saldo,
rn
FROM sorted
WHERE rn = 1
UNION ALL
SELECT
s.created_at,
s.driver_id,
s.dias,
CASE
when s.type = 'dias' and rb.saldo = 0 then 0
WHEN s.dias < 0 THEN LEAST(s.dias, rb.saldo + s.dias)
ELSE LEAST(0, rb.saldo + s.dias)
END AS saldo,
s.rn
FROM sorted s
JOIN recursive_balance rb ON s.driver_id = rb.driver_id AND s.rn = rb.rn + 1
),
extrato_ocorrencia_comportamental as (
SELECT created_at, driver_id, dias, saldo
FROM recursive_balance
ORDER BY driver_id, created_at
)
select driver_id, (-1)*saldo / 107 as contagem from extrato_ocorrencia_comportamental
WHERE (driver_id, created_at) IN (SELECT driver_id, MAX(created_at) FROM extrato_ocorrencia_comportamental GROUP BY driver_id)
and saldo <> 0
order by driver_id, created_at
),
/* Penalidade divida */
penalidade_divida as (
with valor_total as( 
select ds.due_at ,
ds.paid_at,
o.driver_id,
o.contract_id,
o.negotiated_price, 
ds.status, 
ds.value / 100.0 as value,
o.type = 5 as multa
from occurrences o
left join discounts d on d.occurrence_id = o.id and d.driver_id = o.driver_id 
left join discount_statements ds on ds.discount_id=d.id
where ds.status in (4, 6, 1) -- pago ou atrasado pendente  where ds.status in (4, -6,-1)
order by o.id, ds.id asc
),
valor_total_resumido as (
select 
driver_id,
coalesce (sum(value) filter (where status = 1),0) as pendente,
coalesce (sum(value) filter (where status = 6),0) as atrasados,
nullif(coalesce (sum(value) filter (where status = 4),0),0) as pago,
sum(value) as total,
multa
from valor_total
group by driver_id, multa
having coalesce (sum(value) filter (where status = 6),0) > 0
)
select *,
total * (1-coalesce(pago/((power(atrasados,2)/pago) + pago),0))  as penalidade
from valor_total_resumido
),
/* 
Motorista está ou não rodando
*/
rodando as (
select id as driver_id,
1 as rodando
from drivers
where situation_enum = 1
),
/* 
Tempo restante para o toxicológico experirar
*/
toxicologico as (
select dc.driver_id,
GREATEST(0, extract( epoch from justify_interval( (dc.issued_at + interval '1 year') - now( ) ) ) / 2.628e+6) as tempo_decorrido
from driver_courses dc
join courses on courses.id = dc.course_id
and courses.type = 'toxicological'
and dc.status in ('approved', 'expired')
and dc.issued_at is not null
),
/* 
Sinistros em valor que foram pagos e não foram pagos
*/
pagamentos as (
select d.id driver_id,
coalesce(sum( o.total_price::float / 100) filter ( where di.status <> 'paid' ), 0) as valor_pendente
from drivers d
join discounts di on d.id = di.driver_id and di.status <> 'rejected'
join occurrences o on di.occurrence_id = o.id
group by d.id
),
/* 
Contagem de adiantamentos indevidos
*/
adiantamentos_indevidos as (
select driver_id, count( * ) as contagem
from discounts
where type = 4
and status not in ('rejected')
group by driver_id
),
/* 
Dias agenciados contagem
*/
quantidade_dias_agenciados as (
SELECT f.driver_id, SUM( kc.days ) AS contagem
FROM freights f
left join kpi_contracts kc on kc.freight_id = f.id
WHERE f.status = 300
GROUP BY f.driver_id
),
/* 
Meses que o motorista está na px desde qualificação
*/
meses_contagem as (
SELECT driver_id,
EXTRACT( MONTH FROM AGE( NOW( ) , qualified_at ) ) + EXTRACT( YEAR FROM AGE( NOW( ) , qualified_at ) ) * 12 AS meses_desde_criacao
FROM motoristas
),
/* 
Expepriencia CLT em meses
*/
empresas_CLT_duracao as (
select driver_id, count(distinct month_worked) duracao from (
select distinct driver_id, generate_series(date_trunc( 'month' , started_date_at ), date_trunc( 'month' , finalized_date_at ), '1 month') as month_worked
from driver_experiences
where started_date_at is not null
and finalized_date_at is not null
and finalized_date_at < now( )
and started_date_at < now( )
and started_date_at < finalized_date_at
and started_date_at > now( ) - interval '70 years'
and finalized_date_at > now( ) - interval '70 years'
group by driver_id, date_trunc( 'month' , started_date_at ), date_trunc( 'month' , finalized_date_at )
) pre_px_experiences
group by driver_id
),
/* 
Habitualidade
*/
habitualidade as (
select driver_id, sum(score) as score
from habituality_scores habituality_scores
group by driver_id
),
/* 
Ultima viagem
*/
ultima_viagem as (
select
driver_id,
greatest(EXTRACT( EPOCH FROM (NOW( ) - MAX( end_at )) / 86400 )::FLOAT, 0) as ultima_viagem
from freights f
where f.status between 220 and 300
group by driver_id
),
/* 
Valor total em viagens
*/
valor_viagem_total as (
select driver_id,
sum( price / 100.0 )
from freights f
where f.status = 300
group by driver_id
),
/*
Contagem de contratos
*/
contratos_contagem as (
SELECT f.driver_id, count( kc.days ) AS contagem
FROM freights f
left join kpi_contracts kc on kc.freight_id = f.id
left join drivers on drivers.id = f.driver_id
WHERE f.status = 300
GROUP BY f.driver_id
),
/* 
Resultado
*/
resultado as (
select motoristas.driver_id,
viagens_contagem.contagem as viagens_contagem,
coalesce(nao_comparecimento_contagem.contagem, 0) as nao_comparecimento_contagem,
coalesce(multa_valor.penalidade, 0) as multa_penalidade,
coalesce(cursos_contagem.contagem, 0) as cursos_contagem,
coalesce(ocorrencias_comportamentais_contagem.contagem, 0) as ocorrencias_comportamentais_contagem,
coalesce(sinistro_contagem.penalidade, 0) as sinistro_penalidade,
coalesce(toxicologico.tempo_decorrido, 0) as toxicologico,
coalesce(pagamentos.valor_pendente, 0) as pagamentos_valor_pendente,
coalesce(adiantamentos_indevidos.contagem, 0) as adiantamentos_indevidos_contagem,
coalesce(quantidade_dias_agenciados.contagem, 0) as quantidade_dias_agenciados,
coalesce(meses_contagem.meses_desde_criacao, 0) as meses_contagem,
coalesce(quantidade_dias_agenciados.contagem::FLOAT / NULLIF( meses_contagem.meses_desde_criacao::FLOAT , 0 ), 0) as recorrência,
coalesce(empresas_CLT_duracao.duracao, 0) as empresas_CLT_duracao,
coalesce(habitualidade.score, 0) as habitualidade,
coalesce(ultima_viagem.ultima_viagem, 0)::FLOAT as ultima_viagem,
coalesce(valor_viagem_total.sum, 0) as valor_viagem_total,
coalesce(rodando.rodando, 0) as rodando,
coalesce(contratos_contagem.contagem,0) as contratos_contagem
from motoristas
left join viagens_contagem on viagens_contagem.driver_id = motoristas.driver_id
left join nao_comparecimento_contagem on nao_comparecimento_contagem.driver_id = motoristas.driver_id
left join penalidade_divida as multa_valor on multa_valor.driver_id = motoristas.driver_id and multa_valor.multa
left join cursos_contagem on cursos_contagem.driver_id = motoristas.driver_id
left join ocorrencias_comportamentais_contagem on ocorrencias_comportamentais_contagem.driver_id = motoristas.driver_id
left join penalidade_divida as sinistro_contagem on sinistro_contagem.driver_id = motoristas.driver_id and not sinistro_contagem.multa
left join toxicologico on toxicologico.driver_id = motoristas.driver_id
left join pagamentos on pagamentos.driver_id = motoristas.driver_id
left join adiantamentos_indevidos on adiantamentos_indevidos.driver_id = motoristas.driver_id
left join quantidade_dias_agenciados on quantidade_dias_agenciados.driver_id = motoristas.driver_id
left join meses_contagem on meses_contagem.driver_id = motoristas.driver_id
left join empresas_CLT_duracao on empresas_CLT_duracao.driver_id = motoristas.driver_id
left join habitualidade on habitualidade.driver_id = motoristas.driver_id
left join ultima_viagem on ultima_viagem.driver_id = motoristas.driver_id
left join valor_viagem_total on valor_viagem_total.driver_id = motoristas.driver_id
left join rodando on rodando.driver_id = motoristas.driver_id
left join contratos_contagem on contratos_contagem.driver_id = motoristas.driver_id
)
select DISTINCT ON (driver_id) *
from resultado
where empresas_CLT_duracao > 0 and
quantidade_dias_agenciados > 0 and
ultima_viagem notnull
order by driver_idSELECT freights.created_at, freights.company_id, status, contract_days, 
freights."type" , freights.id, reason, ca.latitude, ca.longitude, freights.driver_id 
FROM freights
join company_addresses ca on ca.id = freights.origin
WHERE freights.created_at > '2023-11-01'
ORDER BY freights.created_at ASC


select count(*)
from drivers d 
limit 100select
	f.id "Id contrato",
	f.created_at "Data de criação do contrato",
	ch.created_at "Data de vinculo do analista de sucesso",
	c.id "Id cliente",
	c.name "Cliente",
	c.responsable_name "responsavel",
	c.phone,
	c.qtd_trucks,
	companies_client_status(c.client_status)"Status cliente",
	freights_status(f.status) "Status do contrato",
	c.company_multitenancy_id "Id cliente master",
	smt.name "Time",
	u.id "Id analista",
	u.name "Analista",
	case
		when al.causer_type = 'App\Models\User' then 'Usuario interno'
		when al.causer_type = 'App\Models\CompanyMultilevel' then 'Cliente'
	else 'Desconhecido'
	end,
	u2.id "Id usuario interno",
	u2.name "Usuario interno que criou o contrato"
from freights f
join companies c on c.id = f.company_id
join company_histories ch on ch.company_id = c.id and key = 'analyst_success_id' and old_value is null
left join success_manager_teams smt on smt.success_manager_id = c.success_manager_id
left join users u on u.id = c.analyst_success_id
join activity_log al on al.subject_id = f.id and subject_type = 'App\Models\Freight' and al.description = 'created'
left join users u2 on u2.id = al.causer_id
where f.created_at < ch.created_at
and f.created_at >= CURRENT_DATE - INTERVAL '1 YEAR'
order by f.created_at descWITH cte AS (
  SELECT
    *,
    ROW_NUMBER() OVER (PARTITION BY driver_id ORDER BY start_at) AS rn,
    ROW_NUMBER() OVER (PARTITION BY driver_id, company_id ORDER BY start_at) AS rn_company
  FROM freights
  where type = '1'
)
SELECT
  driver_id,
  company_id,
  MIN(start_at) AS inicio_periodo,      -- opcional: data de início do período
  MAX(end_at) AS fim_periodo,             -- opcional: data de fim do período
  SUM(contract_days) AS total_dias_agenciados,
  sum(price/100) as total_price,
  COUNT(*) AS contratos_consecutivos,
  SUM(contract_days) * 1.0 / COUNT(*) AS media_dias_por_contrato
FROM cte
GROUP BY
  driver_id,
  company_id,
  rn - rn_company    -- identificador da "ilha" de contratos consecutivos
having COUNT(*) > 1
  ORDER BY
  driver_id,
  inicio_periodo

  
  select 'O meu status atual é: ',
    CASE 
        WHEN drivers_status(status) = 'Lead' THEN 'lead: Ainda pode concluir o seu cadastro na plataforma'
        WHEN drivers_status(status) = 'Validação' THEN 'Validação: Já passou pela fase lead e estamos aguardando ou validando seus documentos.'
        WHEN drivers_status(status) = 'Qualificado' THEN 'Qualificado: Documentos validados, você está pronto para trabalhar ou continuar trabalhando com a PX'
        WHEN drivers_status(status) = 'Treinamento' THEN 'Treinamento: Fazendo o onboarding'
        WHEN drivers_status(status) = 'Aguardando MEI' THEN 'Aguardando MEI: Esperando a concretização do processo de finalização do MEI'
        WHEN drivers_status(status) = 'Atualização' THEN 'Atualização: Fazendo cursos para melhorar algum aspecto'
        WHEN drivers_status(status) = 'Toxicológico' THEN 'Não é possível determinar o status'
        WHEN drivers_status(status) = 'Desqualificado LGPD' THEN 'Não é possível determinar o status'
        WHEN drivers_status(status) = 'Desqualificado' THEN 'Não é possível determinar o status'
        ELSE 'Status desconhecido: Não é possível determinar o status'
    END AS status_with_description
FROM drivers
WHERE id = 14346with listagem as
(
select 
	d.state, d.city, d.id,
	json_array_elements_text(e.trucks) as trucks
from drivers d
	join driver_experiences e on e.driver_id = d.id 
WHERE 
	d.state is not null 
	and d.state <> 'undefined' 
)
select
	state,
	city,
	sum(case when trucks = '3_4' then 1 else 0 end) as "3_4",
	sum(case when trucks = 'bitrem' then 1 else 0 end) as "bitrem",
	sum(case when trucks = 'bitrenzao' then 1 else 0 end) as "bitrenzao",
	sum(case when trucks = 'bus' then 1 else 0 end) as "bus",
	sum(case when trucks = 'cavalinho' then 1 else 0 end) as "cavalinho",
	sum(case when trucks = 'ls' then 1 else 0 end) as "ls",
	sum(case when trucks = 'munk e van' then 1 else 0 end) as "munk_e_van",
	sum(case when trucks = 'rodotrem' then 1 else 0 end) as "rodotrem",
	sum(case when trucks = 'romeu_julieta' then 1 else 0 end) as "romeu_julieta",
	sum(case when trucks = 'tritrem' then 1 else 0 end) as "tritrem",
	sum(case when trucks = 'truck' then 1 else 0 end) as "truck",
	sum(case when trucks = 'utilitario' then 1 else 0 end) as "utilitario",
	sum(case when trucks = 'vanderleia' then 1 else 0 end) as "vanderleia"
from 
	listagem
group by
	1,2
order by
	1,2select dfh.freight_id , 
min(f.created_at) as contrato_criado,
min(dfh.candidate_at)  as motorista_candidatado,
(EXTRACT(EPOCH FROM (min(dfh.candidate_at) - MIN(f.created_at))) / 60)::INT AS tempo_decorrido_em_minutos
from driver_freight_history dfh
left join freights f ON dfh.freight_id = f.id
where candidate_at is not null
group by dfh.freight_id 

select 
fh.freight_id, 
min(f.created_at) as contrato_criado,
max(fh.created_at) as motorista_selectionado,
(EXTRACT(EPOCH FROM (MAX(fh.created_at) - MIN(f.created_at))) / 60 )::int AS tempo_decorrido_em_minutos
from freight_histories fh 
left join freights f on f.id = fh.freight_id 
where fh."key" = 'driver_id'
group by fh.freight_idWITH meses AS (
  SELECT
    generate_series(
      date_trunc('month', current_date) - INTERVAL '11 months',
      date_trunc('month', current_date),
      INTERVAL '1 month'
    ) AS mes
),
advances AS (
  SELECT
    date_trunc('month', created_at) AS mes,
    COUNT(*) AS cnt
  FROM payment_advances
  WHERE created_at >= date_trunc('month', current_date) - INTERVAL '11 months'
  GROUP BY mes
),
allowance AS (
  SELECT
    date_trunc('month', created_at) AS mes,
    COUNT(*) AS cnt
  FROM financial_allowance
  WHERE created_at >= date_trunc('month', current_date) - INTERVAL '11 months'
  GROUP BY mes
),
reimb AS (
  SELECT
    date_trunc('month', created_at) AS mes,
    COUNT(*) AS cnt
  FROM reimbursements
  WHERE created_at >= date_trunc('month', current_date) - INTERVAL '11 months'
  GROUP BY mes
),
credits AS (
  SELECT
    date_trunc('month', created_at) AS mes,
    COUNT(*) AS cnt
  FROM financial_orders
  WHERE created_at >= date_trunc('month', current_date) - INTERVAL '11 months'
  GROUP BY mes
)
SELECT
  to_char(m.mes, 'YYYY-MM')           AS mes,
  COALESCE(a.cnt, 0)                  AS qtde_adiantamentos,
  COALESCE(f.cnt, 0)                  AS qtde_ajudas_de_custo,
  COALESCE(r.cnt, 0)                  AS qtde_reembolsos,
  COALESCE(c.cnt, 0)                  AS qtde_creditos,
  (COALESCE(a.cnt, 0)
   + COALESCE(f.cnt, 0)
   + COALESCE(r.cnt, 0)
   + COALESCE(c.cnt, 0))              AS total_transacoes_mes
FROM meses m
LEFT JOIN advances a   ON a.mes = m.mes
LEFT JOIN allowance f  ON f.mes = m.mes
LEFT JOIN reimb r      ON r.mes = m.mes
LEFT JOIN credits c    ON c.mes = m.mes
ORDER BY m.mes;
